import{a as ne,b as ae}from"./chunk-KQXQCVSM.js";import{a as te,c as ie}from"./chunk-DUHGVNQK.js";import{i as oe}from"./chunk-KGM75SAH.js";import"./chunk-XXMBZZ37.js";import"./chunk-2H4PJY2W.js";import{a as A}from"./chunk-NHWKIFHZ.js";import{c as re,d as le,e as me,f as se,g as de,j as ce}from"./chunk-6QSEMOCP.js";import"./chunk-PPZFH2ZV.js";import{a as Y,b as Z}from"./chunk-2MAXEO6Q.js";import"./chunk-Q5HFPYVW.js";import"./chunk-46UKYMVD.js";import"./chunk-OL6EOTCO.js";import{h as X}from"./chunk-6BTVTWSQ.js";import{b as H,c as B,f as F,g as R,h as G,i as U,j as z,q as j,v as J,w as Q}from"./chunk-Z4BNMZT3.js";import{a as L}from"./chunk-47X5BFEM.js";import{d as q}from"./chunk-JUILAC2W.js";import{a as $,b as ee}from"./chunk-SPDGIFFF.js";import{b as V}from"./chunk-TOC7PNXQ.js";import"./chunk-JNP63KUK.js";import{Ma as k,gb as I,hb as K,z as W}from"./chunk-WQRABBEY.js";import{Ab as C,Ac as v,Hb as h,Mb as w,Ob as d,Pa as s,U as E,Z as g,_ as u,bb as T,bc as a,cc as M,dc as N,ec as D,gc as f,hb as P,hc as _,ic as b,ja as c,kc as S,mc as O,rb as y,sb as x,xb as p,yb as i,zb as n}from"./chunk-XTNRL3Y3.js";var ge=()=>({label:"Ahorros",value:"ahorros"}),ue=()=>({label:"Corriente",value:"corriente"}),fe=(l,m)=>[l,m];function _e(l,m){if(l&1&&(i(0,"div",6)(1,"h2"),C(2,"i",7),a(3," Configuraci\xF3n de Emails"),n(),i(4,"p",8),a(5),n()()),l&2){let e,r=d();s(5),N(" Configure el env\xEDo de notificaciones por email para ",(e=r.currentWorkspace())==null?null:e.name," ")}}function be(l,m){if(l&1&&C(0,"p-message",2),l&2){let e=d();p("text",e.error())}}function ye(l,m){if(l&1&&C(0,"p-message",3),l&2){let e=d();p("text",e.success())}}function xe(l,m){l&1&&(i(0,"div",4),C(1,"i",9),i(2,"p"),a(3,"Cargando configuraci\xF3n..."),n()())}function Ce(l,m){l&1&&a(0," Tu email de Hostinger (debe existir en tu panel) ")}function he(l,m){l&1&&a(0," Email verificado en SendGrid ")}function we(l,m){l&1&&(i(0,"span",70),a(1,"(dejar en blanco para mantener la actual)"),n())}function Ee(l,m){l&1&&(i(0,"span",16),a(1,"*"),n())}function Pe(l,m){if(l&1){let e=h();i(0,"div",20)(1,"h3",21),a(2,"Configuraci\xF3n SMTP"),n()(),i(3,"div",14)(4,"label",61),a(5,"Servidor SMTP "),i(6,"span",16),a(7,"*"),n()(),i(8,"input",62),b("ngModelChange",function(t){g(e);let o=d(2);return _(o.smtpHost,t)||(o.smtpHost=t),u(t)}),n(),i(9,"small"),a(10,"Para Hostinger: smtp.hostinger.com"),n()(),i(11,"div",35)(12,"label",63),a(13,"Puerto "),i(14,"span",16),a(15,"*"),n()(),i(16,"p-inputNumber",64),b("ngModelChange",function(t){g(e);let o=d(2);return _(o.smtpPort,t)||(o.smtpPort=t),u(t)}),n(),i(17,"small"),a(18,"465 (SSL) o 587 (TLS)"),n()(),i(19,"div",35)(20,"label",65),a(21,"Conexi\xF3n segura"),n(),i(22,"p-toggleButton",66),b("ngModelChange",function(t){g(e);let o=d(2);return _(o.smtpSecure,t)||(o.smtpSecure=t),u(t)}),n()(),i(23,"div",14)(24,"label",67),a(25,"Usuario SMTP "),i(26,"span",16),a(27,"*"),n()(),i(28,"input",68),b("ngModelChange",function(t){g(e);let o=d(2);return _(o.smtpUsername,t)||(o.smtpUsername=t),u(t)}),n(),i(29,"small"),a(30,"Normalmente es tu email completo"),n()(),i(31,"div",14)(32,"label",69),a(33," Contrase\xF1a SMTP "),y(34,we,2,0,"span",70)(35,Ee,2,0,"span",16),n(),i(36,"div",71)(37,"input",72),b("ngModelChange",function(t){g(e);let o=d(2);return _(o.smtpPassword,t)||(o.smtpPassword=t),u(t)}),n()(),i(38,"small"),a(39,"Contrase\xF1a de tu cuenta de email"),n()()}if(l&2){let e=d(2);s(8),f("ngModel",e.smtpHost),p("disabled",!e.enabled()),s(8),f("ngModel",e.smtpPort),p("min",1)("max",65535)("disabled",!e.enabled()),s(6),f("ngModel",e.smtpSecure),p("disabled",!e.enabled()),s(6),f("ngModel",e.smtpUsername),p("disabled",!e.enabled()),s(6),x(e.config()&&e.config().providerType===e.EmailProvider.SMTP?34:35),s(3),f("ngModel",e.smtpPassword),p("feedback",!1)("disabled",!e.enabled())}}function Me(l,m){l&1&&(i(0,"span",70),a(1,"(dejar en blanco para mantener la actual)"),n())}function Se(l,m){l&1&&(i(0,"span",16),a(1,"*"),n())}function ve(l,m){if(l&1){let e=h();i(0,"div",20)(1,"h3",21),a(2,"Configuraci\xF3n SendGrid"),n()(),i(3,"div",11)(4,"label",73),a(5," SendGrid API Key "),y(6,Me,2,0,"span",70)(7,Se,2,0,"span",16),n(),i(8,"div",71)(9,"input",74),b("ngModelChange",function(t){g(e);let o=d(2);return _(o.apiKey,t)||(o.apiKey=t),u(t)}),n()(),i(10,"small"),a(11," Obt\xE9n tu API key en "),i(12,"a",75),a(13,"SendGrid Dashboard"),n()()()}if(l&2){let e=d(2);s(6),x(e.config()&&e.config().providerType===e.EmailProvider.SENDGRID?6:7),s(3),f("ngModel",e.apiKey),p("feedback",!1)("disabled",!e.enabled())}}function Te(l,m){if(l&1){let e=h();i(0,"p-button",76),w("onClick",function(){g(e);let t=d(2);return u(t.onDelete())}),n()}l&2&&p("outlined",!0)}function Ne(l,m){if(l&1){let e=h();i(0,"p-button",77),w("onClick",function(){g(e);let t=d(2);return u(t.onSendTestEmail())}),n()}if(l&2){let e=d(2);p("disabled",e.isSendingTest())("loading",e.isSendingTest())}}function De(l,m){if(l&1){let e=h();i(0,"form",10)(1,"div",11)(2,"label",12)(3,"input",13),b("ngModelChange",function(t){g(e);let o=d();return _(o.enabled,t)||(o.enabled=t),u(t)}),n(),i(4,"span"),a(5,"Activar notificaciones por email"),n()()(),i(6,"div",14)(7,"label",15),a(8,"Email destinatario "),i(9,"span",16),a(10,"*"),n()(),i(11,"input",17),b("ngModelChange",function(t){g(e);let o=d();return _(o.recipientEmail,t)||(o.recipientEmail=t),u(t)}),n(),i(12,"small"),a(13,"Email principal que recibir\xE1 las notificaciones"),n()(),i(14,"div",14)(15,"label",18),a(16,"Emails CC (opcional)"),n(),i(17,"textarea",19),w("blur",function(t){g(e);let o=d();return u(o.onCCEmailsChange(t))}),n(),i(18,"small"),a(19,"Destinatarios adicionales separados por comas"),n()(),i(20,"div",20)(21,"h3",21),a(22,"Configuraci\xF3n del Remitente"),n()(),i(23,"div",11)(24,"label",22),a(25,"Proveedor de email "),i(26,"span",16),a(27,"*"),n()(),i(28,"p-select",23),b("ngModelChange",function(t){g(e);let o=d();return _(o.providerType,t)||(o.providerType=t),u(t)}),n(),i(29,"small"),a(30,"Usa SMTP para Hostinger, Gmail, Outlook, etc. o SendGrid API"),n()(),i(31,"div",14)(32,"label",24),a(33,"Email remitente "),i(34,"span",16),a(35,"*"),n()(),i(36,"input",25),b("ngModelChange",function(t){g(e);let o=d();return _(o.fromEmail,t)||(o.fromEmail=t),u(t)}),n(),i(37,"small"),y(38,Ce,1,0)(39,he,1,0),n()(),i(40,"div",14)(41,"label",26),a(42,"Nombre remitente "),i(43,"span",16),a(44,"*"),n()(),i(45,"input",27),b("ngModelChange",function(t){g(e);let o=d();return _(o.fromName,t)||(o.fromName=t),u(t)}),n()(),y(46,Pe,40,14),y(47,ve,14,4),i(48,"div",20)(49,"h3",21),C(50,"i",28),a(51," Opciones de Pago para Renovaciones "),n(),i(52,"small",29),a(53,"Configure los m\xE9todos de pago que aparecer\xE1n en los correos de renovaci\xF3n de dominios"),n()(),i(54,"div",20)(55,"h4",30),a(56,"Wompi (Pagos en l\xEDnea)"),n()(),i(57,"div",14)(58,"label",31),a(59,"Wompi Public Key"),n(),i(60,"input",32),b("ngModelChange",function(t){g(e);let o=d();return _(o.wompiPublicKey,t)||(o.wompiPublicKey=t),u(t)}),n(),i(61,"small"),a(62,"Clave p\xFAblica de Wompi para pagos en l\xEDnea"),n()(),i(63,"div",14)(64,"label",33),a(65,"Wompi Integrity Key"),n(),i(66,"input",34),b("ngModelChange",function(t){g(e);let o=d();return _(o.wompiIntegrityKey,t)||(o.wompiIntegrityKey=t),u(t)}),n(),i(67,"small"),a(68,"Clave de integridad para firma de pagos"),n()(),i(69,"div",20)(70,"h4",30),a(71,"Bancolombia (Transferencia)"),n()(),i(72,"div",35)(73,"label",36),a(74,"Tipo de cuenta"),n(),i(75,"p-select",37),b("ngModelChange",function(t){g(e);let o=d();return _(o.bancolombiaAccountType,t)||(o.bancolombiaAccountType=t),u(t)}),n()(),i(76,"div",35)(77,"label",38),a(78,"N\xFAmero de cuenta"),n(),i(79,"input",39),b("ngModelChange",function(t){g(e);let o=d();return _(o.bancolombiaAccountNumber,t)||(o.bancolombiaAccountNumber=t),u(t)}),n()(),i(80,"div",35)(81,"label",40),a(82,"Nombre del titular"),n(),i(83,"input",41),b("ngModelChange",function(t){g(e);let o=d();return _(o.bancolombiaOwnerName,t)||(o.bancolombiaOwnerName=t),u(t)}),n()(),i(84,"div",35)(85,"label",42),a(86,"C\xE9dula del titular"),n(),i(87,"input",43),b("ngModelChange",function(t){g(e);let o=d();return _(o.bancolombiaOwnerDocument,t)||(o.bancolombiaOwnerDocument=t),u(t)}),n()(),i(88,"div",20)(89,"h4",30),a(90,"Nequi (Transferencia)"),n()(),i(91,"div",14)(92,"label",44),a(93,"N\xFAmero Nequi"),n(),i(94,"input",45),b("ngModelChange",function(t){g(e);let o=d();return _(o.nequiPhoneNumber,t)||(o.nequiPhoneNumber=t),u(t)}),n(),i(95,"small"),a(96,"N\xFAmero de celular asociado a Nequi"),n()(),i(97,"div",14)(98,"label",46),a(99,"Nombre del titular Nequi"),n(),i(100,"input",47),b("ngModelChange",function(t){g(e);let o=d();return _(o.nequiOwnerName,t)||(o.nequiOwnerName=t),u(t)}),n(),i(101,"small"),a(102,"Nombre completo del titular de la cuenta Nequi"),n()(),i(103,"div",20)(104,"h3",21),a(105,"L\xEDmites de Env\xEDo"),n()(),i(106,"div",14)(107,"label",48),a(108,"M\xE1ximo por hora"),n(),i(109,"p-inputNumber",49),b("ngModelChange",function(t){g(e);let o=d();return _(o.maxPerHour,t)||(o.maxPerHour=t),u(t)}),n(),i(110,"small"),a(111,"L\xEDmite de emails por hora"),n()(),i(112,"div",14)(113,"label",50),a(114,"M\xE1ximo por d\xEDa"),n(),i(115,"p-inputNumber",51),b("ngModelChange",function(t){g(e);let o=d();return _(o.maxPerDay,t)||(o.maxPerDay=t),u(t)}),n(),i(116,"small"),a(117,"L\xEDmite de emails por d\xEDa"),n()(),i(118,"div",20)(119,"h3",21),a(120,"Configuraci\xF3n de Reintentos"),n()(),i(121,"div",14)(122,"label",52),a(123,"Intentos m\xE1ximos"),n(),i(124,"p-inputNumber",53),b("ngModelChange",function(t){g(e);let o=d();return _(o.maxRetryAttempts,t)||(o.maxRetryAttempts=t),u(t)}),n(),i(125,"small"),a(126,"N\xFAmero de reintentos en caso de fallo"),n()(),i(127,"div",14)(128,"label",54),a(129,"Delay entre reintentos (minutos)"),n(),i(130,"p-inputNumber",55),b("ngModelChange",function(t){g(e);let o=d();return _(o.retryDelayMinutes,t)||(o.retryDelayMinutes=t),u(t)}),n(),i(131,"small"),a(132,"Tiempo de espera entre reintentos"),n()()(),i(133,"div",56)(134,"p-button",57),w("onClick",function(){g(e);let t=d();return u(t.onCancel())}),n(),y(135,Te,1,1,"p-button",58),y(136,Ne,1,2,"p-button",59),i(137,"p-button",60),w("onClick",function(){g(e);let t=d();return u(t.onSave())}),n()()}if(l&2){let e=d();s(3),f("ngModel",e.enabled),s(8),f("ngModel",e.recipientEmail),p("disabled",!e.enabled()),s(6),p("value",e.ccEmails().join(", "))("disabled",!e.enabled()),s(11),f("ngModel",e.providerType),p("options",e.providerOptions)("disabled",!e.enabled()),s(8),f("ngModel",e.fromEmail),p("placeholder",e.providerType()===e.EmailProvider.SMTP?"tu-email@andres-bolanos.dev":"noreply@yourdomain.com")("disabled",!e.enabled()),s(2),x(e.providerType()===e.EmailProvider.SMTP?38:39),s(7),f("ngModel",e.fromName),p("disabled",!e.enabled()),s(),x(e.providerType()===e.EmailProvider.SMTP?46:-1),s(),x(e.providerType()===e.EmailProvider.SENDGRID?47:-1),s(13),f("ngModel",e.wompiPublicKey),p("disabled",!e.enabled()),s(6),f("ngModel",e.wompiIntegrityKey),p("feedback",!1)("disabled",!e.enabled()),s(9),f("ngModel",e.bancolombiaAccountType),p("options",O(57,fe,S(55,ge),S(56,ue)))("disabled",!e.enabled()),s(4),f("ngModel",e.bancolombiaAccountNumber),p("disabled",!e.enabled()),s(4),f("ngModel",e.bancolombiaOwnerName),p("disabled",!e.enabled()),s(4),f("ngModel",e.bancolombiaOwnerDocument),p("disabled",!e.enabled()),s(7),f("ngModel",e.nequiPhoneNumber),p("disabled",!e.enabled()),s(6),f("ngModel",e.nequiOwnerName),p("disabled",!e.enabled()),s(9),f("ngModel",e.maxPerHour),p("min",1)("max",100)("disabled",!e.enabled()),s(6),f("ngModel",e.maxPerDay),p("min",1)("max",1e3)("disabled",!e.enabled()),s(9),f("ngModel",e.maxRetryAttempts),p("min",0)("max",10)("disabled",!e.enabled()),s(6),f("ngModel",e.retryDelayMinutes),p("min",1)("max",60)("disabled",!e.enabled()),s(4),p("outlined",!0),s(),x(e.config()?135:-1),s(),x(e.config()&&e.enabled()?136:-1),s(),p("disabled",!e.canSave()||e.isSaving())("loading",e.isSaving())}}function Oe(l,m){l&1&&(i(0,"div",6)(1,"h3"),C(2,"i",81),a(3," Historial de Emails"),n(),i(4,"p",8),a(5,"\xDAltimos 20 emails enviados"),n()())}function We(l,m){l&1&&(i(0,"tr")(1,"th"),a(2,"Fecha"),n(),i(3,"th"),a(4,"Destinatario"),n(),i(5,"th"),a(6,"Asunto"),n(),i(7,"th"),a(8,"Tipo"),n(),i(9,"th"),a(10,"Estado"),n(),i(11,"th"),a(12,"Reintentos"),n()())}function ke(l,m){if(l&1&&(i(0,"tr")(1,"td"),a(2),n(),i(3,"td"),a(4),n(),i(5,"td"),a(6),n(),i(7,"td"),C(8,"p-tag",82),n(),i(9,"td"),C(10,"p-tag",83),n(),i(11,"td"),a(12),n()()),l&2){let e=m.$implicit,r=d(2);s(2),M(r.formatDate(e.createdAt)),s(2),M(e.recipientEmail),s(2),M(e.subject),s(2),p("value",e.templateType),s(2),p("value",e.status)("severity",r.getStatusSeverity(e.status)),s(2),D("",e.retryCount," / ",e.maxRetries)}}function Ae(l,m){l&1&&(i(0,"tr")(1,"td",84),a(2,"No hay emails en el historial"),n()())}function Ve(l,m){if(l&1&&(i(0,"p-card",5),P(1,Oe,6,0,"ng-template",1),i(2,"p-table",78),P(3,We,13,0,"ng-template",1)(4,ke,13,8,"ng-template",79)(5,Ae,3,0,"ng-template",80),n()()),l&2){let e=d();s(2),p("value",e.emailLogs())("paginator",!0)("rows",10)}}var pe=class l{emailService=E(oe);workspaceContext=E(A);encryptionService=E(L);router=E(W);isLoading=c(!1);isSaving=c(!1);isSendingTest=c(!1);error=c(null);success=c(null);config=c(null);emailLogs=c([]);showApiKey=c(!1);enabled=c(!0);providerType=c("smtp");recipientEmail=c("andres.fbramirez@gmail.com");ccEmails=c([]);fromEmail=c("afbolanos@andres-bolanos.dev");fromName=c("Hostinger Workspace Manager");apiKey=c("");smtpHost=c("smtp.hostinger.com");smtpPort=c(465);smtpSecure=c(!0);smtpUsername=c("afbolanos@andres-bolanos.dev");smtpPassword=c("");maxPerHour=c(10);maxPerDay=c(50);maxRetryAttempts=c(3);retryDelayMinutes=c(5);wompiPublicKey=c("");wompiIntegrityKey=c("");bancolombiaAccountType=c("ahorros");bancolombiaAccountNumber=c("");bancolombiaOwnerName=c("");bancolombiaOwnerDocument=c("");nequiPhoneNumber=c("");nequiOwnerName=c("");providerOptions=[{label:"SMTP (Hostinger, Gmail, etc.)",value:"smtp"},{label:"SendGrid API",value:"sendgrid"}];EmailProvider=V;currentWorkspace=v(()=>this.workspaceContext.getCurrentWorkspace());canSave=v(()=>this.recipientEmail().trim()!==""&&this.fromEmail().trim()!==""&&this.fromName().trim()!==""?this.providerType()==="smtp"?this.smtpHost().trim()!==""&&this.smtpUsername().trim()!==""&&(this.smtpPassword().trim()!==""||this.config()!==null):this.apiKey().trim()!==""||this.config()!==null:!1);async ngOnInit(){await this.loadConfig()}async loadConfig(){let m=this.currentWorkspace();if(!m?.id){this.error.set("No workspace selected");return}this.isLoading.set(!0),this.error.set(null);try{let e=await this.emailService.getEmailConfig(m.id);e&&(this.config.set(e),this.enabled.set(e.enabled),this.providerType.set(e.providerType||"smtp"),this.recipientEmail.set(e.recipientEmail),this.ccEmails.set(e.ccEmails||[]),this.fromEmail.set(e.provider.fromEmail),this.fromName.set(e.provider.fromName),e.providerType==="smtp"&&e.provider.smtp&&(this.smtpHost.set(e.provider.smtp.host),this.smtpPort.set(e.provider.smtp.port),this.smtpSecure.set(e.provider.smtp.secure),this.smtpUsername.set(e.provider.smtp.username)),this.maxPerHour.set(e.rateLimit?.maxPerHour||10),this.maxPerDay.set(e.rateLimit?.maxPerDay||50),this.maxRetryAttempts.set(e.retry?.maxAttempts||3),this.retryDelayMinutes.set(e.retry?.delayMinutes||5),e.paymentOptions&&(this.wompiPublicKey.set(e.paymentOptions.wompiPublicKey||""),this.wompiIntegrityKey.set(e.paymentOptions.wompiIntegrityKey||""),this.bancolombiaAccountType.set(e.paymentOptions.bancolombia?.accountType||"ahorros"),this.bancolombiaAccountNumber.set(e.paymentOptions.bancolombia?.accountNumber||""),this.bancolombiaOwnerName.set(e.paymentOptions.bancolombia?.ownerName||""),this.bancolombiaOwnerDocument.set(e.paymentOptions.bancolombia?.ownerDocument||""),this.nequiPhoneNumber.set(e.paymentOptions.nequi?.phoneNumber||""),this.nequiOwnerName.set(e.paymentOptions.nequi?.ownerName||""))),await this.loadEmailLogs()}catch(e){let r=e instanceof Error?e.message:"Unknown error";this.error.set(`Failed to load configuration: ${r}`)}finally{this.isLoading.set(!1)}}async loadEmailLogs(){let m=this.currentWorkspace();if(m?.id)try{let e=await this.emailService.getEmailLogs(m.id,20);this.emailLogs.set(e)}catch(e){console.error("Failed to load email logs:",e)}}onCCEmailsChange(m){let r=m.target.value.split(",").map(t=>t.trim()).filter(t=>t.length>0);this.ccEmails.set(r)}async onSave(){let m=this.currentWorkspace();if(!m?.id){this.error.set("No workspace selected");return}this.isSaving.set(!0),this.error.set(null),this.success.set(null);try{let e;if(this.providerType()==="smtp"){let r=this.smtpPassword(),t=r.trim()!==""?this.encryptionService.encrypt(r):this.config()?.provider.smtp?.password;if(!t)throw new Error("SMTP password is required");e={workspaceId:m.id,enabled:this.enabled(),providerType:"smtp",recipientEmail:this.recipientEmail(),ccEmails:this.ccEmails(),provider:{smtp:{host:this.smtpHost(),port:this.smtpPort(),secure:this.smtpSecure(),username:this.smtpUsername(),password:t},fromEmail:this.fromEmail(),fromName:this.fromName()},rateLimit:{maxPerHour:this.maxPerHour(),maxPerDay:this.maxPerDay()},retry:{maxAttempts:this.maxRetryAttempts(),delayMinutes:this.retryDelayMinutes()},paymentOptions:{wompiPublicKey:this.wompiPublicKey().trim()||void 0,wompiIntegrityKey:this.wompiIntegrityKey().trim()||void 0,bancolombia:this.bancolombiaAccountNumber().trim()?{accountType:this.bancolombiaAccountType(),accountNumber:this.bancolombiaAccountNumber(),ownerName:this.bancolombiaOwnerName(),ownerDocument:this.bancolombiaOwnerDocument()}:void 0,nequi:this.nequiPhoneNumber().trim()?{phoneNumber:this.nequiPhoneNumber(),ownerName:this.nequiOwnerName()}:void 0}}}else{let r=this.apiKey(),t=r.trim()!==""?this.encryptionService.encrypt(r):this.config()?.provider.apiKey;if(!t)throw new Error("SendGrid API key is required");e={workspaceId:m.id,enabled:this.enabled(),providerType:"sendgrid",recipientEmail:this.recipientEmail(),ccEmails:this.ccEmails(),provider:{apiKey:t,fromEmail:this.fromEmail(),fromName:this.fromName()},rateLimit:{maxPerHour:this.maxPerHour(),maxPerDay:this.maxPerDay()},retry:{maxAttempts:this.maxRetryAttempts(),delayMinutes:this.retryDelayMinutes()},paymentOptions:{wompiPublicKey:this.wompiPublicKey().trim()||void 0,wompiIntegrityKey:this.wompiIntegrityKey().trim()||void 0,bancolombia:this.bancolombiaAccountNumber().trim()?{accountType:this.bancolombiaAccountType(),accountNumber:this.bancolombiaAccountNumber(),ownerName:this.bancolombiaOwnerName(),ownerDocument:this.bancolombiaOwnerDocument()}:void 0,nequi:this.nequiPhoneNumber().trim()?{phoneNumber:this.nequiPhoneNumber(),ownerName:this.nequiOwnerName()}:void 0}}}this.config()?(await this.emailService.updateEmailConfig(m.id,e),this.success.set("Configuration updated successfully")):(await this.emailService.createEmailConfig(e),this.success.set("Configuration created successfully")),this.apiKey.set(""),this.smtpPassword.set(""),await this.loadConfig()}catch(e){let r=e instanceof Error?e.message:"Unknown error";this.error.set(`Failed to save configuration: ${r}`)}finally{this.isSaving.set(!1)}}async onDelete(){let m=this.currentWorkspace();if(m?.id&&confirm("Are you sure you want to delete the email configuration?")){this.isLoading.set(!0),this.error.set(null);try{await this.emailService.deleteEmailConfig(m.id),this.success.set("Configuration deleted successfully"),this.config.set(null),this.resetForm()}catch(e){let r=e instanceof Error?e.message:"Unknown error";this.error.set(`Failed to delete configuration: ${r}`)}finally{this.isLoading.set(!1)}}}onCancel(){this.router.navigate(["/dashboard"])}async onSendTestEmail(){if(!this.currentWorkspace()?.id){this.error.set("No workspace selected");return}if(!this.config()){this.error.set("Debes guardar la configuraci\xF3n antes de enviar un email de prueba");return}this.isSendingTest.set(!0),this.error.set(null),this.success.set(null);try{let e=await fetch("https://us-central1-hostinger-workspace-manager.cloudfunctions.net/createTestAlert",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.recipientEmail()})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let r=await e.json(),t=await fetch("https://us-central1-hostinger-workspace-manager.cloudfunctions.net/runGenerateAlerts",{method:"POST"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);await t.json(),this.success.set(`\u2705 Email de prueba enviado exitosamente a ${this.recipientEmail()}. El email ser\xE1 entregado en los pr\xF3ximos 15 minutos por la funci\xF3n autom\xE1tica. Dominio de prueba: ${r.data?.domainName||"N/A"}`),setTimeout(()=>{this.loadEmailLogs()},2e3)}catch(e){let r=e instanceof Error?e.message:"Unknown error";this.error.set(`Error al enviar email de prueba: ${r}`)}finally{this.isSendingTest.set(!1)}}toggleApiKeyVisibility(){this.showApiKey.set(!this.showApiKey())}getStatusSeverity(m){switch(m){case"sent":return"success";case"failed":return"danger";case"retrying":return"warn";default:return"info"}}formatDate(m){return m?m.toDate().toLocaleString():"N/A"}resetForm(){this.enabled.set(!1),this.recipientEmail.set(""),this.ccEmails.set([]),this.fromEmail.set(""),this.fromName.set(""),this.apiKey.set(""),this.maxPerHour.set(10),this.maxPerDay.set(50),this.maxRetryAttempts.set(3),this.retryDelayMinutes.set(5)}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=T({type:l,selectors:[["app-email-config"]],decls:8,vars:4,consts:[[1,"email-config-container"],["pTemplate","header"],["severity","error",1,"mb-4","block",3,"text"],["severity","success",1,"mb-4","block",3,"text"],[1,"loading-container"],[1,"mt-4"],[1,"card-header"],[1,"fas","fa-envelope"],[1,"subtitle"],[1,"fas","fa-spinner","fa-spin",2,"font-size","2rem"],[1,"form-grid"],[1,"field","col-12"],[1,"toggle-label"],["type","checkbox","name","enabled",1,"toggle-checkbox",3,"ngModelChange","ngModel"],[1,"field","col-12","md:col-6"],["for","recipientEmail"],[1,"required"],["id","recipientEmail","pInputText","","type","email","name","recipientEmail","placeholder","notificaciones@example.com",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","ccEmails"],["id","ccEmails","pInputText","","rows","3","name","ccEmails","placeholder","email1@example.com, email2@example.com",1,"w-full",3,"blur","value","disabled"],[1,"col-12"],[1,"section-title"],["for","providerType"],["id","providerType","name","providerType","optionLabel","label","optionValue","value","placeholder","Selecciona un proveedor",1,"w-full",3,"ngModelChange","ngModel","options","disabled"],["for","fromEmail"],["id","fromEmail","pInputText","","type","email","name","fromEmail",1,"w-full",3,"ngModelChange","ngModel","placeholder","disabled"],["for","fromName"],["id","fromName","pInputText","","name","fromName","placeholder","Hostinger Workspace Manager",1,"w-full",3,"ngModelChange","ngModel","disabled"],[1,"fas","fa-credit-card"],[1,"text-muted"],[1,"subsection-title"],["for","wompiPublicKey"],["id","wompiPublicKey","pInputText","","type","text","name","wompiPublicKey","placeholder","pub_prod_xxxxxxxxxxxx",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","wompiIntegrityKey"],["id","wompiIntegrityKey","pPassword","","name","wompiIntegrityKey","placeholder","prod_integrity_xxxxxxxxxxxx",1,"w-full",3,"ngModelChange","ngModel","feedback","disabled"],[1,"field","col-12","md:col-3"],["for","bancolombiaAccountType"],["id","bancolombiaAccountType","name","bancolombiaAccountType","optionLabel","label","optionValue","value","placeholder","Selecciona tipo",1,"w-full",3,"ngModelChange","ngModel","options","disabled"],["for","bancolombiaAccountNumber"],["id","bancolombiaAccountNumber","pInputText","","type","text","name","bancolombiaAccountNumber","placeholder","1234567890",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","bancolombiaOwnerName"],["id","bancolombiaOwnerName","pInputText","","type","text","name","bancolombiaOwnerName","placeholder","Juan P\xE9rez",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","bancolombiaOwnerDocument"],["id","bancolombiaOwnerDocument","pInputText","","type","text","name","bancolombiaOwnerDocument","placeholder","1234567890",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","nequiPhoneNumber"],["id","nequiPhoneNumber","pInputText","","type","tel","name","nequiPhoneNumber","placeholder","3182609266",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","nequiOwnerName"],["id","nequiOwnerName","pInputText","","type","text","name","nequiOwnerName","placeholder","Juan P\xE9rez",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","maxPerHour"],["id","maxPerHour","name","maxPerHour",1,"w-full",3,"ngModelChange","ngModel","min","max","disabled"],["for","maxPerDay"],["id","maxPerDay","name","maxPerDay",1,"w-full",3,"ngModelChange","ngModel","min","max","disabled"],["for","maxRetryAttempts"],["id","maxRetryAttempts","name","maxRetryAttempts",1,"w-full",3,"ngModelChange","ngModel","min","max","disabled"],["for","retryDelayMinutes"],["id","retryDelayMinutes","name","retryDelayMinutes",1,"w-full",3,"ngModelChange","ngModel","min","max","disabled"],[1,"actions"],["label","Cancelar","icon","fas fa-times","severity","secondary",3,"onClick","outlined"],["label","Eliminar","icon","fas fa-trash","severity","danger",3,"outlined"],["label","Enviar Email de Prueba","icon","fas fa-paper-plane","severity","info",3,"disabled","loading"],["label","Guardar","icon","fas fa-save","severity","success",3,"onClick","disabled","loading"],["for","smtpHost"],["id","smtpHost","pInputText","","name","smtpHost","placeholder","smtp.hostinger.com",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","smtpPort"],["id","smtpPort","name","smtpPort",1,"w-full",3,"ngModelChange","ngModel","min","max","disabled"],["for","smtpSecure"],["id","smtpSecure","name","smtpSecure","onLabel","SSL/TLS","offLabel","Sin SSL",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","smtpUsername"],["id","smtpUsername","pInputText","","type","email","name","smtpUsername","placeholder","tu-email@andres-bolanos.dev",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","smtpPassword"],[1,"optional"],[1,"p-inputgroup"],["id","smtpPassword","pPassword","","name","smtpPassword","placeholder","Tu contrase\xF1a de email",1,"w-full",3,"ngModelChange","ngModel","feedback","disabled"],["for","apiKey"],["id","apiKey","pPassword","","name","apiKey","placeholder","SG.xxxxxxxxxxxxxxxxxxxx",1,"w-full",3,"ngModelChange","ngModel","feedback","disabled"],["href","https://app.sendgrid.com/settings/api_keys","target","_blank"],["label","Eliminar","icon","fas fa-trash","severity","danger",3,"onClick","outlined"],["label","Enviar Email de Prueba","icon","fas fa-paper-plane","severity","info",3,"onClick","disabled","loading"],[1,"p-datatable-sm",3,"value","paginator","rows"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"fas","fa-inbox"],["severity","info",3,"value"],[3,"value","severity"],["colspan","6",1,"text-center"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"p-card"),P(2,_e,6,1,"ng-template",1),y(3,be,1,1,"p-message",2),y(4,ye,1,1,"p-message",3),y(5,xe,4,0,"div",4)(6,De,138,60),n(),y(7,Ve,6,3,"p-card",5),n()),e&2&&(s(3),x(r.error()?3:-1),s(),x(r.success()?4:-1),s(),x(r.isLoading()?5:6),s(2),x(r.emailLogs().length>0?7:-1))},dependencies:[j,z,B,H,F,R,U,G,ee,$,k,Q,J,K,I,se,me,le,re,ae,ne,ce,de,Z,Y,q,ie,te,X],styles:['.email-config-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.card-header[_ngcontent-%COMP%]{padding:1.5rem 2rem}.card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--text-color);font-size:1.75rem;font-weight:600}.card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem}.card-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;color:var(--text-color-secondary);font-size:.95rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(12,1fr);gap:1.5rem}.col-12[_ngcontent-%COMP%], .md\\:col-6[_ngcontent-%COMP%], .md\\:col-3[_ngcontent-%COMP%]{grid-column:span 12}@media(min-width:768px){.md\\:col-6[_ngcontent-%COMP%]{grid-column:span 6}.md\\:col-3[_ngcontent-%COMP%]{grid-column:span 3}}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color);font-size:.95rem}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:var(--red-500)}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .optional[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-weight:400;font-size:.85rem}.field[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-size:.85rem}.field[_ngcontent-%COMP%]     p-select{width:100%}.field[_ngcontent-%COMP%]     p-select .p-select{width:100%}.field[_ngcontent-%COMP%]     textarea{width:100%;min-height:80px}.toggle-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-weight:600;cursor:pointer}.toggle-label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.1rem}.toggle-label[_ngcontent-%COMP%]   .toggle-checkbox[_ngcontent-%COMP%]{width:3rem;height:1.5rem;cursor:pointer;appearance:none;background-color:var(--surface-400);border-radius:1rem;position:relative;transition:background-color .3s}.toggle-label[_ngcontent-%COMP%]   .toggle-checkbox[_ngcontent-%COMP%]:checked{background-color:var(--primary-color)}.toggle-label[_ngcontent-%COMP%]   .toggle-checkbox[_ngcontent-%COMP%]:before{content:"";position:absolute;width:1.25rem;height:1.25rem;border-radius:50%;background-color:#fff;top:.125rem;left:.125rem;transition:transform .3s}.toggle-label[_ngcontent-%COMP%]   .toggle-checkbox[_ngcontent-%COMP%]:checked:before{transform:translate(1.5rem)}.toggle-label[_ngcontent-%COMP%]   .toggle-checkbox[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.section-title[_ngcontent-%COMP%]{margin:1rem 0 0;padding-top:1rem;border-top:1px solid var(--surface-border);color:var(--text-color);font-size:1.1rem;font-weight:600}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem;padding-top:2rem;border-top:1px solid var(--surface-border)}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;gap:1rem;color:var(--text-color-secondary)}@media(max-width:768px){.email-config-container[_ngcontent-%COMP%]{padding:1rem}.form-grid[_ngcontent-%COMP%]{gap:1rem}.field.md\\\\[_ngcontent-%COMP%]:col-6{grid-column:span 12}.actions[_ngcontent-%COMP%]{flex-direction:column}.actions[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]{width:100%}}'],changeDetection:0})};export{pe as EmailConfigPage};

import{Ja as D,La as g,Ma as i,Na as m,Oa as y,Pa as w,Ra as f,Xa as x}from"./chunk-M5CBQPDY.js";import{O as p,a as l,b as d,ia as u}from"./chunk-ZVXIGZDY.js";var b=class c{firestore=x.getFirestore();isLoading=u(!1);error=u(null);async getDomains(o){try{this.isLoading.set(!0),this.error.set(null);let e=[i("workspaceId","==",o.workspaceId)];if(o.daysToExpire!==void 0){let t=new Date;t.setDate(t.getDate()+o.daysToExpire),e.push(i("expiresAt","<=",t))}e.push(m("expiresAt","asc"));let r=o.pageSize||20;e.push(y(r+1)),o.lastDoc&&e.push(w(o.lastDoc));let s=g(D(this.firestore,"domains"),...e),a=await f(s),n=a.docs.map(t=>d(l({},t.data()),{id:t.id}));if(o.searchText){let t=o.searchText.toLowerCase();n=n.filter(k=>k.domainName?.toLowerCase().includes(t))}let h=n.length>r;h&&(n=n.slice(0,r));let E=n.length>0?a.docs[n.length-1]:null;return{domains:n,lastDoc:E,hasMore:h}}catch(e){let r=e instanceof Error?e.message:"Error desconocido";throw this.error.set(r),console.error("Error fetching domains:",e),e}finally{this.isLoading.set(!1)}}async getAllDomains(o){try{this.isLoading.set(!0),this.error.set(null),console.log("[DomainService] Fetching all domains for workspaceId:",o);let e=g(D(this.firestore,"domains"),i("workspaceId","==",o),m("expiresAt","asc")),r=await f(e);console.log("[DomainService] Fetched",r.size,"domains");let s=r.docs.map(a=>d(l({},a.data()),{id:a.id}));return console.log("[DomainService] Mapped domains:",s),s}catch(e){let r=e instanceof Error?e.message:"Error desconocido";throw this.error.set(r),console.error("[DomainService] Error fetching all domains:",e),e instanceof Error&&e.message.includes("index")&&console.error("[DomainService] \u26A0\uFE0F Firestore index required. Check Firebase Console."),e}finally{this.isLoading.set(!1)}}getDaysUntilExpiration(o){let e=this.toDate(o);if(!e)return null;let r=new Date,s=e.getTime()-r.getTime();return Math.ceil(s/(1e3*60*60*24))}getExpirationStatus(o){let e=this.getDaysUntilExpiration(o);return e===null?"ok":e<0?"expired":e<=7?"critical":e<=30?"warning":"ok"}toDate(o){return o?o instanceof Date?o:typeof o=="object"&&"toDate"in o?o.toDate():typeof o=="object"&&"seconds"in o?new Date(o.seconds*1e3):null:null}clearError(){this.error.set(null)}static \u0275fac=function(e){return new(e||c)};static \u0275prov=p({token:c,factory:c.\u0275fac,providedIn:"root"})};export{b as a};

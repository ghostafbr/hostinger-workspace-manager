<p-card>
  <ng-template pTemplate="header">
    <div class="dns-compare-header">
      <div class="dns-compare-title">
        <i class="pi pi-history"></i>
        <span>DNS Configuration Comparison</span>
      </div>
      <p-button
        icon="pi pi-camera"
        label="Create Snapshot"
        severity="success"
        size="small"
        (onClick)="createSnapshot()"
        [loading]="isLoading()"
        class="create-snapshot-btn"
      />
    </div>
  </ng-template>

  <ng-template pTemplate="content">
    <!-- Snapshot Selection -->
    <div class="compare-select-block">
      <label class="compare-label">Comparar con Snapshot:</label>
      <select
        class="compare-select p-inputtext p-component"
        [(ngModel)]="selectedSnapshotId"
        (change)="selectedSnapshotId() && onSnapshotSelect(selectedSnapshotId()!)"
      >
        <option [value]="null">Selecciona un snapshot para comparar</option>
        @for (snapshot of snapshots(); track snapshot.id) {
          <option [value]="snapshot.id">
            {{ snapshot.createdAt.toDate().toLocaleString() }} - {{ snapshot.note || 'Snapshot manual' }}
          </option>
        }
      </select>
      @if (snapshots().length === 0) {
        <div class="compare-empty-msg">
          <i class="pi pi-info-circle"></i>
          <span>No hay snapshots disponibles. Crea uno para comenzar a comparar.</span>
        </div>
      }
    </div>

    <p-divider />

    <!-- Resumen visual de cambios -->
    @if (comparison()) {
      <div class="dns-compare-summary">
        <div class="summary-card added">
          <i class="pi pi-plus-circle"></i>
          <span class="summary-count">{{ comparison()!.added.length }}</span>
          <span class="summary-label">Agregados</span>
        </div>
        <div class="summary-card removed">
          <i class="pi pi-minus-circle"></i>
          <span class="summary-count">{{ comparison()!.removed.length }}</span>
          <span class="summary-label">Eliminados</span>
        </div>
        <div class="summary-card modified">
          <i class="pi pi-pencil"></i>
          <span class="summary-count">{{ comparison()!.modified.length }}</span>
          <span class="summary-label">Modificados</span>
        </div>
      </div>

      <!-- No Changes Message -->
      @if (getTotalChanges() === 0) {
        <div class="p-4 bg-green-50 border-round text-center">
          <i class="pi pi-check-circle text-4xl text-green-600 mb-2"></i>
          <p class="text-green-900 font-semibold">No changes detected</p>
          <p class="text-sm text-green-700">DNS configuration matches the selected snapshot</p>
        </div>
      }

      <!-- Added Records -->
      @if (comparison()!.added.length > 0) {
        <div class="mb-4">
          <h4 class="text-green-600 mb-3">
            <i class="pi pi-plus-circle mr-2"></i>
            Added Records ({{ comparison()!.added.length }})
          </h4>
          <p-table
            [value]="comparison()!.added"
            [rowHover]="true"
            class="p-datatable-sm"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Type</th>
                <th>Name</th>
                <th>Value</th>
                <th>TTL</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-record>
              <tr class="bg-green-50">
                <td>
                  <p-tag [value]="record.recordType" severity="success" />
                </td>
                <td>{{ record.name }}</td>
                <td><code>{{ record.value }}</code></td>
                <td>{{ record.getFormattedTTL() }}</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      }

      <!-- Removed Records -->
      @if (comparison()!.removed.length > 0) {
        <div class="mb-4">
          <h4 class="text-red-600 mb-3">
            <i class="pi pi-minus-circle mr-2"></i>
            Removed Records ({{ comparison()!.removed.length }})
          </h4>
          <p-table
            [value]="comparison()!.removed"
            [rowHover]="true"
            class="p-datatable-sm"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Type</th>
                <th>Name</th>
                <th>Value</th>
                <th>TTL</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-record>
              <tr class="bg-red-50">
                <td>
                  <p-tag [value]="record.recordType" severity="danger" />
                </td>
                <td>{{ record.name }}</td>
                <td><code>{{ record.value }}</code></td>
                <td>{{ record.getFormattedTTL() }}</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      }

      <!-- Modified Records -->
      @if (comparison()!.modified.length > 0) {
        <div class="mb-4">
          <h4 class="text-orange-600 mb-3">
            <i class="pi pi-pencil mr-2"></i>
            Modified Records ({{ comparison()!.modified.length }})
          </h4>
          <p-table
            [value]="comparison()!.modified"
            [rowHover]="true"
            class="p-datatable-sm"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Type</th>
                <th>Name</th>
                <th>Value</th>
                <th>TTL</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-record>
              <tr class="bg-orange-50">
                <td>
                  <p-tag [value]="record.recordType" severity="warn" />
                </td>
                <td>{{ record.name }}</td>
                <td><code>{{ record.value }}</code></td>
                <td>{{ record.getFormattedTTL() }}</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      }
    }

    <!-- No Snapshot Selected -->
    @if (!comparison() && !isLoading()) {
      <div class="text-center p-5">
        <i class="pi pi-info-circle text-5xl text-gray-400 mb-3"></i>
        <p class="text-gray-600">Select a snapshot to compare with current DNS configuration</p>
      </div>
    }
  </ng-template>
</p-card>

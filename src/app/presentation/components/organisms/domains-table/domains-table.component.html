<div class="domains-table-container">
  <!-- Toolbar with search and filters -->
  <div class="table-toolbar">
    <p-iconfield iconPosition="left" styleClass="search-field">
      <p-inputicon styleClass="pi pi-search" />
      <input
        pInputText
        type="text"
        placeholder="Buscar dominio..."
        [value]="searchText()"
        (input)="onSearch($event)"
      />
    </p-iconfield>

    <p-select
      [options]="daysFilterOptions"
      [(ngModel)]="selectedDaysFilter"
      (ngModelChange)="onDaysFilterChange($event)"
      optionLabel="label"
      optionValue="value"
      placeholder="Filtrar por días"
      styleClass="days-filter"
    />

    <div class="results-count">
      <span>{{ filteredDomains().length }} de {{ totalRecords() }} dominios</span>
    </div>
  </div>

  <!-- Domains Table -->
  <p-table
    [value]="filteredDomains()"
    [loading]="isLoading()"
    [paginator]="true"
    [rows]="20"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} dominios"
    [rowsPerPageOptions]="[10, 20, 50]"
    responsiveLayout="scroll"
    styleClass="domains-table"
  >
    <!-- Semáforo Column -->
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 80px">Estado</th>
        <th pSortableColumn="domain">
          Dominio
          <p-sortIcon field="domain" />
        </th>
        <th pSortableColumn="expiresAt" style="width: 180px">
          Vence
          <p-sortIcon field="expiresAt" />
        </th>
        <th style="width: 250px">Nameservers</th>
        <th style="width: 100px" class="text-center">Lock</th>
        <th style="width: 100px" class="text-center">Privacy</th>
        <th style="width: 120px" class="text-center">Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-domain>
      <tr class="domain-row">
        <!-- Semaphore -->
        <td class="semaphore-cell">
          <app-expiration-semaphore [expiresAt]="domain.expiresAt" />
        </td>

        <!-- Domain Name -->
        <td class="domain-name">
          <strong>{{ domain.domainName }}</strong>
        </td>

        <!-- Expires At -->
        <td>
          <span class="expiration-date">
            {{ domain.expiresAt.toDate() | date: 'dd/MM/yyyy HH:mm' }}
          </span>
        </td>

        <!-- Nameservers -->
        <td class="nameservers-cell">
          <span class="nameservers-text" [title]="formatNameservers(domain.nameservers)">
            {{ formatNameservers(domain.nameservers) }}
          </span>
        </td>

        <!-- Domain Lock -->
        <td class="text-center">
          <p-tag
            [value]="domain.domainLock ? 'Sí' : 'No'"
            [severity]="getPrivacyLockSeverity(domain.domainLock || false)"
          />
        </td>

        <!-- Privacy Protection -->
        <td class="text-center">
          <p-tag
            [value]="domain.privacyProtection ? 'Sí' : 'No'"
            [severity]="getPrivacyLockSeverity(domain.privacyProtection || false)"
          />
        </td>

        <!-- Actions -->
        <td class="text-center">
          <p-button
            label="Detalles"
            icon="pi pi-eye"
            [text]="true"
            size="small"
            (onClick)="onDomainClick(domain)"
          />
        </td>
      </tr>
    </ng-template>

    <!-- Empty State -->
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7" class="empty-state">
          @if (isLoading()) {
            <div class="loading-state">
              <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
              <p>Cargando dominios...</p>
            </div>
          } @else {
            <div class="no-data">
              <i
                class="pi pi-inbox"
                style="font-size: 3rem; color: var(--text-color-secondary)"
              ></i>
              <p>No se encontraron dominios</p>
              @if (searchText() || selectedDaysFilter() !== null) {
                <p class="hint">Intenta cambiar los filtros de búsqueda</p>
              }
            </div>
          }
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

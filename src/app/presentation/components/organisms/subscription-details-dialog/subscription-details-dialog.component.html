<app-modal-wrapper
  width="800px"
  [visible]="visible()"
  (onClose)="onClose()"
  [header]="subscription()?.productName || 'Detalles de Suscripción'"
>
  <!-- Custom Header Content -->
  <ng-container slot="header">
    @if (subscription()) {
      <div class="dialog-header mb-3">
        <div class="subscription-header">
          <div class="subscription-title">
            <app-expiration-semaphore [expiresAt]="subscription()!.expiresAt" />
            <h2>{{ subscription()!.productName }}</h2>
          </div>
        </div>
      </div>
    }
  </ng-container>

  @if (subscription()) {
    <div class="subscription-details">
      <!-- Main Information Grid -->
      <div class="details-grid mt-3">
        <app-detail-item label="ID de Suscripción">
          <code>{{ subscription()!.subscriptionId }}</code>
        </app-detail-item>

        <app-detail-item label="Fecha de Vencimiento">
          <strong>{{ subscription()!.expiresAt.toDate() | date: 'dd/MM/yyyy HH:mm' }}</strong>
        </app-detail-item>

        @if (subscription()!.nextBillingAt) {
          <app-detail-item label="Próxima Facturación">
            {{ subscription()!.nextBillingAt!.toDate() | date: 'dd/MM/yyyy HH:mm' }}
          </app-detail-item>
        }

        <!-- Status -->
        <app-detail-item label="Estado">
          <app-status-tag [value]="subscription()!.status" />
        </app-detail-item>

        <!-- Auto-Renew -->
        <app-detail-item label="Renovación Automática">
          <p-tag
            [value]="subscription()!.autoRenew ? 'Activada' : 'Desactivada'"
            [severity]="getTagSeverity(subscription()!.autoRenew)"
            [icon]="subscription()!.autoRenew ? 'pi pi-check' : 'pi pi-times'"
          />
        </app-detail-item>

        @if (subscription()!.syncedAt) {
          <app-detail-item label="Última Sincronización">
            <div class="synced-at">
              <i class="pi pi-sync"></i>
              {{ subscription()!.syncedAt.toDate() | date: 'dd/MM/yyyy HH:mm' }}
            </div>
          </app-detail-item>
        }
      </div>

      <p-divider />

      <!-- Raw Data Section -->
      <app-raw-data-viewer [data]="subscription()" />
    </div>
  }
</app-modal-wrapper>

import{a as ne,b as ae}from"./chunk-KZCX5W5D.js";import{a as q,b as K}from"./chunk-FQ2DMXUJ.js";import{h as Z}from"./chunk-5R2X6POM.js";import"./chunk-XXMBZZ37.js";import"./chunk-NHWKIFHZ.js";import{g as Q,h as X,i as ee,j as te}from"./chunk-GCQ2WIT6.js";import{a as J,b as U}from"./chunk-XNM27DCK.js";import"./chunk-PPZFH2ZV.js";import{a as $,b as G}from"./chunk-2MAXEO6Q.js";import"./chunk-Q5HFPYVW.js";import"./chunk-46UKYMVD.js";import"./chunk-OL6EOTCO.js";import"./chunk-6BTVTWSQ.js";import"./chunk-Z4BNMZT3.js";import"./chunk-47X5BFEM.js";import{c as L,d as B}from"./chunk-JUILAC2W.js";import{a as Y,b as j}from"./chunk-SPDGIFFF.js";import{c as z}from"./chunk-TOC7PNXQ.js";import"./chunk-JNP63KUK.js";import{Ia as A,Ma as N,gb as W,hb as V,k as I,m as D,z as R}from"./chunk-WQRABBEY.js";import{$b as P,Ab as c,Hb as H,Mb as f,Ob as u,Pa as o,U as C,Z as w,_ as O,bb as k,bc as l,cc as S,dc as m,ec as M,hb as E,ja as _,kc as p,lc as v,mc as b,rb as g,sb as h,sc as F,uc as T,xb as d,yb as n,zb as t}from"./chunk-XTNRL3Y3.js";var de=()=>[10,25,50],me=()=>["workspaceName"],pe=()=>({"min-width":"50rem"}),ie=()=>({height:"300px"}),re=()=>({display:!1}),oe=r=>({legend:r}),le=()=>({beginAtZero:!0,max:100}),se=r=>({y:r}),ce=(r,a)=>({responsive:!0,maintainAspectRatio:!1,plugins:r,scales:a}),ue=()=>({height:"6px",width:"60px"});function ge(r,a){r&1&&(n(0,"div",6),c(1,"p-progressBar",15),t())}function he(r,a){if(r&1&&(n(0,"div",7)(1,"p-card")(2,"div",16)(3,"div",17),c(4,"i",3),t(),n(5,"div",18)(6,"div",19),l(7,"Health Score Promedio"),t(),n(8,"div",20),l(9),F(10,"number"),t(),n(11,"div",21),l(12),t()()()(),n(13,"p-card")(14,"div",16)(15,"div",22),c(16,"i",23),t(),n(17,"div",18)(18,"div",19),l(19,"Estado de Workspaces"),t(),n(20,"div",20),l(21),t(),n(22,"div",24)(23,"span",25),l(24),t(),n(25,"span",26),l(26),t(),n(27,"span",27),l(28),t()()()()(),n(29,"p-card")(30,"div",16)(31,"div",28),c(32,"i",29),t(),n(33,"div",18)(34,"div",19),l(35,"Sync Success Rate (Hoy)"),t(),n(36,"div",20),l(37),t(),n(38,"div",21),l(39),t()()()(),n(40,"p-card")(41,"div",16)(42,"div",30),c(43,"i",31),t(),n(44,"div",18)(45,"div",19),l(46,"Errores (24h)"),t(),n(47,"div",20),l(48),t(),n(49,"div",21),l(50),t()()()()()),r&2){let e=a;o(9),m("",T(10,11,e.averageHealthScore,"1.0-0"),"/100"),o(3),m(" ",e.getHealthyPercentage(),"% workspaces saludables "),o(9),S(e.totalWorkspaces),o(3),m("\u2713 ",e.healthyWorkspaces),o(2),m("\u26A0 ",e.warningWorkspaces),o(2),m("\u2717 ",e.criticalWorkspaces),o(9),m("",e.getSyncSuccessRate(),"%"),o(2),M(" ",e.successfulSyncsToday,"/",e.totalSyncsToday," exitosos "),o(9),S(e.totalErrors24h),o(2),m("",e.workspacesWithErrors," workspaces afectados")}}function ye(r,a){if(r&1&&(n(0,"div",8)(1,"div",32)(2,"p-card")(3,"div",33)(4,"h3"),l(5,"Health Score por Workspace"),t()(),c(6,"p-chart",34),t()(),n(7,"div",32)(8,"p-card")(9,"div",33)(10,"h3"),l(11,"Sync Success Rate por Workspace"),t()(),c(12,"p-chart",34),t()()()),r&2){let e=u();o(6),P(p(8,ie)),d("data",e.healthScoreChartData())("options",b(15,ce,v(10,oe,p(9,re)),v(13,se,p(12,le)))),o(6),P(p(18,ie)),d("data",e.syncRateChartData())("options",b(25,ce,v(20,oe,p(19,re)),v(23,se,p(22,le))))}}function _e(r,a){r&1&&(n(0,"tr")(1,"th",35),l(2," Workspace "),c(3,"p-sortIcon",36),t(),n(4,"th",37),l(5," Health Score "),c(6,"p-sortIcon",38),t(),n(7,"th",39),l(8," Estado "),c(9,"p-sortIcon",40),t(),n(10,"th",41),l(11,"Sync Status"),t(),n(12,"th",41),l(13,"Circuit Breaker"),t(),n(14,"th",42),l(15," Errores Consecutivos "),c(16,"p-sortIcon",43),t(),n(17,"th",41),l(18,"\xDAltima Sync"),t(),n(19,"th"),l(20,"Acciones"),t()())}function fe(r,a){if(r&1&&c(0,"p-tag",50),r&2){let e=u().$implicit;d("value",e.consecutiveFailures.toString())("severity",e.consecutiveFailures>=3?"danger":"warn")}}function Se(r,a){r&1&&(n(0,"span",49),l(1,"0"),t())}function ve(r,a){if(r&1&&(n(0,"div"),c(1,"i",54),l(2),t()),r&2){let e=u().$implicit,i=u();o(2),m(" ",i.formatRelativeTime(e.lastSuccessfulSync)," ")}}function Ce(r,a){if(r&1&&(n(0,"div",52),c(1,"i",55),l(2),t()),r&2){let e=u().$implicit,i=u();o(2),m(" ",i.formatRelativeTime(e.lastFailedSync)," ")}}function Pe(r,a){r&1&&(n(0,"span",49),l(1,"Sin datos"),t())}function Me(r,a){if(r&1){let e=H();n(0,"tr")(1,"td")(2,"strong"),l(3),t()(),n(4,"td")(5,"div",44)(6,"span",45),l(7),t(),c(8,"p-progressBar",46),t()(),n(9,"td"),c(10,"p-tag",47),t(),n(11,"td",41)(12,"div",48)(13,"div"),l(14),t(),n(15,"small",49),l(16),t()()(),n(17,"td",41),c(18,"p-tag",50),t(),n(19,"td",41),g(20,fe,1,2,"p-tag",50)(21,Se,2,0,"span",49),t(),n(22,"td",41)(23,"div",51),g(24,ve,3,1,"div"),g(25,Ce,3,1,"div",52),g(26,Pe,2,0,"span",49),t()(),n(27,"td")(28,"p-button",53),f("onClick",function(){let s=w(e).$implicit,y=u();return O(y.goToWorkspace(s.workspaceId))}),t()()()}if(r&2){let e=a.$implicit,i=u();o(3),S(e.workspaceName),o(4),S(e.healthScore),o(),P(p(19,ue)),d("value",e.healthScore)("showValue",!1),o(2),d("value",e.healthStatus)("severity",i.getHealthSeverity(e.healthStatus))("icon",e.healthStatus===i.HealthStatus.HEALTHY?"fa fa-check":e.healthStatus===i.HealthStatus.WARNING?"fa fa-exclamation-triangle":"fa fa-times"),o(4),m("",e.getSyncSuccessRate(),"%"),o(2),M(" ",e.successfulSyncs,"/",e.totalSyncs," exitosos "),o(2),d("value",e.circuitBreakerStatus)("severity",i.getCircuitSeverity(e.circuitBreakerStatus)),o(2),h(e.consecutiveFailures>0?20:21),o(4),h(e.lastSuccessfulSync?24:-1),o(),h(e.lastFailedSync?25:-1),o(),h(!e.lastSuccessfulSync&&!e.lastFailedSync?26:-1),o(2),d("text",!0)}}function be(r,a){r&1&&(n(0,"tr")(1,"td",56)(2,"div",57),c(3,"i",58),n(4,"p"),l(5,"No hay m\xE9tricas de salud disponibles"),t()()()())}var x=class r{healthService=C(Z);router=C(R);messageService=C(A);workspaceMetrics=_([]);systemSummary=_(null);isLoading=_(!1);selectedFilter=_("all");healthScoreChartData=_(null);syncRateChartData=_(null);HealthStatus=z;async ngOnInit(){await this.loadHealthData(),this.initializeCharts(),await this.detectAlerts()}async loadHealthData(){this.isLoading.set(!0);try{let[a,e]=await Promise.all([this.healthService.getAllHealthMetrics(),this.healthService.getSystemHealthSummary()]);this.workspaceMetrics.set(a),this.systemSummary.set(e),this.updateCharts(a)}catch(a){let e=a instanceof Error?a.message:"Error loading health data";this.messageService.add({severity:"error",summary:"Error",detail:e})}finally{this.isLoading.set(!1)}}async refreshData(){await this.loadHealthData(),await this.detectAlerts(),this.messageService.add({severity:"success",summary:"Actualizado",detail:"Datos de salud actualizados correctamente"})}async detectAlerts(){try{let a=await this.healthService.detectAndCreateAlerts();a>0&&this.messageService.add({severity:"warn",summary:"Alertas Detectadas",detail:`Se detectaron ${a} problemas de salud`,life:5e3})}catch(a){console.error("[SystemHealth] Error detecting alerts:",a)}}initializeCharts(){let a=getComputedStyle(document.documentElement);this.healthScoreChartData.set({labels:[],datasets:[{label:"Health Score",data:[],backgroundColor:a.getPropertyValue("--green-500"),borderColor:a.getPropertyValue("--green-600"),borderWidth:1}]}),this.syncRateChartData.set({labels:[],datasets:[{label:"Sync Success Rate (%)",data:[],backgroundColor:a.getPropertyValue("--blue-500"),borderColor:a.getPropertyValue("--blue-600"),borderWidth:1}]})}updateCharts(a){let e=getComputedStyle(document.documentElement),i=[...a].sort((s,y)=>s.healthScore-y.healthScore);this.healthScoreChartData.set({labels:i.map(s=>s.workspaceName),datasets:[{label:"Health Score",data:i.map(s=>s.healthScore),backgroundColor:i.map(s=>s.healthScore>=80?e.getPropertyValue("--green-500"):s.healthScore>=50?e.getPropertyValue("--yellow-500"):e.getPropertyValue("--red-500"))}]}),this.syncRateChartData.set({labels:i.map(s=>s.workspaceName),datasets:[{label:"Sync Success Rate (%)",data:i.map(s=>s.getSyncSuccessRate()),backgroundColor:e.getPropertyValue("--blue-500")}]})}getFilteredMetrics(){let a=this.selectedFilter(),e=this.workspaceMetrics();switch(a){case"healthy":return e.filter(i=>i.healthStatus==="healthy");case"warning":return e.filter(i=>i.healthStatus==="warning");case"critical":return e.filter(i=>i.healthStatus==="critical");default:return e}}getHealthSeverity(a){switch(a){case"healthy":return"success";case"warning":return"warn";case"critical":return"danger";default:return"info"}}getCircuitSeverity(a){switch(a){case"closed":return"success";case"half-open":return"warn";case"open":return"danger";default:return"info"}}goToWorkspace(a){this.router.navigate(["/workspace",a])}setFilter(a){this.selectedFilter.set(a)}formatRelativeTime(a){if(!a)return"Nunca";let i=new Date().getTime()-a.getTime(),s=Math.floor(i/6e4);if(s<1)return"Justo ahora";if(s<60)return`Hace ${s} minutos`;let y=Math.floor(s/60);return y<24?`Hace ${y} horas`:`Hace ${Math.floor(y/24)} d\xEDas`}formatPercentage(a){return`${Math.round(a)}%`}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-system-health"]],decls:21,vars:27,consts:[[1,"fade-in"],[1,"p-toolbar-group-start"],[1,"app-page-title"],[1,"fa","fa-heart"],[1,"p-toolbar-group-end"],["label","Actualizar","icon","fa fa-refresh","severity","secondary","size","small","pTooltip","Actualizar m\xE9tricas de salud","tooltipPosition","bottom",3,"onClick","outlined","loading"],[1,"loading-container"],[1,"summary-cards"],[1,"charts-section"],[1,"filter-toolbar"],["size","small",3,"onClick","label","severity","outlined"],["currentPageReportTemplate","Mostrando {first} a {last} de {totalRecords} workspaces",1,"p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","globalFilterFields","tableStyle"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["mode","indeterminate"],[1,"stat-card"],[1,"stat-icon","health"],[1,"stat-content"],[1,"stat-label"],[1,"stat-value"],[1,"stat-subtitle"],[1,"stat-icon","workspaces"],[1,"fa","fa-briefcase"],[1,"stat-breakdown"],[1,"success"],[1,"warning"],[1,"danger"],[1,"stat-icon","sync"],[1,"fa","fa-refresh"],[1,"stat-icon","errors"],[1,"fa","fa-exclamation-triangle"],[1,"chart-card"],[1,"chart-header"],["type","bar",3,"data","options"],["pSortableColumn","workspaceName"],["field","workspaceName"],["pSortableColumn","healthScore"],["field","healthScore"],["pSortableColumn","healthStatus"],["field","healthStatus"],[1,"hidden-sm-down"],["pSortableColumn","consecutiveFailures",1,"hidden-sm-down"],["field","consecutiveFailures"],[1,"health-score-cell"],[1,"score-value"],[3,"value","showValue"],[3,"value","severity","icon"],[1,"sync-status"],[1,"text-muted"],[3,"value","severity"],[1,"last-sync"],[1,"text-danger"],["icon","fa fa-arrow-right","size","small","pTooltip","Ver detalles del workspace",3,"onClick","text"],[1,"fa","fa-check-circle","text-success"],[1,"fa","fa-times-circle"],["colspan","9",2,"text-align","center"],[1,"empty-state"],[1,"fa","fa-info-circle"]],template:function(e,i){if(e&1&&(n(0,"div",0)(1,"p-toolbar")(2,"div",1)(3,"h2",2),c(4,"i",3),l(5," System Health "),t()(),n(6,"div",4)(7,"p-button",5),f("onClick",function(){return i.refreshData()}),t()()(),g(8,ge,2,0,"div",6),g(9,he,51,14,"div",7),g(10,ye,13,28,"div",8),n(11,"div",9)(12,"p-button",10),f("onClick",function(){return i.setFilter("all")}),t(),n(13,"p-button",10),f("onClick",function(){return i.setFilter("healthy")}),t(),n(14,"p-button",10),f("onClick",function(){return i.setFilter("warning")}),t(),n(15,"p-button",10),f("onClick",function(){return i.setFilter("critical")}),t()(),n(16,"p-card")(17,"p-table",11),E(18,_e,21,0,"ng-template",12)(19,Me,29,20,"ng-template",13)(20,be,6,0,"ng-template",14),t()()()),e&2){let s;o(7),d("outlined",!0)("loading",i.isLoading()),o(),h(i.isLoading()?8:-1),o(),h((s=i.systemSummary())?9:-1,s),o(),h(!i.isLoading()&&i.workspaceMetrics().length>0?10:-1),o(2),d("label","Todos ("+i.workspaceMetrics().length+")")("severity",i.selectedFilter()==="all"?"primary":"secondary")("outlined",i.selectedFilter()!=="all"),o(),d("label","Saludables ("+i.healthService.healthyWorkspaces().length+")")("severity",i.selectedFilter()==="healthy"?"success":"secondary")("outlined",i.selectedFilter()!=="healthy"),o(),d("label","Advertencias ("+i.healthService.warningWorkspaces().length+")")("severity",i.selectedFilter()==="warning"?"warn":"secondary")("outlined",i.selectedFilter()!=="warning"),o(),d("label","Cr\xEDticos ("+i.healthService.criticalWorkspaces().length+")")("severity",i.selectedFilter()==="critical"?"danger":"secondary")("outlined",i.selectedFilter()!=="critical"),o(2),d("value",i.getFilteredMetrics())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",p(24,de))("globalFilterFields",p(25,me))("tableStyle",p(26,pe))}},dependencies:[D,ae,ne,N,j,Y,V,W,te,Q,X,ee,G,$,B,L,U,J,K,q,I],styles:[".loading-container[_ngcontent-%COMP%]{margin:2rem 0}.summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin:1.5rem 0}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:1rem}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.75rem}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon.health[_ngcontent-%COMP%]{background:#10b98126;color:#10b981;border:1px solid rgba(16,185,129,.2)}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon.workspaces[_ngcontent-%COMP%]{background:#3b82f626;color:#3b82f6;border:1px solid rgba(59,130,246,.2)}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon.sync[_ngcontent-%COMP%]{background:#8b5cf626;color:#8b5cf6;border:1px solid rgba(139,92,246,.2)}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon.errors[_ngcontent-%COMP%]{background:#ef444426;color:#ef4444;border:1px solid rgba(239,68,68,.2)}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]{flex:1}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-color-secondary);margin-bottom:.25rem}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:var(--text-color);margin-bottom:.25rem}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-subtitle[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-color-secondary)}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-breakdown[_ngcontent-%COMP%]{display:flex;gap:.75rem;font-size:.875rem;margin-top:.25rem}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-breakdown[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]{color:var(--green-600);font-weight:600}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-breakdown[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{color:var(--yellow-600);font-weight:600}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-breakdown[_ngcontent-%COMP%]   .danger[_ngcontent-%COMP%]{color:var(--red-600);font-weight:600}.charts-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(500px,1fr));gap:1.5rem;margin:1.5rem 0}.charts-section[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]   .chart-header[_ngcontent-%COMP%]{margin-bottom:1rem}.charts-section[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]   .chart-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:600;color:var(--text-color)}.filter-toolbar[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin:1.5rem 0;flex-wrap:wrap}.health-score-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.health-score-cell[_ngcontent-%COMP%]   .score-value[_ngcontent-%COMP%]{font-weight:600;font-size:1rem;min-width:35px}.sync-status[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.sync-status[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:.75rem}.last-sync[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;font-size:.85rem}.last-sync[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.25rem}.text-muted[_ngcontent-%COMP%]{color:var(--text-color-secondary)}.text-success[_ngcontent-%COMP%]{color:var(--green-600)}.text-danger[_ngcontent-%COMP%]{color:var(--red-600)}.empty-state[_ngcontent-%COMP%]{padding:3rem;text-align:center}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;color:var(--text-color-secondary);margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-size:1rem}"]})};export{x as default};

import{a as ee,b as te}from"./chunk-PEAVYS3Q.js";import{b as Z}from"./chunk-EXPJVITU.js";import{b as Q,c as X}from"./chunk-DUNBGOMI.js";import{e as re,f as ne,g as ae,h as oe}from"./chunk-PX2VNWV3.js";import{b as ie}from"./chunk-OYI76HVB.js";import"./chunk-OOKHGSBK.js";import{a as H,b as K}from"./chunk-T2TEUMJK.js";import{a as Y,b as q,c as G}from"./chunk-LOKH2QTJ.js";import"./chunk-5WKTPFE2.js";import"./chunk-OL6EOTCO.js";import{k as A}from"./chunk-HD6MQK7W.js";import{d as L,e as N,f as z,g as R,h as $,i as F}from"./chunk-SQZEKQLI.js";import{a as U,b as J}from"./chunk-ICJIXMS7.js";import"./chunk-DTZPPQAO.js";import{Aa as M,Qb as B,Rb as j,pb as O,qb as V,sa as C,w as I,wa as h}from"./chunk-B5FRUK7K.js";import{$b as y,Fb as v,Kb as m,Lb as c,Oa as s,T as f,Y as u,Z as g,_b as l,ab as b,ac as W,fc as P,gb as S,gc as w,ia as k,pb as E,qb as T,vb as d,wb as i,wc as D,xb as r,yb as _}from"./chunk-PY5EWUYY.js";var se=()=>[10,25,50],ce=()=>["name","description"];function le(o,e){if(o&1){let t=v();i(0,"div",9)(1,"h2",10),l(2,"Workspaces"),r(),i(3,"div",11)(4,"p-button",12),m("onClick",function(){u(t);let a=c();return g(a.syncAllWorkspaces())}),r(),i(5,"p-button",13),m("onClick",function(){u(t);let a=c();return g(a.createWorkspace())}),r()()()}if(o&2){let t=c();s(4),d("outlined",!0)("loading",t.isSyncingAll())}}function pe(o,e){o&1&&(i(0,"tr")(1,"th",14),l(2,"Nombre "),_(3,"p-sortIcon",15),r(),i(4,"th",16),l(5,"Estado "),_(6,"p-sortIcon",17),r(),i(7,"th",18),l(8,"\xDAltima Sync "),_(9,"p-sortIcon",19),r(),i(10,"th",20),l(11,"Creado "),_(12,"p-sortIcon",21),r(),i(13,"th"),l(14,"Acciones"),r()())}function de(o,e){if(o&1){let t=v();i(0,"p-button",30),m("onClick",function(){u(t);let a=c().$implicit,p=c();return g(p.disableWorkspace(a))}),r()}o&2&&d("rounded",!0)("text",!0)}function me(o,e){if(o&1){let t=v();i(0,"tr")(1,"td")(2,"strong"),l(3),r(),i(4,"div",22),l(5),r()(),i(6,"td"),_(7,"p-tag",23),r(),i(8,"td"),l(9),r(),i(10,"td"),l(11),r(),i(12,"td")(13,"div",24)(14,"p-button",25),m("onClick",function(){let a=u(t).$implicit,p=c();return g(p.testConnection(a))}),r(),i(15,"p-button",26),m("onClick",function(){let a=u(t).$implicit,p=c();return g(p.syncNow(a))}),r(),i(16,"p-button",27),m("onClick",function(){let a=u(t).$implicit,p=c();return g(p.editWorkspace(a))}),r(),E(17,de,1,2,"p-button",28),i(18,"p-button",29),m("onClick",function(){let a=u(t).$implicit,p=c();return g(p.deleteWorkspace(a))}),r()()()()}if(o&2){let t=e.$implicit,n=c();s(3),y(t.name),s(2),W(" ",t.description||"Sin descripci\xF3n"," "),s(2),d("value",n.getStatusLabel(t.status))("severity",n.getStatusSeverity(t.status))("pTooltip",n.getStatusTooltip(t.status,t.lastError)),s(2),y(n.formatDate(t.lastSyncAt)),s(2),y(n.formatDate(t.createdAt)),s(3),d("rounded",!0)("text",!0)("loading",n.isTestingConnection()===t.id),s(),d("rounded",!0)("text",!0)("loading",n.isSyncing()===t.id),s(),d("rounded",!0)("text",!0),s(),T(t.status!=="disabled"?17:-1),s(),d("rounded",!0)("text",!0)}}function ue(o,e){if(o&1){let t=v();i(0,"tr")(1,"td",31)(2,"div",32),_(3,"i",33),i(4,"p",34),l(5,"No se encontraron workspaces"),r(),i(6,"p-button",35),m("onClick",function(){u(t);let a=c();return g(a.createWorkspace())}),r()()()()}}var x=class o{workspaceService=f(A);router=f(I);confirmationService=f(C);messageService=f(h);workspaces=this.workspaceService.workspaces;isLoading=this.workspaceService.isLoading;searchTerm=k("");isTestingConnection=k(null);isSyncing=k(null);isSyncingAll=k(!1);ngOnInit(){this.loadWorkspaces()}async loadWorkspaces(){try{await this.workspaceService.getAllWorkspaces()}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los workspaces"})}}filteredWorkspaces=D(()=>{let e=this.searchTerm().toLowerCase();return e?this.workspaces().filter(t=>t.name.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)):this.workspaces()});createWorkspace(){this.router.navigate(["/workspaces/create"])}editWorkspace(e){this.router.navigate(["/workspaces/edit",e.id])}disableWorkspace(e){this.confirmationService.confirm({message:`\xBFDesactivar el workspace "${e.name}"? Se mantendr\xE1n todos los datos pero dejar\xE1 de sincronizarse.`,header:"Confirmar Desactivaci\xF3n",icon:"pi pi-exclamation-triangle",acceptLabel:"Desactivar",rejectLabel:"Cancelar",acceptButtonStyleClass:"p-button-warning",accept:async()=>{try{await this.workspaceService.updateWorkspace(e.id,{status:"DISABLED"}),this.messageService.add({severity:"success",summary:"Workspace Desactivado",detail:`El workspace "${e.name}" ha sido desactivado`}),await this.loadWorkspaces()}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo desactivar el workspace"})}}})}async testConnection(e){try{this.isTestingConnection.set(e.id),await this.workspaceService.testConnection(e.id),this.messageService.add({severity:"success",summary:"Conexi\xF3n Exitosa",detail:`El token de "${e.name}" es v\xE1lido`}),await this.loadWorkspaces()}catch(t){this.messageService.add({severity:"error",summary:"Error de Conexi\xF3n",detail:t instanceof Error?t.message:"No se pudo conectar a Hostinger"})}finally{this.isTestingConnection.set(null)}}async syncNow(e){try{this.isSyncing.set(e.id),await this.workspaceService.syncNow(e.id),this.messageService.add({severity:"success",summary:"Sincronizaci\xF3n Completada",detail:`El workspace "${e.name}" se ha sincronizado correctamente`}),await this.loadWorkspaces()}catch(t){this.messageService.add({severity:"error",summary:"Error de Sincronizaci\xF3n",detail:t instanceof Error?t.message:"No se pudo sincronizar"})}finally{this.isSyncing.set(null)}}getStatusTooltip(e,t){switch(e){case"ACTIVE":return"Workspace activo y funcionando correctamente";case"INVALID_TOKEN":return t||"El token de Hostinger es inv\xE1lido o ha expirado. Por favor, actual\xEDcelo.";case"RATE_LIMITED":return"Se ha excedido el l\xEDmite de solicitudes a la API. Intente m\xE1s tarde.";case"ERROR":return t||"Error al conectar con Hostinger. Verifique la configuraci\xF3n.";case"DISABLED":return"Workspace desactivado. No se sincronizar\xE1 autom\xE1ticamente.";default:return e}}deleteWorkspace(e){this.confirmationService.confirm({message:`\xBFEst\xE1s seguro de eliminar el workspace "${e.name}"? Esta acci\xF3n no se puede deshacer.`,header:"Confirmar Eliminaci\xF3n",icon:"pi pi-trash",acceptButtonStyleClass:"p-button-danger",accept:async()=>{try{await this.workspaceService.deleteWorkspace(e.id),this.messageService.add({severity:"success",summary:"Workspace Eliminado",detail:`El workspace "${e.name}" ha sido eliminado`})}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el workspace"})}}})}getStatusSeverity(e){switch(e){case"ACTIVE":return"success";case"INVALID_TOKEN":case"ERROR":return"danger";case"RATE_LIMITED":return"warn";case"DISABLED":return"info";default:return"info"}}getStatusLabel(e){switch(e){case"ACTIVE":return"Activo";case"INVALID_TOKEN":return"Token Inv\xE1lido";case"RATE_LIMITED":return"L\xEDmite Excedido";case"ERROR":return"Error";case"DISABLED":return"Desactivado";default:return e}}formatDate(e){return e?"seconds"in e?new Date(e.seconds*1e3).toLocaleDateString("es-ES"):e.toLocaleDateString("es-ES"):"Nunca"}async syncAllWorkspaces(){this.confirmationService.confirm({message:"\xBFDeseas sincronizar TODOS los workspaces activos? Esto puede tomar varios minutos.",header:"Confirmar Sincronizaci\xF3n Batch",icon:"pi pi-exclamation-triangle",acceptLabel:"S\xED, sincronizar",rejectLabel:"Cancelar",accept:async()=>{try{this.isSyncingAll.set(!0),this.messageService.add({severity:"info",summary:"Sincronizaci\xF3n Iniciada",detail:"Sincronizando todos los workspaces activos...",life:3e3});let e=await this.workspaceService.syncAllWorkspaces();this.messageService.add({severity:"success",summary:"Sincronizaci\xF3n Completada",detail:`
              Total: ${e.totalWorkspaces} workspaces
              \u2705 \xC9xitos: ${e.successCount}
              \u274C Fallos: ${e.failureCount}
              \u23ED\uFE0F Saltados: ${e.skippedCount}
              \u{1F6AB} Deshabilitados: ${e.disabledCount}
            `,life:8e3}),await this.loadWorkspaces()}catch(e){this.messageService.add({severity:"error",summary:"Error en Sincronizaci\xF3n",detail:e instanceof Error?e.message:"Error desconocido",life:5e3})}finally{this.isSyncingAll.set(!1)}}})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=b({type:o,selectors:[["app-workspaces"]],features:[P([C,h])],decls:13,vars:11,consts:[["role","main","aria-label","Gesti\xF3n de workspaces",1,"workspaces-container"],["pTemplate","header"],["role","search",1,"search-container","mb-4"],["iconPosition","left"],["styleClass","pi pi-search"],["pInputText","","type","text","placeholder","Buscar workspaces...","aria-label","Buscar workspaces por nombre o descripci\xF3n",1,"w-full",3,"input","value"],["currentPageReportTemplate","Mostrando {first} a {last} de {totalRecords} workspaces","styleClass","p-datatable-striped","responsiveLayout","scroll",3,"value","loading","paginator","rows","rowsPerPageOptions","showCurrentPageReport","globalFilterFields"],["pTemplate","body"],["pTemplate","emptymessage"],["role","banner",1,"page-header"],["id","workspaces-heading",1,"m-0"],["role","group","aria-label","Acciones principales",1,"flex","gap-2"],["label","\u{1F9EA} Sincronizar Todos","icon","pi pi-sync","severity","secondary","pTooltip","TEMP: Test batch sync (producci\xF3n usa cron job a las 03:00 AM)","tooltipPosition","bottom","aria-label","Sincronizar todos los workspaces (caracter\xEDstica temporal de prueba)",3,"onClick","outlined","loading"],["label","Nuevo Workspace","icon","pi pi-plus","aria-label","Crear nuevo workspace",3,"onClick"],["pSortableColumn","name"],["field","name"],["pSortableColumn","status"],["field","status"],["pSortableColumn","lastSyncAt"],["field","lastSyncAt"],["pSortableColumn","createdAt"],["field","createdAt"],[1,"text-sm","text-gray-500"],[3,"value","severity","pTooltip"],[1,"flex","gap-2"],["icon","pi pi-wifi","severity","secondary","pTooltip","Test connection",3,"onClick","rounded","text","loading"],["icon","pi pi-refresh","severity","secondary","pTooltip","Sync now",3,"onClick","rounded","text","loading"],["icon","pi pi-pencil","severity","info","pTooltip","Editar",3,"onClick","rounded","text"],["icon","pi pi-ban","severity","warn","pTooltip","Desactivar",3,"rounded","text"],["icon","pi pi-trash","severity","danger","pTooltip","Eliminar",3,"onClick","rounded","text"],["icon","pi pi-ban","severity","warn","pTooltip","Desactivar",3,"onClick","rounded","text"],["colspan","5",1,"text-center"],[1,"py-5"],[1,"pi","pi-inbox","text-4xl","text-gray-400"],[1,"mt-3","text-gray-500"],["label","Crear Primer Workspace","icon","pi pi-plus","styleClass","mt-3",3,"onClick"]],template:function(t,n){t&1&&(i(0,"div",0),_(1,"p-toast")(2,"p-confirmDialog"),i(3,"p-card"),S(4,le,6,2,"ng-template",1),i(5,"div",2)(6,"p-iconField",3),_(7,"p-inputIcon",4),i(8,"input",5),m("input",function(p){return n.searchTerm.set(p.target.value)}),r()()(),i(9,"p-table",6),S(10,pe,15,0,"ng-template",1)(11,me,19,18,"ng-template",7)(12,ue,7,0,"ng-template",8),r()()()),t&2&&(d("@fadeIn",void 0),s(8),d("value",n.searchTerm()),s(),d("value",n.filteredWorkspaces())("loading",n.isLoading())("paginator",!0)("rows",10)("rowsPerPageOptions",w(9,se))("showCurrentPageReport",!0)("globalFilterFields",w(10,ce)))},dependencies:[oe,re,M,ne,ae,V,O,J,U,K,H,ie,te,ee,X,Q,j,B,Z,R,z,F,$,N,L],styles:[".workspaces-container[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto}.workspaces-container.ng-animating[_ngcontent-%COMP%]{overflow:hidden}.workspaces-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1.5rem;background:var(--surface-card);animation:_ngcontent-%COMP%_slideDown .3s ease-out}.workspaces-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-color)}.workspaces-container[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]{max-width:400px}.workspaces-container[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]     input{transition:all .3s cubic-bezier(.4,0,.2,1)}.workspaces-container[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]     input:focus{transform:translateY(-1px);box-shadow:0 4px 12px #0000001a}.workspaces-container[_ngcontent-%COMP%]   .text-overflow[_ngcontent-%COMP%]{display:block;max-width:300px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}"],data:{animation:[Y,q,G]},changeDetection:0})};export{x as default};

import{a as ne,b as ae,c as ce,d as pe}from"./chunk-6TVFSO7T.js";import{b as re,c as le}from"./chunk-3XL55OQL.js";import{c as me}from"./chunk-SBHPNX7A.js";import"./chunk-XDZX4QP4.js";import"./chunk-F4EQ5Z5M.js";import{c as ge,d as ue,e as _e,f as Ce}from"./chunk-ARJL2RPA.js";import{a as se,b as de}from"./chunk-HJGWK7Y3.js";import"./chunk-FGQ7KWVK.js";import{a as ee,b as te}from"./chunk-IE2YMZCJ.js";import"./chunk-H6LD2ER2.js";import{d as G,e as $,l as X,m as Z}from"./chunk-CFZHJV6V.js";import{a as ie,b as oe}from"./chunk-X7CD7GNO.js";import"./chunk-DFVSDEUQ.js";import{Eb as q,Mb as J,Nb as Q,f as B,nb as L,ob as A,s as U,u as H,ua as k,xb as j,ya as K,zb as Y}from"./chunk-TZ5WZBNW.js";import{$b as w,Fb as v,Jb as _,Kb as p,Oa as l,T as b,Ub as V,Y as g,Yb as N,Z as u,Zb as d,_b as h,ab as x,bc as T,cc as P,dc as E,ec as F,fc as y,gb as I,ia as S,nc as W,pb as C,pc as R,qb as f,vb as m,vc as z,wb as i,wc as O,xb as o,yb as s}from"./chunk-ZVXIGZDY.js";var Se=()=>[10,25,50,100],xe=()=>["action","actorEmail","workspaceId"],he=()=>({"min-width":"70rem"});function ye(n,t){if(n&1){let e=v();i(0,"div",6)(1,"div",7)(2,"h2"),s(3,"i",8),d(4," Audit Logs"),o(),s(5,"p-chip",9),o(),i(6,"div",10)(7,"span",11),s(8,"i",12),i(9,"input",13),_("input",function(r){g(e),p();let c=V(1);return u(c.filterGlobal(r.target.value,"contains"))}),o()(),i(10,"p-select",14),E("ngModelChange",function(r){g(e);let c=p();return P(c.selectedAction,r)||(c.selectedAction=r),u(r)}),_("onChange",function(r){g(e);let c=p();return u(c.onActionFilter(r))}),o(),i(11,"p-select",15),E("ngModelChange",function(r){g(e);let c=p();return P(c.selectedStatus,r)||(c.selectedStatus=r),u(r)}),_("onChange",function(r){g(e);let c=p();return u(c.onStatusFilter(r))}),o()()()}if(n&2){let e=p();l(5),m("label",e.auditLogs().length.toString()),l(5),m("options",e.actionOptions),T("ngModel",e.selectedAction),m("showClear",!0),l(),m("options",e.statusOptions),T("ngModel",e.selectedStatus),m("showClear",!0)}}function Le(n,t){n&1&&(i(0,"tr")(1,"th",16),d(2," Fecha "),s(3,"p-sortIcon",17),o(),i(4,"th",18),d(5," Acci\xF3n "),s(6,"p-sortIcon",19),o(),i(7,"th",20),d(8," Usuario "),s(9,"p-sortIcon",21),o(),i(10,"th",22),d(11,"Workspace"),o(),i(12,"th",23),d(13,"Estado"),o(),i(14,"th",23),d(15,"Acciones"),o()())}function Ae(n,t){if(n&1&&s(0,"p-chip",29),n&2){let e=p().$implicit;m("label",e.workspaceId)}}function Me(n,t){n&1&&(i(0,"span",30),d(1,"Sistema"),o())}function we(n,t){if(n&1){let e=v();i(0,"tr")(1,"td"),s(2,"i",24),d(3),W(4,"date"),o(),i(5,"td")(6,"div",25),s(7,"i",26),i(8,"span"),d(9),o()()(),i(10,"td")(11,"div",27),s(12,"i",28),d(13),o()(),i(14,"td"),C(15,Ae,1,1,"p-chip",29)(16,Me,2,0,"span",30),o(),i(17,"td",23),s(18,"p-tag",31),o(),i(19,"td",23)(20,"p-button",32),_("onClick",function(){let r=g(e).$implicit,c=p();return u(c.viewDetails.emit(r))}),o()()()}if(n&2){let e=t.$implicit,a=p();l(3),w(" ",R(4,11,e.createdAt.toDate(),"dd/MM/yyyy HH:mm:ss")," "),l(4),N(e.getActionIcon()),l(2),h(e.getActionLabel()),l(4),w(" ",e.actorEmail||e.actorUid," "),l(2),f(e.workspaceId?15:16),l(3),m("value",e.getStatusLabel())("severity",e.getSeverity())("icon",a.getStatusIcon(e.status)),l(2),m("rounded",!0)("text",!0)}}function Te(n,t){n&1&&(i(0,"tr")(1,"td",33),s(2,"i",34),i(3,"p",35),d(4," No se encontraron registros de auditor\xEDa "),o()()())}var M=class n{auditLogs=O.required();isLoading=O(!1);viewDetails=z();selectedAction=S(null);selectedStatus=S(null);actionOptions=[{label:"Crear Workspace",value:"workspace.create"},{label:"Actualizar Workspace",value:"workspace.update"},{label:"Deshabilitar Workspace",value:"workspace.disable"},{label:"Guardar Token",value:"token.save"},{label:"Probar Conexi\xF3n",value:"token.test"},{label:"Sincronizaci\xF3n Manual",value:"sync.manual"},{label:"Sincronizaci\xF3n Programada",value:"sync.scheduled"},{label:"Generar Alertas",value:"alert.generate"}];statusOptions=[{label:"\xC9xito",value:"success"},{label:"Fallo",value:"failed"},{label:"Parcial",value:"partial"}];onActionFilter(t){this.selectedAction.set(t.value)}onStatusFilter(t){this.selectedStatus.set(t.value)}getStatusIcon(t){return{success:"pi pi-check-circle",failure:"pi pi-times-circle",partial:"pi pi-exclamation-circle"}[t]||"pi pi-info-circle"}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=x({type:n,selectors:[["app-audit-logs-table"]],inputs:{auditLogs:[1,"auditLogs"],isLoading:[1,"isLoading"]},outputs:{viewDetails:"viewDetails"},decls:6,vars:11,consts:[["dt",""],["styleClass","p-datatable-sm",3,"value","loading","paginator","rows","rowsPerPageOptions","globalFilterFields","tableStyle","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"table-header"],[1,"header-left"],[1,"pi","pi-file"],["styleClass","ml-2",3,"label"],[1,"header-right"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Buscar...",3,"input"],["placeholder","Todas las acciones","styleClass","ml-2",3,"ngModelChange","onChange","options","ngModel","showClear"],["placeholder","Todos los estados","styleClass","ml-2",3,"ngModelChange","onChange","options","ngModel","showClear"],["pSortableColumn","createdAt"],["field","createdAt"],["pSortableColumn","action"],["field","action"],["pSortableColumn","actorEmail"],["field","actorEmail"],["pSortableColumn","workspaceId"],[2,"text-align","center"],[1,"pi","pi-calendar","mr-2"],[1,"action-cell"],[1,"mr-2"],[1,"actor-cell"],[1,"pi","pi-user","mr-2"],["styleClass","workspace-chip",3,"label"],[1,"text-muted"],[3,"value","severity","icon"],["icon","pi pi-eye","severity","secondary","pTooltip","Ver detalles",3,"onClick","rounded","text"],["colspan","6",2,"text-align","center","padding","3rem"],[1,"pi","pi-inbox",2,"font-size","3rem","color","var(--text-color-secondary)"],[2,"margin-top","1rem","color","var(--text-color-secondary)"]],template:function(e,a){e&1&&(i(0,"p-table",1,0),I(2,ye,12,7,"ng-template",2)(3,Le,16,0,"ng-template",3)(4,we,21,14,"ng-template",4)(5,Te,5,0,"ng-template",5),o()),e&2&&m("value",a.auditLogs())("loading",a.isLoading())("paginator",!0)("rows",10)("rowsPerPageOptions",y(8,Se))("globalFilterFields",y(9,xe))("tableStyle",y(10,he))("rowHover",!0)},dependencies:[Ce,ge,K,ue,_e,A,L,pe,ce,te,ee,$,G,Q,J,Z,X,q,j,Y,B],styles:[".table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--surface-100);border-radius:8px;margin-bottom:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.action-cell[_ngcontent-%COMP%], .actor-cell[_ngcontent-%COMP%]{display:flex;align-items:center}.workspace-chip[_ngcontent-%COMP%]{font-size:.875rem}.text-muted[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-style:italic}"],changeDetection:0})};function Pe(n,t){n&1&&(i(0,"p-card"),s(1,"p-skeleton",10),o())}function Ee(n,t){if(n&1){let e=v();i(0,"p-card")(1,"div",11),s(2,"i",12),i(3,"h2"),d(4,"Error al cargar audit logs"),o(),i(5,"p"),d(6),o(),i(7,"p-button",13),_("onClick",function(){g(e);let r=p();return u(r.loadAuditLogs())}),o()()()}if(n&2){let e=p();l(6),h(e.error())}}function Oe(n,t){if(n&1){let e=v();i(0,"app-audit-logs-table",14),_("viewDetails",function(r){g(e);let c=p();return u(c.onViewDetails(r))}),o()}if(n&2){let e=p();m("auditLogs",e.auditLogs())("isLoading",e.isLoading())}}var D=class n{auditLogService=b(me);route=b(U);router=b(H);messageService=b(k);auditLogs=this.auditLogService.auditLogs;isLoading=this.auditLogService.isLoading;error=this.auditLogService.error;workspaceId=S(void 0);ngOnInit(){this.route.paramMap.subscribe(t=>{let e=t.get("workspaceId");e&&this.workspaceId.set(e),this.loadAuditLogs()})}async loadAuditLogs(){try{let t=this.workspaceId();t?await this.auditLogService.getWorkspaceAuditLogs(t):await this.auditLogService.getRecentAuditLogs()}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los audit logs"})}}onViewDetails(t){let e=t.meta?JSON.stringify(t.meta,null,2):"N/A";this.messageService.add({severity:"info",summary:`${t.getActionLabel()} - ${t.getStatusLabel()}`,detail:`Usuario: ${t.actorEmail||t.actorUid}
${t.errorMessage||e}`,life:8e3})}goBack(){let t=this.workspaceId();t?this.router.navigate(["/w",t]):this.router.navigate(["/dashboard"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=x({type:n,selectors:[["app-audit-logs-page"]],features:[F([k])],decls:14,vars:6,consts:[[1,"audit-logs-container"],["styleClass","audit-logs-toolbar"],[1,"p-toolbar-group-start"],[1,"page-title"],[1,"pi","pi-file"],[1,"p-toolbar-group-end"],["label","Actualizar","icon","pi pi-refresh","pTooltip","Actualizar logs","tooltipPosition","bottom",3,"onClick","outlined","loading"],["label","Volver","icon","pi pi-arrow-left","severity","secondary","styleClass","ml-2",3,"onClick","outlined"],[1,"audit-logs-content"],[3,"auditLogs","isLoading"],["height","400px"],[1,"error-state"],[1,"pi","pi-exclamation-triangle"],["label","Reintentar","icon","pi pi-refresh",3,"onClick"],[3,"viewDetails","auditLogs","isLoading"]],template:function(e,a){e&1&&(i(0,"div",0),s(1,"p-toast"),i(2,"p-toolbar",1)(3,"div",2)(4,"h1",3),s(5,"i",4),d(6," Audit Logs "),o()(),i(7,"div",5)(8,"p-button",6),_("onClick",function(){return a.loadAuditLogs()}),o(),i(9,"p-button",7),_("onClick",function(){return a.goBack()}),o()()(),i(10,"div",8),C(11,Pe,2,0,"p-card"),C(12,Ee,8,1,"p-card"),C(13,Oe,1,2,"app-audit-logs-table",9),o()()),e&2&&(l(8),m("outlined",!0)("loading",a.isLoading()),l(),m("outlined",!0),l(2),f(a.isLoading()&&a.auditLogs().length===0?11:-1),l(),f(a.error()&&!a.isLoading()?12:-1),l(),f(a.auditLogs().length>0||!a.isLoading()&&!a.error()?13:-1))},dependencies:[oe,ie,A,L,ae,ne,le,re,de,se,M],styles:[".audit-logs-container[_ngcontent-%COMP%]{min-height:100vh;background-color:var(--surface-50)}.audit-logs-toolbar[_ngcontent-%COMP%]{box-shadow:0 2px 4px #00000014;margin-bottom:2rem;background:#fff;border-bottom:1px solid var(--surface-200)}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;font-weight:700;font-size:1.5rem;color:var(--text-color);margin:0}.page-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.audit-logs-content[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:0 2rem 2rem}.error-state[_ngcontent-%COMP%]{text-align:center;padding:3rem}.error-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--red-500);margin-bottom:1rem}.error-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--text-color);margin-bottom:.5rem}.error-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin-bottom:2rem}@media(max-width:768px){.page-title[_ngcontent-%COMP%]{font-size:1.25rem}.audit-logs-content[_ngcontent-%COMP%]{padding:0 1rem 1rem}}"],changeDetection:0})};export{D as default};

import{a as te,b as ne}from"./chunk-MKYEOAI6.js";import{a as Q,b as U}from"./chunk-LZAUEQAN.js";import{b as X,c as Y}from"./chunk-FYGEUYEJ.js";import{b as le}from"./chunk-KZCX5W5D.js";import{f as ie}from"./chunk-5R2X6POM.js";import"./chunk-XXMBZZ37.js";import"./chunk-NHWKIFHZ.js";import{g as oe,h as re,i as ae,j as se}from"./chunk-GCQ2WIT6.js";import{a as Z,b as ee}from"./chunk-XNM27DCK.js";import"./chunk-PPZFH2ZV.js";import{a as G,b as W}from"./chunk-2MAXEO6Q.js";import"./chunk-Q5HFPYVW.js";import"./chunk-46UKYMVD.js";import"./chunk-OL6EOTCO.js";import"./chunk-6BTVTWSQ.js";import{v as j,w as q}from"./chunk-Z4BNMZT3.js";import"./chunk-47X5BFEM.js";import{c as A,d as H}from"./chunk-JUILAC2W.js";import{a as J,b as K}from"./chunk-SPDGIFFF.js";import"./chunk-TOC7PNXQ.js";import"./chunk-JNP63KUK.js";import{Ia as P,Ma as F,gb as C,hb as x,i as z,x as B,z as N}from"./chunk-WQRABBEY.js";import{Ab as a,Cc as T,Dc as w,Hb as S,Mb as u,Ob as c,Pa as l,U as v,Yb as k,Z as g,_,bb as b,bc as s,cc as O,dc as V,hb as D,ja as M,jc as I,kc as R,rb as y,sb as f,sc as L,uc as $,xb as m,yb as n,zb as o}from"./chunk-XTNRL3Y3.js";var de=()=>[10,25,50],ue=()=>({"min-width":"70rem"});function ge(i,t){if(i&1){let e=S();n(0,"div",6)(1,"div",7)(2,"h2"),a(3,"i",8),s(4," Historial de Sincronizaciones"),o(),a(5,"p-chip",9),o(),n(6,"div",10)(7,"span",11),a(8,"i",12),n(9,"input",13),u("input",function(p){g(e),c();let d=k(1);return _(d.filterGlobal(p.target.value,"contains"))}),o()()()()}if(i&2){let e=c();l(5),m("label",e.syncRuns().length.toString())}}function _e(i,t){i&1&&(n(0,"tr")(1,"th",14),s(2," Inicio "),a(3,"p-sortIcon",15),o(),n(4,"th"),s(5,"Duraci\xF3n"),o(),n(6,"th",16),s(7,"Dominios"),o(),n(8,"th",16),s(9,"Suscripciones"),o(),n(10,"th",16),s(11,"Estado"),o(),n(12,"th"),s(13,"Errores"),o(),n(14,"th",16),s(15,"Acciones"),o()())}function ye(i,t){if(i&1&&a(0,"p-chip",18),i&2){let e=c().$implicit,r=c();m("label",r.formatDuration(e.getDuration()))}}function fe(i,t){i&1&&(n(0,"span",19),s(1,"En progreso..."),o())}function Se(i,t){if(i&1){let e=S();n(0,"p-button",26),u("onClick",function(){g(e);let p=c().$implicit,d=c();return _(d.viewErrors.emit(p))}),o()}if(i&2){let e=c().$implicit;m("label",e.errors.length+" error(es)")("text",!0)("size","small")}}function ve(i,t){i&1&&(n(0,"span",24),a(1,"i",27),s(2," Sin errores "),o())}function be(i,t){if(i&1){let e=S();n(0,"tr")(1,"td"),a(2,"i",17),s(3),L(4,"date"),o(),n(5,"td"),y(6,ye,1,1,"p-chip",18)(7,fe,2,0,"span",19),o(),n(8,"td",16),a(9,"p-chip",20),o(),n(10,"td",16),a(11,"p-chip",21),o(),n(12,"td",16),a(13,"p-tag",22),o(),n(14,"td"),y(15,Se,1,3,"p-button",23)(16,ve,3,0,"span",24),o(),n(17,"td",16)(18,"p-button",25),u("onClick",function(){let p=g(e).$implicit,d=c();return _(d.viewDetails.emit(p))}),o()()()}if(i&2){let e=t.$implicit,r=c();l(3),V(" ",$(4,10,e.startedAt.toDate(),"dd/MM/yyyy HH:mm:ss")," "),l(3),f(e.getDuration()?6:7),l(3),m("label",(e.domainsProcessed||0).toString()),l(2),m("label",(e.subscriptionsProcessed||0).toString()),l(2),m("value",e.getStatusLabel())("severity",e.getSeverity())("icon",r.getStatusIcon(e)),l(2),f(e.errors&&e.errors.length>0?15:16),l(3),m("rounded",!0)("text",!0)}}function Ce(i,t){i&1&&(n(0,"tr")(1,"td",28),a(2,"i",29),n(3,"p",30),s(4," No se encontraron sincronizaciones "),o()()())}var h=class i{syncRuns=w.required();isLoading=w(!1);viewDetails=T();viewErrors=T();formatDuration(t){let e=Math.floor(t/1e3);if(e<60)return`${e}s`;let r=Math.floor(e/60),p=e%60;return`${r}m ${p}s`}getStatusIcon(t){return t.isSuccess()?"pi pi-check-circle":t.isFailed()?"pi pi-times-circle":t.isPartialSuccess&&t.isPartialSuccess()?"pi pi-exclamation-circle":"pi pi-info-circle"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=b({type:i,selectors:[["app-sync-runs-table"]],inputs:{syncRuns:[1,"syncRuns"],isLoading:[1,"isLoading"]},outputs:{viewDetails:"viewDetails",viewErrors:"viewErrors"},decls:6,vars:9,consts:[["dt",""],[1,"p-datatable-sm",3,"value","loading","paginator","rows","rowsPerPageOptions","tableStyle","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"table-header"],[1,"header-left"],[1,"pi","pi-sync"],[1,"ml-2",3,"label"],[1,"header-right"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Buscar...",3,"input"],["pSortableColumn","startedAt"],["field","startedAt"],[2,"text-align","center"],[1,"pi","pi-calendar","mr-2"],[1,"duration-chip",3,"label"],[1,"text-muted"],["icon","pi pi-globe",1,"count-chip",3,"label"],["icon","pi pi-shopping-cart",1,"count-chip",3,"label"],[3,"value","severity","icon"],["icon","pi pi-exclamation-triangle","severity","danger","pTooltip","Ver errores",3,"label","text","size"],[1,"text-success"],["icon","pi pi-eye","severity","secondary","pTooltip","Ver detalles",3,"onClick","rounded","text"],["icon","pi pi-exclamation-triangle","severity","danger","pTooltip","Ver errores",3,"onClick","label","text","size"],[1,"pi","pi-check-circle","mr-1"],["colspan","7",2,"text-align","center","padding","3rem"],[1,"pi","pi-inbox",2,"font-size","3rem","color","var(--text-color-secondary)"],[2,"margin-top","1rem","color","var(--text-color-secondary)"]],template:function(e,r){e&1&&(n(0,"p-table",1,0),D(2,ge,10,1,"ng-template",2)(3,_e,16,0,"ng-template",3)(4,be,19,13,"ng-template",4)(5,Ce,5,0,"ng-template",5),o()),e&2&&m("value",r.syncRuns())("loading",r.isLoading())("paginator",!0)("rows",10)("rowsPerPageOptions",R(7,de))("tableStyle",R(8,ue))("rowHover",!0)},dependencies:[se,oe,F,re,ae,x,C,ne,te,W,G,H,A,q,j,le,z],styles:[".table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--surface-100);border-radius:8px;margin-bottom:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.duration-chip[_ngcontent-%COMP%]{background-color:var(--blue-100);color:var(--blue-900)}.count-chip[_ngcontent-%COMP%]{background-color:var(--surface-200);color:var(--text-color)}.text-muted[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-style:italic}.text-success[_ngcontent-%COMP%]{color:var(--green-600)}"],changeDetection:0})};function xe(i,t){i&1&&(n(0,"p-card"),a(1,"p-skeleton",9),o())}function he(i,t){if(i&1){let e=S();n(0,"p-card")(1,"div",10),a(2,"i",11),n(3,"h2"),s(4,"Error al cargar historial"),o(),n(5,"p"),s(6),o(),n(7,"p-button",12),u("onClick",function(){g(e);let p=c();return _(p.loadSyncRuns())}),o()()()}if(i&2){let e=c();l(6),O(e.error())}}function Re(i,t){if(i&1){let e=S();n(0,"app-sync-runs-table",13),u("viewDetails",function(p){g(e);let d=c();return _(d.onViewDetails(p))})("viewErrors",function(p){g(e);let d=c();return _(d.onViewErrors(p))}),o()}if(i&2){let e=c();m("syncRuns",e.syncRuns())("isLoading",e.isLoading())}}var E=class i{syncRunService=v(ie);route=v(B);router=v(N);messageService=v(P);syncRuns=this.syncRunService.syncRuns;isLoading=this.syncRunService.isLoading;error=this.syncRunService.error;workspaceId=M("");ngOnInit(){this.route.paramMap.subscribe(t=>{let e=t.get("workspaceId");e&&(this.workspaceId.set(e),this.loadSyncRuns())})}async loadSyncRuns(){let t=this.workspaceId();if(t)try{await this.syncRunService.getSyncRunsByWorkspace(t)}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo cargar el historial de sincronizaciones"})}}onViewDetails(t){let e=t.getDurationMs(),r=e?`${Math.floor(e/1e3)}s`:"En progreso";this.messageService.add({severity:"info",summary:"Detalles de Sincronizaci\xF3n",detail:`
        Estado: ${t.status}
        Duraci\xF3n: ${r}
        Dominios: ${t.domainsProcessed||0}
        Suscripciones: ${t.subscriptionsProcessed||0}
      `,life:5e3})}onViewErrors(t){let e=t.errors||[];this.messageService.add({severity:"error",summary:`${e.length} Error(es) en Sincronizaci\xF3n`,detail:e.map(r=>`\u2022 ${r.message}`).join(`
`),life:1e4})}goBack(){let t=this.workspaceId();t?this.router.navigate(["/w",t]):this.router.navigate(["/dashboard"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=b({type:i,selectors:[["app-sync-runs-page"]],features:[I([P])],decls:14,vars:6,consts:[[1,"fade-in"],[1,"sync-runs-toolbar"],[1,"p-toolbar-group-start"],[1,"app-page-title"],[1,"pi","pi-sync"],[1,"p-toolbar-group-end"],["label","Actualizar","icon","pi pi-refresh","pTooltip","Actualizar historial","tooltipPosition","bottom",3,"onClick","outlined","loading"],["label","Volver","icon","pi pi-arrow-left","severity","secondary",1,"ml-2",3,"onClick","outlined"],[3,"syncRuns","isLoading"],["height","400px"],[1,"error-state"],[1,"pi","pi-exclamation-triangle"],["label","Reintentar","icon","pi pi-refresh",3,"onClick"],[3,"viewDetails","viewErrors","syncRuns","isLoading"]],template:function(e,r){e&1&&(n(0,"div",0),a(1,"p-toast"),n(2,"p-toolbar",1)(3,"div",2)(4,"h1",3),a(5,"i",4),s(6," Historial de Sincronizaci\xF3n "),o()(),n(7,"div",5)(8,"p-button",6),u("onClick",function(){return r.loadSyncRuns()}),o(),n(9,"p-button",7),u("onClick",function(){return r.goBack()}),o()()(),n(10,"div"),y(11,xe,2,0,"p-card"),y(12,he,8,1,"p-card"),y(13,Re,1,2,"app-sync-runs-table",8),o()()),e&2&&(l(8),m("outlined",!0)("loading",r.isLoading()),l(),m("outlined",!0),l(2),f(r.isLoading()&&r.syncRuns().length===0?11:-1),l(),f(r.error()&&!r.isLoading()?12:-1),l(),f(r.syncRuns().length>0||!r.isLoading()&&!r.error()?13:-1))},dependencies:[K,J,x,C,U,Q,Y,X,ee,Z,h],styles:[".sync-runs-toolbar[_ngcontent-%COMP%]{box-shadow:0 2px 4px #00000014;margin-bottom:2rem;background:#fff;border-bottom:1px solid var(--surface-200)}.error-state[_ngcontent-%COMP%]{text-align:center;padding:3rem}.error-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--red-500);margin-bottom:1rem}.error-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--text-color);margin-bottom:.5rem}.error-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin-bottom:2rem}"],changeDetection:0})};export{E as default};

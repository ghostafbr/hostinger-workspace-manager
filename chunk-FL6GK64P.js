import{a as Z,b as ee}from"./chunk-MKYEOAI6.js";import{a as Q,b as U}from"./chunk-LZAUEQAN.js";import{b as X,c as Y}from"./chunk-FYGEUYEJ.js";import{b as ae}from"./chunk-KZCX5W5D.js";import{f as te}from"./chunk-FLCAO7BC.js";import"./chunk-XXMBZZ37.js";import"./chunk-NHWKIFHZ.js";import{g as ne,h as ie,i as re,j as oe}from"./chunk-GCQ2WIT6.js";import"./chunk-PPZFH2ZV.js";import{a as G,b as W}from"./chunk-2MAXEO6Q.js";import"./chunk-Q5HFPYVW.js";import"./chunk-46UKYMVD.js";import"./chunk-OL6EOTCO.js";import"./chunk-6BTVTWSQ.js";import{v as j,w as q}from"./chunk-Z4BNMZT3.js";import"./chunk-47X5BFEM.js";import{c as A,d as H}from"./chunk-JUILAC2W.js";import{a as J,b as K}from"./chunk-SPDGIFFF.js";import"./chunk-TOC7PNXQ.js";import"./chunk-JNP63KUK.js";import{Ia as E,Ma as F,gb as x,hb as b,i as $,x as B,z as N}from"./chunk-WQRABBEY.js";import{Ab as a,Cc as w,Dc as T,Hb as S,Mb as u,Ob as c,Pa as l,U as v,Yb as k,Z as g,_,bb as C,bc as s,cc as V,dc as O,hb as D,ja as M,jc as I,kc as R,rb as y,sb as f,sc as z,uc as L,xb as m,yb as n,zb as r}from"./chunk-XTNRL3Y3.js";var pe=()=>[10,25,50],me=()=>({"min-width":"70rem"});function de(i,t){if(i&1){let e=S();n(0,"div",6)(1,"div",7)(2,"h2"),a(3,"i",8),s(4," Historial de Sincronizaciones"),r(),a(5,"p-chip",9),r(),n(6,"div",10)(7,"span",11),a(8,"i",12),n(9,"input",13),u("input",function(p){g(e),c();let d=k(1);return _(d.filterGlobal(p.target.value,"contains"))}),r()()()()}if(i&2){let e=c();l(5),m("label",e.syncRuns().length.toString())}}function ue(i,t){i&1&&(n(0,"tr")(1,"th",14),s(2," Inicio "),a(3,"p-sortIcon",15),r(),n(4,"th"),s(5,"Duraci\xF3n"),r(),n(6,"th",16),s(7,"Dominios"),r(),n(8,"th",16),s(9,"Suscripciones"),r(),n(10,"th",16),s(11,"Estado"),r(),n(12,"th"),s(13,"Errores"),r(),n(14,"th",16),s(15,"Acciones"),r()())}function ge(i,t){if(i&1&&a(0,"p-chip",18),i&2){let e=c().$implicit,o=c();m("label",o.formatDuration(e.getDuration()))}}function _e(i,t){i&1&&(n(0,"span",19),s(1,"En progreso..."),r())}function ye(i,t){if(i&1){let e=S();n(0,"p-button",26),u("onClick",function(){g(e);let p=c().$implicit,d=c();return _(d.viewErrors.emit(p))}),r()}if(i&2){let e=c().$implicit;m("label",e.errors.length+" error(es)")("text",!0)("size","small")}}function fe(i,t){i&1&&(n(0,"span",24),a(1,"i",27),s(2," Sin errores "),r())}function Se(i,t){if(i&1){let e=S();n(0,"tr")(1,"td"),a(2,"i",17),s(3),z(4,"date"),r(),n(5,"td"),y(6,ge,1,1,"p-chip",18)(7,_e,2,0,"span",19),r(),n(8,"td",16),a(9,"p-chip",20),r(),n(10,"td",16),a(11,"p-chip",21),r(),n(12,"td",16),a(13,"p-tag",22),r(),n(14,"td"),y(15,ye,1,3,"p-button",23)(16,fe,3,0,"span",24),r(),n(17,"td",16)(18,"p-button",25),u("onClick",function(){let p=g(e).$implicit,d=c();return _(d.viewDetails.emit(p))}),r()()()}if(i&2){let e=t.$implicit,o=c();l(3),O(" ",L(4,10,e.startedAt.toDate(),"dd/MM/yyyy HH:mm:ss")," "),l(3),f(e.getDuration()?6:7),l(3),m("label",(e.domainsProcessed||0).toString()),l(2),m("label",(e.subscriptionsProcessed||0).toString()),l(2),m("value",e.getStatusLabel())("severity",e.getSeverity())("icon",o.getStatusIcon(e)),l(2),f(e.errors&&e.errors.length>0?15:16),l(3),m("rounded",!0)("text",!0)}}function ve(i,t){i&1&&(n(0,"tr")(1,"td",28),a(2,"i",29),n(3,"p",30),s(4," No se encontraron sincronizaciones "),r()()())}var h=class i{syncRuns=T.required();isLoading=T(!1);viewDetails=w();viewErrors=w();formatDuration(t){let e=Math.floor(t/1e3);if(e<60)return`${e}s`;let o=Math.floor(e/60),p=e%60;return`${o}m ${p}s`}getStatusIcon(t){return t.isSuccess()?"pi pi-check-circle":t.isFailed()?"pi pi-times-circle":t.isPartialSuccess&&t.isPartialSuccess()?"pi pi-exclamation-circle":"pi pi-info-circle"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-sync-runs-table"]],inputs:{syncRuns:[1,"syncRuns"],isLoading:[1,"isLoading"]},outputs:{viewDetails:"viewDetails",viewErrors:"viewErrors"},decls:6,vars:9,consts:[["dt",""],[1,"p-datatable-sm",3,"value","loading","paginator","rows","rowsPerPageOptions","tableStyle","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"table-header"],[1,"header-left"],[1,"pi","pi-sync"],[1,"ml-2",3,"label"],[1,"header-right"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Buscar...",3,"input"],["pSortableColumn","startedAt"],["field","startedAt"],[2,"text-align","center"],[1,"pi","pi-calendar","mr-2"],[1,"duration-chip",3,"label"],[1,"text-muted"],["icon","pi pi-globe",1,"count-chip",3,"label"],["icon","pi pi-shopping-cart",1,"count-chip",3,"label"],[3,"value","severity","icon"],["icon","pi pi-exclamation-triangle","severity","danger","pTooltip","Ver errores",3,"label","text","size"],[1,"text-success"],["icon","pi pi-eye","severity","secondary","pTooltip","Ver detalles",3,"onClick","rounded","text"],["icon","pi pi-exclamation-triangle","severity","danger","pTooltip","Ver errores",3,"onClick","label","text","size"],[1,"pi","pi-check-circle","mr-1"],["colspan","7",2,"text-align","center","padding","3rem"],[1,"pi","pi-inbox",2,"font-size","3rem","color","var(--text-color-secondary)"],[2,"margin-top","1rem","color","var(--text-color-secondary)"]],template:function(e,o){e&1&&(n(0,"p-table",1,0),D(2,de,10,1,"ng-template",2)(3,ue,16,0,"ng-template",3)(4,Se,19,13,"ng-template",4)(5,ve,5,0,"ng-template",5),r()),e&2&&m("value",o.syncRuns())("loading",o.isLoading())("paginator",!0)("rows",10)("rowsPerPageOptions",R(7,pe))("tableStyle",R(8,me))("rowHover",!0)},dependencies:[oe,ne,F,ie,re,b,x,ee,Z,W,G,H,A,q,j,ae,$],styles:[".table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--surface-100);border-radius:8px;margin-bottom:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.duration-chip[_ngcontent-%COMP%]{background-color:var(--blue-100);color:var(--blue-900)}.count-chip[_ngcontent-%COMP%]{background-color:var(--surface-200);color:var(--text-color)}.text-muted[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-style:italic}.text-success[_ngcontent-%COMP%]{color:var(--green-600)}"],changeDetection:0})};function Ce(i,t){i&1&&(n(0,"p-card"),a(1,"p-skeleton",8),r())}function xe(i,t){if(i&1){let e=S();n(0,"p-card")(1,"div",9),a(2,"i",10),n(3,"h2"),s(4,"Error al cargar historial"),r(),n(5,"p"),s(6),r(),n(7,"p-button",11),u("onClick",function(){g(e);let p=c();return _(p.loadSyncRuns())}),r()()()}if(i&2){let e=c();l(6),V(e.error())}}function be(i,t){if(i&1){let e=S();n(0,"app-sync-runs-table",12),u("viewDetails",function(p){g(e);let d=c();return _(d.onViewDetails(p))})("viewErrors",function(p){g(e);let d=c();return _(d.onViewErrors(p))}),r()}if(i&2){let e=c();m("syncRuns",e.syncRuns())("isLoading",e.isLoading())}}var P=class i{syncRunService=v(te);route=v(B);router=v(N);messageService=v(E);syncRuns=this.syncRunService.syncRuns;isLoading=this.syncRunService.isLoading;error=this.syncRunService.error;workspaceId=M("");ngOnInit(){this.route.paramMap.subscribe(t=>{let e=t.get("workspaceId");e&&(this.workspaceId.set(e),this.loadSyncRuns())})}async loadSyncRuns(){let t=this.workspaceId();if(t)try{await this.syncRunService.getSyncRunsByWorkspace(t)}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo cargar el historial de sincronizaciones"})}}onViewDetails(t){let e=t.getDurationMs(),o=e?`${Math.floor(e/1e3)}s`:"En progreso";this.messageService.add({severity:"info",summary:"Detalles de Sincronizaci\xF3n",detail:`
        Estado: ${t.status}
        Duraci\xF3n: ${o}
        Dominios: ${t.domainsProcessed||0}
        Suscripciones: ${t.subscriptionsProcessed||0}
      `,life:5e3})}onViewErrors(t){let e=t.errors||[];this.messageService.add({severity:"error",summary:`${e.length} Error(es) en Sincronizaci\xF3n`,detail:e.map(o=>`\u2022 ${o.message}`).join(`
`),life:1e4})}goBack(){let t=this.workspaceId();t?this.router.navigate(["/w",t]):this.router.navigate(["/dashboard"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-sync-runs-page"]],features:[I([E])],decls:13,vars:6,consts:[[1,"fade-in"],[1,"flex","flex-wrap","justify-content-between","align-items-center","mb-4","gap-3"],[1,"app-page-title","m-0"],[1,"pi","pi-sync","text-primary","mr-2"],[1,"flex","gap-2"],["label","Actualizar","icon","pi pi-refresh","severity","secondary","size","small","pTooltip","Actualizar historial","tooltipPosition","bottom",3,"onClick","outlined","loading"],["label","Volver","icon","pi pi-arrow-left","severity","secondary","size","small",3,"onClick","outlined"],[3,"syncRuns","isLoading"],["height","400px"],[1,"error-state"],[1,"pi","pi-exclamation-triangle"],["label","Reintentar","icon","pi pi-refresh",3,"onClick"],[3,"viewDetails","viewErrors","syncRuns","isLoading"]],template:function(e,o){e&1&&(n(0,"div",0),a(1,"p-toast"),n(2,"div",1)(3,"h1",2),a(4,"i",3),s(5," Historial de Sincronizaci\xF3n "),r(),n(6,"div",4)(7,"p-button",5),u("onClick",function(){return o.loadSyncRuns()}),r(),n(8,"p-button",6),u("onClick",function(){return o.goBack()}),r()()(),n(9,"div"),y(10,Ce,2,0,"p-card"),y(11,xe,8,1,"p-card"),y(12,be,1,2,"app-sync-runs-table",7),r()()),e&2&&(l(7),m("outlined",!0)("loading",o.isLoading()),l(),m("outlined",!0),l(2),f(o.isLoading()&&o.syncRuns().length===0?10:-1),l(),f(o.error()&&!o.isLoading()?11:-1),l(),f(o.syncRuns().length>0||!o.isLoading()&&!o.error()?12:-1))},dependencies:[K,J,b,x,U,Q,Y,X,h],styles:[".error-state[_ngcontent-%COMP%]{text-align:center;padding:3rem}.error-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--red-500);margin-bottom:1rem}.error-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--text-color);margin-bottom:.5rem}.error-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin-bottom:2rem}"],changeDetection:0})};export{P as default};

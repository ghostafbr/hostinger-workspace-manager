import{Ga as g,Ha as m,Ia as v,Xa as d,Ya as E,n as c,o as p,p as f}from"./chunk-SII6JVR3.js";import{O as a,T as h,ia as u,r as n,s as o}from"./chunk-DRAPHMJV.js";var U=class r{auth=E.getAuth();currentUser=u(null);isLoading=u(!0);isAuthenticated=u(!1);authInitialized;authInitializedResolver;constructor(){this.authInitialized=new Promise(e=>{this.authInitializedResolver=e}),this.initAuthListener()}initAuthListener(){m(this.auth,e=>{this.currentUser.set(e),this.isAuthenticated.set(!!e),this.isLoading.set(!1),this.authInitializedResolver&&(this.authInitializedResolver(),this.authInitializedResolver=void 0)})}async signIn(e,t){try{return this.isLoading.set(!0),await g(this.auth,e,t)}finally{this.isLoading.set(!1)}}async signOut(){try{this.isLoading.set(!0),await v(this.auth),this.currentUser.set(null),this.isAuthenticated.set(!1)}finally{this.isLoading.set(!1)}}getCurrentUser(){return this.auth.currentUser}getCurrentUserUid(){return this.auth.currentUser?.uid??null}getCurrentUserEmail(){return this.auth.currentUser?.email??null}isUserAuthenticated(){return this.isAuthenticated()}getUserDisplayName(){let e=this.getCurrentUser();return e?.displayName||e?.email||"Usuario"}async waitForAuthInit(){return this.authInitialized}static \u0275fac=function(t){return new(t||r)};static \u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})};var y=class r{http=h(f);BASE_URL=d.api.hostinger.baseUrl;REQUEST_TIMEOUT=d.api.hostinger.timeout;async testConnection(e){if(!e||e.trim()==="")return{success:!1,error:"Token vac\xEDo"};try{let t=new c({Authorization:`Bearer ${e}`,Accept:"application/json"}),s=["/domains/v1/portfolio","/billing/v1/subscriptions","/hosting/v1/websites"];for(let l of s)try{console.log(`Testing endpoint: ${this.BASE_URL}${l}`);let i=await n(this.http.get(`${this.BASE_URL}${l}`,{headers:t,observe:"response",withCredentials:!1}).pipe(o(this.REQUEST_TIMEOUT)));if(i.status===200||i.status===201)return{success:!0}}catch(i){console.log(`\u2717 Failed with endpoint ${l}:`,i);continue}return{success:!1,error:"Ning\xFAn endpoint respondi\xF3 correctamente. Verifica que el token sea v\xE1lido."}}catch(t){return console.error("Hostinger API Error:",t),this.handleError(t)}}async getDomains(e){try{let t=new c({Authorization:`Bearer ${e}`,Accept:"application/json"}),s=await n(this.http.get(`${this.BASE_URL}/domains/v1/portfolio`,{headers:t}).pipe(o(this.REQUEST_TIMEOUT)));return s.data||s||[]}catch(t){throw console.error("Error fetching domains:",t),t}}async getSubscriptions(e){try{let t=new c({Authorization:`Bearer ${e}`,Accept:"application/json"}),s=await n(this.http.get(`${this.BASE_URL}/billing/v1/subscriptions`,{headers:t}).pipe(o(this.REQUEST_TIMEOUT)));return s.data||s||[]}catch(t){throw console.error("Error fetching subscriptions:",t),t}}handleError(e){if(e instanceof p){if(e.status===0)return console.error("CORS or Network Error Details:",{message:e.message,error:e.error,url:e.url,statusText:e.statusText}),{success:!1,error:"Error de CORS: Hostinger API no permite peticiones desde el navegador. Considera usar un proxy o Cloud Function."};switch(e.status){case 401:return{success:!1,error:"Token inv\xE1lido o expirado"};case 403:return{success:!1,error:"Token sin permisos suficientes"};case 429:return{success:!1,error:"Demasiadas peticiones. Intenta de nuevo m\xE1s tarde."};case 500:case 502:case 503:case 530:return{success:!1,error:`Error del servidor de Hostinger (${e.status}). El endpoint puede no existir o el token no es v\xE1lido.`};default:return console.error("HTTP Error Details:",{status:e.status,statusText:e.statusText,message:e.message,error:e.error,url:e.url}),{success:!1,error:`Error HTTP ${e.status}: ${e.message}`}}}return e instanceof Error&&e.name==="TimeoutError"?{success:!1,error:"Timeout: La solicitud tard\xF3 demasiado"}:e instanceof Error?{success:!1,error:e.message}:{success:!1,error:"Error desconocido"}}static \u0275fac=function(t){return new(t||r)};static \u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})};export{U as a,y as b};

import{Ka as p,Ma as c,Na as d,Oa as f,Pa as m,Qa as D,Sa as g,Ya as h}from"./chunk-SII6JVR3.js";import{O as b,a as u,b as l,ia as n}from"./chunk-DRAPHMJV.js";var y=class a{firestore=h.getFirestore();subscriptions=n([]);isLoading=n(!1);error=n(null);async getSubscriptions(t){try{this.isLoading.set(!0),this.error.set(null);let e=t.pageSize||20,r=c(p(this.firestore,"subscriptions"),d("workspaceId","==",t.workspaceId),f("expiresAt","asc"),m(e));t.lastDoc&&(r=c(r,D(t.lastDoc)));let s=(await g(r)).docs.map(o=>l(u({},o.data()),{id:o.id}));if(t.searchText){let o=t.searchText.toLowerCase();s=s.filter(S=>S.productName?.toLowerCase().includes(o))}return t.autoRenewOnly&&(s=s.filter(o=>o.autoRenew===!0)),this.subscriptions.set(s),s}catch(e){let r=e instanceof Error?e.message:"Error desconocido";throw this.error.set(r),console.error("Error fetching subscriptions:",e),e}finally{this.isLoading.set(!1)}}async getAllSubscriptions(t){try{this.isLoading.set(!0),this.error.set(null),console.log("[SubscriptionService] Fetching all subscriptions for workspaceId:",t);let e=c(p(this.firestore,"subscriptions"),d("workspaceId","==",t),f("expiresAt","asc")),r=await g(e);console.log("[SubscriptionService] Fetched",r.size,"subscriptions");let i=r.docs.map(s=>l(u({},s.data()),{id:s.id}));return console.log("[SubscriptionService] Mapped subscriptions:",i),i}catch(e){let r=e instanceof Error?e.message:"Error desconocido";throw this.error.set(r),console.error("[SubscriptionService] Error fetching all subscriptions:",e),e instanceof Error&&e.message.includes("index")&&console.error("[SubscriptionService] \u26A0\uFE0F Firestore index required. Check Firebase Console."),e}finally{this.isLoading.set(!1)}}getDaysUntilExpiration(t){let e=this.toDate(t);if(!e)return null;let r=new Date,i=e.getTime()-r.getTime();return Math.ceil(i/(1e3*60*60*24))}getDaysUntilNextBilling(t){let e=this.toDate(t);if(!e)return null;let r=new Date,i=e.getTime()-r.getTime();return Math.ceil(i/(1e3*60*60*24))}getStatusSeverity(t){let e=t.toLowerCase();return e.includes("active")||e.includes("activ")?"success":e.includes("pending")||e.includes("pendiente")?"warn":e.includes("suspended")||e.includes("suspendid")?"danger":e.includes("cancelled")||e.includes("cancelad")?"secondary":"info"}toDate(t){return t?t instanceof Date?t:typeof t=="object"&&"toDate"in t&&typeof t.toDate=="function"?t.toDate():null:null}static \u0275fac=function(e){return new(e||a)};static \u0275prov=b({token:a,factory:a.\u0275fac,providedIn:"root"})};export{y as a};

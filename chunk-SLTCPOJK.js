import{a as ae,b as le,c as se,d as pe,e as me}from"./chunk-DRIBZXDL.js";import"./chunk-MKYEOAI6.js";import{a as X,b as Y}from"./chunk-LZAUEQAN.js";import{b as Z,c as ee}from"./chunk-FYGEUYEJ.js";import{d as te}from"./chunk-FLCAO7BC.js";import"./chunk-XXMBZZ37.js";import"./chunk-NHWKIFHZ.js";import{g as ie,h as ne,i as re,j as oe}from"./chunk-GCQ2WIT6.js";import"./chunk-PPZFH2ZV.js";import"./chunk-2MAXEO6Q.js";import"./chunk-Q5HFPYVW.js";import"./chunk-46UKYMVD.js";import"./chunk-OL6EOTCO.js";import{h as $,i as J}from"./chunk-6BTVTWSQ.js";import{f as q,i as G,q as U}from"./chunk-Z4BNMZT3.js";import"./chunk-47X5BFEM.js";import"./chunk-JUILAC2W.js";import{a as K,b as Q}from"./chunk-SPDGIFFF.js";import"./chunk-TOC7PNXQ.js";import"./chunk-JNP63KUK.js";import{Ia as L,Ma as z,gb as H,hb as j,i as F,x as R,z as W}from"./chunk-WQRABBEY.js";import{Ab as l,Cc as N,Dc as P,Hb as _,Mb as y,Ob as c,Pa as s,U as f,Yb as V,Z as g,_ as u,bb as C,bc as m,cc as T,dc as x,gc as A,hb as B,hc as E,ic as M,ja as v,jc as O,kc as w,rb as b,sb as S,sc as D,uc as I,xb as d,yb as i,zb as n}from"./chunk-XTNRL3Y3.js";var ge=()=>[10,25,50],ue=()=>["entityName","entityType"],ye=()=>({"min-width":"60rem"});function _e(o,t){if(o&1){let e=_();i(0,"app-table-toolbar",6)(1,"app-search-input",7),y("onInput",function(a){g(e),c();let p=V(1);return u(p.filterGlobal(a,"contains"))}),n(),i(2,"p-select",8),M("ngModelChange",function(a){g(e);let p=c();return E(p.selectedEntityType,a)||(p.selectedEntityType=a),u(a)}),y("onChange",function(a){g(e);let p=c();return u(p.onEntityTypeFilter(a))}),n(),i(3,"p-select",9),M("ngModelChange",function(a){g(e);let p=c();return E(p.selectedDaysBefore,a)||(p.selectedDaysBefore=a),u(a)}),y("onChange",function(a){g(e);let p=c();return u(p.onDaysBeforeFilter(a))}),n()()}if(o&2){let e=c();d("count",e.alerts().length),s(2),d("options",e.entityTypeOptions),A("ngModel",e.selectedEntityType),d("showClear",!0),s(),d("options",e.daysBeforeOptions),A("ngModel",e.selectedDaysBefore),d("showClear",!0)}}function fe(o,t){o&1&&(i(0,"tr")(1,"th",10),m(2," Fecha "),l(3,"p-sortIcon",11),n(),i(4,"th",12),m(5," Tipo "),l(6,"p-sortIcon",13),n(),i(7,"th",14),m(8," Entidad "),l(9,"p-sortIcon",15),n(),i(10,"th",16),m(11," D\xEDas Restantes "),l(12,"p-sortIcon",17),n(),i(13,"th",18),m(14," Vence "),l(15,"p-sortIcon",19),n(),i(16,"th",20),m(17,"Severidad"),n(),i(18,"th",20),m(19,"Acciones"),n()())}function ve(o,t){if(o&1){let e=_();i(0,"tr")(1,"td"),l(2,"i",21),m(3),D(4,"date"),n(),i(5,"td"),l(6,"app-status-tag",22),n(),i(7,"td")(8,"strong"),m(9),n()(),i(10,"td",20),l(11,"app-status-tag",23),n(),i(12,"td"),l(13,"i",24),m(14),D(15,"date"),n(),i(16,"td",20),l(17,"app-status-tag",22),n(),i(18,"td",20)(19,"app-action-button",25),y("onClick",function(){let a=g(e).$implicit,p=c();return u(p.viewDetails.emit(a))}),n()()()}if(o&2){let e=t.$implicit,r=c();s(3),x(" ",I(4,12,e.createdAt.toDate(),"dd/MM/yyyy HH:mm")," "),s(3),d("value",e.getEntityTypeLabel())("severityOverride",e.entityType==="domain"?"info":"success")("icon",e.entityType==="domain"?"pi pi-globe":"pi pi-shopping-cart"),s(3),T(e.entityName),s(2),d("value",e.getDaysBeforeLabel())("severityOverride",r.getDaysBeforeSeverity(e.daysBefore))("rounded",!0),s(3),x(" ",I(15,15,e.expiresAt.toDate(),"dd/MM/yyyy")," "),s(3),d("value",r.getSeverityLabel(e.getSeverity()))("severityOverride",e.getSeverity())("icon",r.getSeverityIcon(e.getSeverity()))}}function Ce(o,t){o&1&&(i(0,"tr")(1,"td",26),l(2,"app-empty-state",27),n()())}var h=class o{alerts=P.required();isLoading=P(!1);viewDetails=N();selectedEntityType=v(null);selectedDaysBefore=v(null);entityTypeOptions=[{label:"Dominios",value:"domain"},{label:"Suscripciones",value:"subscription"}];daysBeforeOptions=[{label:"1 d\xEDa",value:1},{label:"3 d\xEDas",value:3},{label:"7 d\xEDas",value:7},{label:"15 d\xEDas",value:15},{label:"30 d\xEDas",value:30},{label:"45 d\xEDas",value:45}];onEntityTypeFilter(t){this.selectedEntityType.set(t.value)}onDaysBeforeFilter(t){this.selectedDaysBefore.set(t.value)}getDaysBeforeSeverity(t){return t<=3?"danger":t<=7?"warn":t<=30?"info":"success"}getSeverityLabel(t){return{danger:"Cr\xEDtico",warn:"Advertencia",info:"Informaci\xF3n",success:"Normal"}[t]||t}getSeverityIcon(t){return{danger:"pi pi-exclamation-triangle",warn:"pi pi-exclamation-circle",info:"pi pi-info-circle",success:"pi pi-check-circle"}[t]||"pi pi-info-circle"}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=C({type:o,selectors:[["app-alerts-table"]],inputs:{alerts:[1,"alerts"],isLoading:[1,"isLoading"]},outputs:{viewDetails:"viewDetails"},decls:6,vars:11,consts:[["dt",""],[1,"p-datatable-sm",3,"value","loading","paginator","rows","rowsPerPageOptions","globalFilterFields","tableStyle","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["title","Alertas","icon","pi pi-bell",3,"count"],[3,"onInput"],["placeholder","Todos los tipos",1,"w-full","sm:w-auto",3,"ngModelChange","onChange","options","ngModel","showClear"],["placeholder","Todos los d\xEDas",1,"w-full","sm:w-auto",3,"ngModelChange","onChange","options","ngModel","showClear"],["pSortableColumn","createdAt"],["field","createdAt"],["pSortableColumn","entityType"],["field","entityType"],["pSortableColumn","entityName"],["field","entityName"],["pSortableColumn","daysBefore",2,"text-align","center"],["field","daysBefore"],["pSortableColumn","expiresAt"],["field","expiresAt"],[2,"text-align","center"],[1,"pi","pi-calendar","mr-2"],[3,"value","severityOverride","icon"],[3,"value","severityOverride","rounded"],[1,"pi","pi-clock","mr-2"],["action","view","tooltip","Ver detalles",3,"onClick"],["colspan","7"],["title","No se encontraron alertas"]],template:function(e,r){e&1&&(i(0,"p-table",1,0),B(2,_e,4,7,"ng-template",2)(3,fe,20,0,"ng-template",3)(4,ve,20,18,"ng-template",4)(5,Ce,3,0,"ng-template",5),n()),e&2&&d("value",r.alerts())("loading",r.isLoading())("paginator",!0)("rows",10)("rowsPerPageOptions",w(8,ge))("globalFilterFields",w(9,ue))("tableStyle",w(10,ye))("rowHover",!0)},dependencies:[oe,ie,z,ne,re,J,$,U,q,G,ae,le,se,pe,me,F],encapsulation:2,changeDetection:0})};function be(o,t){o&1&&(i(0,"p-card"),l(1,"p-skeleton",8),n())}function Se(o,t){if(o&1){let e=_();i(0,"p-card")(1,"div",9),l(2,"i",10),i(3,"h2"),m(4,"Error al cargar alertas"),n(),i(5,"p"),m(6),n(),i(7,"p-button",11),y("onClick",function(){g(e);let a=c();return u(a.loadAlerts())}),n()()()}if(o&2){let e=c();s(6),T(e.error())}}function Te(o,t){if(o&1){let e=_();i(0,"app-alerts-table",12),y("viewDetails",function(a){g(e);let p=c();return u(p.onViewDetails(a))}),n()}if(o&2){let e=c();d("alerts",e.alerts())("isLoading",e.isLoading())}}var k=class o{alertService=f(te);route=f(R);router=f(W);messageService=f(L);alerts=this.alertService.alerts;isLoading=this.alertService.isLoading;error=this.alertService.error;workspaceId=v("");ngOnInit(){this.route.paramMap.subscribe(t=>{let e=t.get("workspaceId");e&&(this.workspaceId.set(e),this.loadAlerts())})}async loadAlerts(){let t=this.workspaceId();if(t)try{await this.alertService.getAlertsByWorkspace(t)}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las alertas"})}}onViewDetails(t){this.messageService.add({severity:"info",summary:"Detalles de Alerta",detail:`${t.getEntityTypeLabel()}: ${t.entityName} - ${t.getDaysBeforeLabel()}`,life:5e3})}goBack(){let t=this.workspaceId();t?this.router.navigate(["/w",t]):this.router.navigate(["/dashboard"])}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=C({type:o,selectors:[["app-alerts-page"]],features:[O([L])],decls:13,vars:6,consts:[[1,"fade-in"],[1,"flex","flex-wrap","justify-content-between","align-items-center","mb-4","gap-3"],[1,"app-page-title","m-0"],[1,"pi","pi-bell","text-primary","mr-2"],[1,"flex","gap-2"],["label","Actualizar","icon","pi pi-refresh","severity","secondary","size","small","pTooltip","Actualizar alertas","tooltipPosition","bottom",3,"onClick","outlined","loading"],["label","Volver","icon","pi pi-arrow-left","severity","secondary","size","small",3,"onClick","outlined"],[3,"alerts","isLoading"],["height","400px"],[1,"error-state"],[1,"pi","pi-exclamation-triangle"],["label","Reintentar","icon","pi pi-refresh",3,"onClick"],[3,"viewDetails","alerts","isLoading"]],template:function(e,r){e&1&&(i(0,"div",0),l(1,"p-toast"),i(2,"div",1)(3,"h1",2),l(4,"i",3),m(5," Alertas "),n(),i(6,"div",4)(7,"p-button",5),y("onClick",function(){return r.loadAlerts()}),n(),i(8,"p-button",6),y("onClick",function(){return r.goBack()}),n()()(),i(9,"div"),b(10,be,2,0,"p-card"),b(11,Se,8,1,"p-card"),b(12,Te,1,2,"app-alerts-table",7),n()()),e&2&&(s(7),d("outlined",!0)("loading",r.isLoading()),s(),d("outlined",!0),s(2),S(r.isLoading()&&r.alerts().length===0?10:-1),s(),S(r.error()&&!r.isLoading()?11:-1),s(),S(r.alerts().length>0||!r.isLoading()&&!r.error()?12:-1))},dependencies:[Q,K,j,H,Y,X,ee,Z,h],styles:[".error-state[_ngcontent-%COMP%]{text-align:center;padding:3rem}.error-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--red-500);margin-bottom:1rem}.error-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--text-color);margin-bottom:.5rem}.error-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin-bottom:2rem}"],changeDetection:0})};export{k as default};

import{a as te,b as ne,c as ie,d as oe,e as re}from"./chunk-DRIBZXDL.js";import{a as J,b as K}from"./chunk-MKYEOAI6.js";import{a as j,b as q}from"./chunk-LZAUEQAN.js";import{b as G,c as W}from"./chunk-FYGEUYEJ.js";import{b as ee}from"./chunk-KZCX5W5D.js";import{f as Q}from"./chunk-FLCAO7BC.js";import"./chunk-XXMBZZ37.js";import"./chunk-NHWKIFHZ.js";import{g as U,h as X,i as Y,j as Z}from"./chunk-GCQ2WIT6.js";import"./chunk-PPZFH2ZV.js";import"./chunk-2MAXEO6Q.js";import"./chunk-Q5HFPYVW.js";import"./chunk-46UKYMVD.js";import"./chunk-OL6EOTCO.js";import"./chunk-6BTVTWSQ.js";import"./chunk-Z4BNMZT3.js";import"./chunk-47X5BFEM.js";import"./chunk-JUILAC2W.js";import{a as F,b as H}from"./chunk-SPDGIFFF.js";import"./chunk-TOC7PNXQ.js";import"./chunk-JNP63KUK.js";import{Ia as w,Ma as N,gb as A,hb as B,i as L,x as $,z}from"./chunk-WQRABBEY.js";import{Ab as p,Cc as h,Dc as R,Hb as f,Mb as d,Ob as a,Pa as l,U as C,Yb as D,Z as _,_ as g,bb as v,bc as c,cc as M,dc as k,hb as P,ja as E,jc as I,kc as x,rb as y,sb as S,sc as V,uc as O,xb as m,yb as i,zb as o}from"./chunk-XTNRL3Y3.js";var ce=()=>[10,25,50],le=()=>({"min-width":"70rem"});function pe(n,t){if(n&1){let e=f();i(0,"app-table-toolbar",6)(1,"app-search-input",7),d("onInput",function(s){_(e),a();let u=D(1);return g(u.filterGlobal(s,"contains"))}),o()()}if(n&2){let e=a();m("count",e.syncRuns().length)}}function me(n,t){n&1&&(i(0,"tr")(1,"th",8),c(2," Inicio "),p(3,"p-sortIcon",9),o(),i(4,"th"),c(5,"Duraci\xF3n"),o(),i(6,"th",10),c(7,"Dominios"),o(),i(8,"th",10),c(9,"Suscripciones"),o(),i(10,"th",10),c(11,"Estado"),o(),i(12,"th"),c(13,"Errores"),o(),i(14,"th",10),c(15,"Acciones"),o()())}function ue(n,t){if(n&1&&p(0,"p-chip",12),n&2){let e=a().$implicit,r=a();m("label",r.formatDuration(e.getDuration()))}}function de(n,t){n&1&&(i(0,"span",13),c(1,"En progreso..."),o())}function _e(n,t){if(n&1){let e=f();i(0,"app-action-button",20),d("onClick",function(){_(e);let s=a().$implicit,u=a();return g(u.viewErrors.emit(s))}),o()}if(n&2){let e=a().$implicit;m("tooltip",e.errors.length+" errores")}}function ge(n,t){n&1&&(i(0,"span",18),p(1,"i",21),c(2," Sin errores "),o())}function ye(n,t){if(n&1){let e=f();i(0,"tr")(1,"td"),p(2,"i",11),c(3),V(4,"date"),o(),i(5,"td"),y(6,ue,1,1,"p-chip",12)(7,de,2,0,"span",13),o(),i(8,"td",10),p(9,"p-chip",14),o(),i(10,"td",10),p(11,"p-chip",15),o(),i(12,"td",10),p(13,"app-status-tag",16),o(),i(14,"td"),y(15,_e,1,1,"app-action-button",17)(16,ge,3,0,"span",18),o(),i(17,"td",10)(18,"app-action-button",19),d("onClick",function(){let s=_(e).$implicit,u=a();return g(u.viewDetails.emit(s))}),o()()()}if(n&2){let e=t.$implicit,r=a();l(3),k(" ",O(4,8,e.startedAt.toDate(),"dd/MM/yyyy HH:mm:ss")," "),l(3),S(e.getDuration()?6:7),l(3),m("label",(e.domainsProcessed||0).toString()),l(2),m("label",(e.subscriptionsProcessed||0).toString()),l(2),m("value",e.getStatusLabel())("severityOverride",e.getSeverity())("icon",r.getStatusIcon(e)),l(2),S(e.errors&&e.errors.length>0?15:16)}}function Se(n,t){n&1&&(i(0,"tr")(1,"td",22),p(2,"app-empty-state",23),o()())}var b=class n{syncRuns=R.required();isLoading=R(!1);viewDetails=h();viewErrors=h();formatDuration(t){let e=Math.floor(t/1e3);if(e<60)return`${e}s`;let r=Math.floor(e/60),s=e%60;return`${r}m ${s}s`}getStatusIcon(t){return t.isSuccess()?"pi pi-check-circle":t.isFailed()?"pi pi-times-circle":t.isPartialSuccess&&t.isPartialSuccess()?"pi pi-exclamation-circle":"pi pi-info-circle"}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=v({type:n,selectors:[["app-sync-runs-table"]],inputs:{syncRuns:[1,"syncRuns"],isLoading:[1,"isLoading"]},outputs:{viewDetails:"viewDetails",viewErrors:"viewErrors"},decls:6,vars:9,consts:[["dt",""],[1,"p-datatable-sm",3,"value","loading","paginator","rows","rowsPerPageOptions","tableStyle","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["title","Historial de Sincronizaciones","icon","pi pi-sync",3,"count"],[3,"onInput"],["pSortableColumn","startedAt"],["field","startedAt"],[2,"text-align","center"],[1,"pi","pi-calendar","mr-2"],[1,"duration-chip",3,"label"],[1,"text-muted"],["icon","pi pi-globe",1,"count-chip",3,"label"],["icon","pi pi-shopping-cart",1,"count-chip",3,"label"],[3,"value","severityOverride","icon"],["action","custom","customIcon","pi pi-exclamation-triangle",3,"tooltip"],[1,"text-success"],["action","view","tooltip","Ver detalles",3,"onClick"],["action","custom","customIcon","pi pi-exclamation-triangle",3,"onClick","tooltip"],[1,"pi","pi-check-circle","mr-1"],["colspan","7"],["title","No se encontraron sincronizaciones"]],template:function(e,r){e&1&&(i(0,"p-table",1,0),P(2,pe,2,1,"ng-template",2)(3,me,16,0,"ng-template",3)(4,ye,19,11,"ng-template",4)(5,Se,3,0,"ng-template",5),o()),e&2&&m("value",r.syncRuns())("loading",r.isLoading())("paginator",!0)("rows",10)("rowsPerPageOptions",x(7,ce))("tableStyle",x(8,le))("rowHover",!0)},dependencies:[Z,U,N,X,Y,K,J,ee,te,ne,ie,oe,re,L],styles:[".duration-chip[_ngcontent-%COMP%]{background-color:var(--blue-100);color:var(--blue-900)}.count-chip[_ngcontent-%COMP%]{background-color:var(--surface-200);color:var(--text-color)}.text-muted[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-style:italic}.text-success[_ngcontent-%COMP%]{color:var(--green-600)}"],changeDetection:0})};function fe(n,t){n&1&&(i(0,"p-card"),p(1,"p-skeleton",8),o())}function Ce(n,t){if(n&1){let e=f();i(0,"p-card")(1,"div",9),p(2,"i",10),i(3,"h2"),c(4,"Error al cargar historial"),o(),i(5,"p"),c(6),o(),i(7,"p-button",11),d("onClick",function(){_(e);let s=a();return g(s.loadSyncRuns())}),o()()()}if(n&2){let e=a();l(6),M(e.error())}}function ve(n,t){if(n&1){let e=f();i(0,"app-sync-runs-table",12),d("viewDetails",function(s){_(e);let u=a();return g(u.onViewDetails(s))})("viewErrors",function(s){_(e);let u=a();return g(u.onViewErrors(s))}),o()}if(n&2){let e=a();m("syncRuns",e.syncRuns())("isLoading",e.isLoading())}}var T=class n{syncRunService=C(Q);route=C($);router=C(z);messageService=C(w);syncRuns=this.syncRunService.syncRuns;isLoading=this.syncRunService.isLoading;error=this.syncRunService.error;workspaceId=E("");ngOnInit(){this.route.paramMap.subscribe(t=>{let e=t.get("workspaceId");e&&(this.workspaceId.set(e),this.loadSyncRuns())})}async loadSyncRuns(){let t=this.workspaceId();if(t)try{await this.syncRunService.getSyncRunsByWorkspace(t)}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo cargar el historial de sincronizaciones"})}}onViewDetails(t){let e=t.getDurationMs(),r=e?`${Math.floor(e/1e3)}s`:"En progreso";this.messageService.add({severity:"info",summary:"Detalles de Sincronizaci\xF3n",detail:`
        Estado: ${t.status}
        Duraci\xF3n: ${r}
        Dominios: ${t.domainsProcessed||0}
        Suscripciones: ${t.subscriptionsProcessed||0}
      `,life:5e3})}onViewErrors(t){let e=t.errors||[];this.messageService.add({severity:"error",summary:`${e.length} Error(es) en Sincronizaci\xF3n`,detail:e.map(r=>`\u2022 ${r.message}`).join(`
`),life:1e4})}goBack(){let t=this.workspaceId();t?this.router.navigate(["/w",t]):this.router.navigate(["/dashboard"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=v({type:n,selectors:[["app-sync-runs-page"]],features:[I([w])],decls:13,vars:6,consts:[[1,"fade-in"],[1,"flex","flex-wrap","justify-content-between","align-items-center","mb-4","gap-3"],[1,"app-page-title","m-0"],[1,"pi","pi-sync","text-primary","mr-2"],[1,"flex","gap-2"],["label","Actualizar","icon","pi pi-refresh","severity","secondary","size","small","pTooltip","Actualizar historial","tooltipPosition","bottom",3,"onClick","outlined","loading"],["label","Volver","icon","pi pi-arrow-left","severity","secondary","size","small",3,"onClick","outlined"],[3,"syncRuns","isLoading"],["height","400px"],[1,"error-state"],[1,"pi","pi-exclamation-triangle"],["label","Reintentar","icon","pi pi-refresh",3,"onClick"],[3,"viewDetails","viewErrors","syncRuns","isLoading"]],template:function(e,r){e&1&&(i(0,"div",0),p(1,"p-toast"),i(2,"div",1)(3,"h1",2),p(4,"i",3),c(5," Historial de Sincronizaci\xF3n "),o(),i(6,"div",4)(7,"p-button",5),d("onClick",function(){return r.loadSyncRuns()}),o(),i(8,"p-button",6),d("onClick",function(){return r.goBack()}),o()()(),i(9,"div"),y(10,fe,2,0,"p-card"),y(11,Ce,8,1,"p-card"),y(12,ve,1,2,"app-sync-runs-table",7),o()()),e&2&&(l(7),m("outlined",!0)("loading",r.isLoading()),l(),m("outlined",!0),l(2),S(r.isLoading()&&r.syncRuns().length===0?10:-1),l(),S(r.error()&&!r.isLoading()?11:-1),l(),S(r.syncRuns().length>0||!r.isLoading()&&!r.error()?12:-1))},dependencies:[H,F,B,A,q,j,W,G,b],styles:[".error-state[_ngcontent-%COMP%]{text-align:center;padding:3rem}.error-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--red-500);margin-bottom:1rem}.error-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--text-color);margin-bottom:.5rem}.error-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin-bottom:2rem}"],changeDetection:0})};export{T as default};

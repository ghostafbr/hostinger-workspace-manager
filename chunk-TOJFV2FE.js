import{a as ce,b as me}from"./chunk-MKYEOAI6.js";import{a as re,b as oe}from"./chunk-LZAUEQAN.js";import{b as ae,c as le}from"./chunk-FYGEUYEJ.js";import{d as de}from"./chunk-5R2X6POM.js";import"./chunk-XXMBZZ37.js";import"./chunk-NHWKIFHZ.js";import{g as ge,h as ue,i as fe,j as ye}from"./chunk-GCQ2WIT6.js";import{a as se,b as pe}from"./chunk-XNM27DCK.js";import"./chunk-PPZFH2ZV.js";import{a as ee,b as te}from"./chunk-2MAXEO6Q.js";import"./chunk-Q5HFPYVW.js";import"./chunk-46UKYMVD.js";import"./chunk-OL6EOTCO.js";import{h as Y,i as Z}from"./chunk-6BTVTWSQ.js";import{f as $,i as J,q as K,v as Q,w as X}from"./chunk-Z4BNMZT3.js";import"./chunk-47X5BFEM.js";import{c as G,d as U}from"./chunk-JUILAC2W.js";import{a as ie,b as ne}from"./chunk-SPDGIFFF.js";import"./chunk-TOC7PNXQ.js";import"./chunk-JNP63KUK.js";import{Ia as B,Ma as q,gb as S,hb as w,i as z,x as H,z as j}from"./chunk-WQRABBEY.js";import{Ab as l,Cc as W,Dc as I,Hb as y,Mb as f,Ob as d,Pa as s,U as _,Yb as N,Z as g,_ as u,ac as F,bb as v,bc as p,cc as x,dc as A,gc as E,hb as V,hc as D,ic as P,ja as b,jc as R,kc as T,rb as C,sb as h,sc as k,uc as O,xb as m,yb as i,zb as n}from"./chunk-XTNRL3Y3.js";var Ce=()=>[10,25,50],he=()=>["entityName","entityType"],xe=()=>({"min-width":"60rem"});function Te(o,t){if(o&1){let e=y();i(0,"div",6)(1,"div",7)(2,"h2"),l(3,"i",8),p(4," Alertas"),n(),l(5,"p-chip",9),n(),i(6,"div",10)(7,"span",11),l(8,"i",12),i(9,"input",13),f("input",function(a){g(e),d();let c=N(1);return u(c.filterGlobal(a.target.value,"contains"))}),n()(),i(10,"p-select",14),P("ngModelChange",function(a){g(e);let c=d();return D(c.selectedEntityType,a)||(c.selectedEntityType=a),u(a)}),f("onChange",function(a){g(e);let c=d();return u(c.onEntityTypeFilter(a))}),n(),i(11,"p-select",15),P("ngModelChange",function(a){g(e);let c=d();return D(c.selectedDaysBefore,a)||(c.selectedDaysBefore=a),u(a)}),f("onChange",function(a){g(e);let c=d();return u(c.onDaysBeforeFilter(a))}),n()()()}if(o&2){let e=d();s(5),m("label",e.alerts().length.toString()),s(5),m("options",e.entityTypeOptions),E("ngModel",e.selectedEntityType),m("showClear",!0),s(),m("options",e.daysBeforeOptions),E("ngModel",e.selectedDaysBefore),m("showClear",!0)}}function Se(o,t){o&1&&(i(0,"tr")(1,"th",16),p(2," Fecha "),l(3,"p-sortIcon",17),n(),i(4,"th",18),p(5," Tipo "),l(6,"p-sortIcon",19),n(),i(7,"th",20),p(8," Entidad "),l(9,"p-sortIcon",21),n(),i(10,"th",22),p(11," D\xEDas Restantes "),l(12,"p-sortIcon",23),n(),i(13,"th",24),p(14," Vence "),l(15,"p-sortIcon",25),n(),i(16,"th",26),p(17,"Severidad"),n(),i(18,"th",26),p(19,"Acciones"),n()())}function we(o,t){if(o&1){let e=y();i(0,"tr")(1,"td"),l(2,"i",27),p(3),k(4,"date"),n(),i(5,"td"),l(6,"p-tag",28),n(),i(7,"td")(8,"strong"),p(9),n()(),i(10,"td",26),l(11,"p-chip",29),n(),i(12,"td"),l(13,"i",30),p(14),k(15,"date"),n(),i(16,"td",26),l(17,"p-tag",28),n(),i(18,"td",26)(19,"p-button",31),f("onClick",function(){let a=g(e).$implicit,c=d();return u(c.viewDetails.emit(a))}),n()()()}if(o&2){let e=t.$implicit,r=d();s(3),A(" ",O(4,14,e.createdAt.toDate(),"dd/MM/yyyy HH:mm")," "),s(3),m("value",e.getEntityTypeLabel())("severity",e.entityType==="domain"?"info":"success")("icon",e.entityType==="domain"?"pi pi-globe":"pi pi-shopping-cart"),s(3),x(e.entityName),s(2),F(r.getDaysBeforeChipClass(e.daysBefore)),m("label",e.getDaysBeforeLabel()),s(3),A(" ",O(15,17,e.expiresAt.toDate(),"dd/MM/yyyy")," "),s(3),m("value",r.getSeverityLabel(e.getSeverity()))("severity",e.getSeverity())("icon",r.getSeverityIcon(e.getSeverity())),s(2),m("rounded",!0)("text",!0)}}function Me(o,t){o&1&&(i(0,"tr")(1,"td",32),l(2,"i",33),i(3,"p",34),p(4," No se encontraron alertas "),n()()())}var M=class o{alerts=I.required();isLoading=I(!1);viewDetails=W();selectedEntityType=b(null);selectedDaysBefore=b(null);entityTypeOptions=[{label:"Dominios",value:"domain"},{label:"Suscripciones",value:"subscription"}];daysBeforeOptions=[{label:"1 d\xEDa",value:1},{label:"3 d\xEDas",value:3},{label:"7 d\xEDas",value:7},{label:"15 d\xEDas",value:15},{label:"30 d\xEDas",value:30},{label:"45 d\xEDas",value:45}];onEntityTypeFilter(t){this.selectedEntityType.set(t.value)}onDaysBeforeFilter(t){this.selectedDaysBefore.set(t.value)}getDaysBeforeChipClass(t){return t<=3?"chip-critical":t<=7?"chip-warning":t<=30?"chip-info":"chip-success"}getSeverityLabel(t){return{danger:"Cr\xEDtico",warn:"Advertencia",info:"Informaci\xF3n",success:"Normal"}[t]||t}getSeverityIcon(t){return{danger:"pi pi-exclamation-triangle",warn:"pi pi-exclamation-circle",info:"pi pi-info-circle",success:"pi pi-check-circle"}[t]||"pi pi-info-circle"}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=v({type:o,selectors:[["app-alerts-table"]],inputs:{alerts:[1,"alerts"],isLoading:[1,"isLoading"]},outputs:{viewDetails:"viewDetails"},decls:6,vars:11,consts:[["dt",""],[1,"p-datatable-sm",3,"value","loading","paginator","rows","rowsPerPageOptions","globalFilterFields","tableStyle","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"table-header"],[1,"header-left"],[1,"pi","pi-bell"],[1,"ml-2",3,"label"],[1,"header-right"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Buscar...",3,"input"],["placeholder","Todos los tipos",1,"ml-2",3,"ngModelChange","onChange","options","ngModel","showClear"],["placeholder","Todos los d\xEDas",1,"ml-2",3,"ngModelChange","onChange","options","ngModel","showClear"],["pSortableColumn","createdAt"],["field","createdAt"],["pSortableColumn","entityType"],["field","entityType"],["pSortableColumn","entityName"],["field","entityName"],["pSortableColumn","daysBefore",2,"text-align","center"],["field","daysBefore"],["pSortableColumn","expiresAt"],["field","expiresAt"],[2,"text-align","center"],[1,"pi","pi-calendar","mr-2"],[3,"value","severity","icon"],[3,"label"],[1,"pi","pi-clock","mr-2"],["icon","pi pi-eye","severity","secondary","pTooltip","Ver detalles",3,"onClick","rounded","text"],["colspan","7",2,"text-align","center","padding","3rem"],[1,"pi","pi-inbox",2,"font-size","3rem","color","var(--text-color-secondary)"],[2,"margin-top","1rem","color","var(--text-color-secondary)"]],template:function(e,r){e&1&&(i(0,"p-table",1,0),V(2,Te,12,7,"ng-template",2)(3,Se,20,0,"ng-template",3)(4,we,20,20,"ng-template",4)(5,Me,5,0,"ng-template",5),n()),e&2&&m("value",r.alerts())("loading",r.isLoading())("paginator",!0)("rows",10)("rowsPerPageOptions",T(8,Ce))("globalFilterFields",T(9,he))("tableStyle",T(10,xe))("rowHover",!0)},dependencies:[ye,ge,q,ue,fe,w,S,me,ce,te,ee,U,G,X,Q,Z,Y,K,$,J,z],styles:[".table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--surface-100);border-radius:8px;margin-bottom:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}[_nghost-%COMP%]     .chip-critical{background-color:var(--red-600)!important;color:#fff!important;font-weight:600;border:2px solid var(--red-700)}[_nghost-%COMP%]     .chip-warning{background-color:var(--orange-600)!important;color:#fff!important;font-weight:600;border:2px solid var(--orange-700)}[_nghost-%COMP%]     .chip-info{background-color:var(--blue-600)!important;color:#fff!important;font-weight:600;border:2px solid var(--blue-700)}[_nghost-%COMP%]     .chip-success{background-color:var(--green-600)!important;color:#fff!important;font-weight:600;border:2px solid var(--green-700)}"],changeDetection:0})};function Ae(o,t){o&1&&(i(0,"p-card"),l(1,"p-skeleton",9),n())}function Ee(o,t){if(o&1){let e=y();i(0,"p-card")(1,"div",10),l(2,"i",11),i(3,"h2"),p(4,"Error al cargar alertas"),n(),i(5,"p"),p(6),n(),i(7,"p-button",12),f("onClick",function(){g(e);let a=d();return u(a.loadAlerts())}),n()()()}if(o&2){let e=d();s(6),x(e.error())}}function De(o,t){if(o&1){let e=y();i(0,"app-alerts-table",13),f("viewDetails",function(a){g(e);let c=d();return u(c.onViewDetails(a))}),n()}if(o&2){let e=d();m("alerts",e.alerts())("isLoading",e.isLoading())}}var L=class o{alertService=_(de);route=_(H);router=_(j);messageService=_(B);alerts=this.alertService.alerts;isLoading=this.alertService.isLoading;error=this.alertService.error;workspaceId=b("");ngOnInit(){this.route.paramMap.subscribe(t=>{let e=t.get("workspaceId");e&&(this.workspaceId.set(e),this.loadAlerts())})}async loadAlerts(){let t=this.workspaceId();if(t)try{await this.alertService.getAlertsByWorkspace(t)}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las alertas"})}}onViewDetails(t){this.messageService.add({severity:"info",summary:"Detalles de Alerta",detail:`${t.getEntityTypeLabel()}: ${t.entityName} - ${t.getDaysBeforeLabel()}`,life:5e3})}goBack(){let t=this.workspaceId();t?this.router.navigate(["/w",t]):this.router.navigate(["/dashboard"])}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=v({type:o,selectors:[["app-alerts-page"]],features:[R([B])],decls:14,vars:6,consts:[[1,"fade-in"],[1,"alerts-toolbar"],[1,"p-toolbar-group-start"],[1,"app-page-title"],[1,"pi","pi-bell"],[1,"p-toolbar-group-end"],["label","Actualizar","icon","pi pi-refresh","pTooltip","Actualizar alertas","tooltipPosition","bottom",3,"onClick","outlined","loading"],["label","Volver","icon","pi pi-arrow-left","severity","secondary",1,"ml-2",3,"onClick","outlined"],[3,"alerts","isLoading"],["height","400px"],[1,"error-state"],[1,"pi","pi-exclamation-triangle"],["label","Reintentar","icon","pi pi-refresh",3,"onClick"],[3,"viewDetails","alerts","isLoading"]],template:function(e,r){e&1&&(i(0,"div",0),l(1,"p-toast"),i(2,"p-toolbar",1)(3,"div",2)(4,"h1",3),l(5,"i",4),p(6," Alertas "),n()(),i(7,"div",5)(8,"p-button",6),f("onClick",function(){return r.loadAlerts()}),n(),i(9,"p-button",7),f("onClick",function(){return r.goBack()}),n()()(),i(10,"div"),C(11,Ae,2,0,"p-card"),C(12,Ee,8,1,"p-card"),C(13,De,1,2,"app-alerts-table",8),n()()),e&2&&(s(8),m("outlined",!0)("loading",r.isLoading()),s(),m("outlined",!0),s(2),h(r.isLoading()&&r.alerts().length===0?11:-1),s(),h(r.error()&&!r.isLoading()?12:-1),s(),h(r.alerts().length>0||!r.isLoading()&&!r.error()?13:-1))},dependencies:[ne,ie,w,S,oe,re,le,ae,pe,se,M],styles:[".alerts-toolbar[_ngcontent-%COMP%]{box-shadow:0 2px 4px #00000014;margin-bottom:2rem;background:#fff;border-bottom:1px solid var(--surface-200)}.error-state[_ngcontent-%COMP%]{text-align:center;padding:3rem}.error-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--red-500);margin-bottom:1rem}.error-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--text-color);margin-bottom:.5rem}.error-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin-bottom:2rem}"],changeDetection:0})};export{L as default};

import{a as ee,b as te}from"./chunk-KDMS5OSY.js";import{b as Z}from"./chunk-CTPZG76Y.js";import{b as Q,c as X}from"./chunk-FYGEUYEJ.js";import{g as re,h as ae,i as ne,j as oe}from"./chunk-GCQ2WIT6.js";import{b as ie}from"./chunk-XNM27DCK.js";import"./chunk-PPZFH2ZV.js";import{a as H,b as K}from"./chunk-2MAXEO6Q.js";import{a as Y,b as q,c as G}from"./chunk-Q5HFPYVW.js";import"./chunk-46UKYMVD.js";import"./chunk-OL6EOTCO.js";import{b as z,c as R,d as $,e as F}from"./chunk-6BTVTWSQ.js";import{v as B,w as j}from"./chunk-Z4BNMZT3.js";import{b as M}from"./chunk-47X5BFEM.js";import{c as V,d as O}from"./chunk-JUILAC2W.js";import{a as U,b as J}from"./chunk-SPDGIFFF.js";import"./chunk-TOC7PNXQ.js";import"./chunk-JNP63KUK.js";import{Ea as h,Ia as w,Ma as A,gb as L,hb as N,z as P}from"./chunk-WQRABBEY.js";import{Ab as d,Ac as I,Hb as k,Mb as m,Ob as u,Pa as o,U as v,Z as g,_ as f,bb as x,bc as c,cc as y,dc as W,hb as b,ja as _,jc as D,kc as S,rb as E,sb as T,xb as p,yb as i,zb as r}from"./chunk-XTNRL3Y3.js";var se=()=>[10,25,50],ce=()=>["name","description"];function le(s,e){s&1&&(i(0,"tr")(1,"th",15),c(2,"Nombre "),d(3,"p-sortIcon",16),r(),i(4,"th",17),c(5,"Estado "),d(6,"p-sortIcon",18),r(),i(7,"th",19),c(8,"\xDAltima Sync "),d(9,"p-sortIcon",20),r(),i(10,"th",21),c(11,"Creado "),d(12,"p-sortIcon",22),r(),i(13,"th"),c(14,"Acciones"),r()())}function pe(s,e){if(s&1){let t=k();i(0,"p-button",31),m("onClick",function(){g(t);let n=u().$implicit,l=u();return f(l.disableWorkspace(n))}),r()}s&2&&p("rounded",!0)("text",!0)}function de(s,e){if(s&1){let t=k();i(0,"tr")(1,"td")(2,"strong"),c(3),r(),i(4,"div",23),c(5),r()(),i(6,"td"),d(7,"p-tag",24),r(),i(8,"td"),c(9),r(),i(10,"td"),c(11),r(),i(12,"td")(13,"div",25)(14,"p-button",26),m("onClick",function(){let n=g(t).$implicit,l=u();return f(l.testConnection(n))}),r(),i(15,"p-button",27),m("onClick",function(){let n=g(t).$implicit,l=u();return f(l.syncNow(n))}),r(),i(16,"p-button",28),m("onClick",function(){let n=g(t).$implicit,l=u();return f(l.editWorkspace(n))}),r(),E(17,pe,1,2,"p-button",29),i(18,"p-button",30),m("onClick",function(){let n=g(t).$implicit,l=u();return f(l.deleteWorkspace(n))}),r()()()()}if(s&2){let t=e.$implicit,a=u();o(3),y(t.name),o(2),W(" ",t.description||"Sin descripci\xF3n"," "),o(2),p("value",a.getStatusLabel(t.status))("severity",a.getStatusSeverity(t.status))("pTooltip",a.getStatusTooltip(t.status,t.lastError)),o(2),y(a.formatDate(t.lastSyncAt)),o(2),y(a.formatDate(t.createdAt)),o(3),p("rounded",!0)("text",!0)("loading",a.isTestingConnection()===t.id),o(),p("rounded",!0)("text",!0)("loading",a.isSyncing()===t.id),o(),p("rounded",!0)("text",!0),o(),T(t.status!=="disabled"?17:-1),o(),p("rounded",!0)("text",!0)}}function me(s,e){if(s&1){let t=k();i(0,"tr")(1,"td",32)(2,"div",33),d(3,"i",34),i(4,"p",35),c(5,"No se encontraron workspaces"),r(),i(6,"p-button",36),m("onClick",function(){g(t);let n=u();return f(n.createWorkspace())}),r()()()()}}var C=class s{workspaceService=v(M);router=v(P);confirmationService=v(h);messageService=v(w);workspaces=this.workspaceService.workspaces;isLoading=this.workspaceService.isLoading;searchTerm=_("");isTestingConnection=_(null);isSyncing=_(null);isSyncingAll=_(!1);ngOnInit(){this.loadWorkspaces()}async loadWorkspaces(){try{await this.workspaceService.getAllWorkspaces()}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los workspaces"})}}filteredWorkspaces=I(()=>{let e=this.searchTerm().toLowerCase();return e?this.workspaces().filter(t=>t.name.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)):this.workspaces()});createWorkspace(){this.router.navigate(["/workspaces/create"])}editWorkspace(e){this.router.navigate(["/workspaces/edit",e.id])}disableWorkspace(e){this.confirmationService.confirm({message:`\xBFDesactivar el workspace "${e.name}"? Se mantendr\xE1n todos los datos pero dejar\xE1 de sincronizarse.`,header:"Confirmar Desactivaci\xF3n",icon:"fa fa-exclamation-triangle",acceptLabel:"Desactivar",rejectLabel:"Cancelar",acceptButtonStyleClass:"p-button-warning",accept:async()=>{try{await this.workspaceService.updateWorkspace(e.id,{status:"DISABLED"}),this.messageService.add({severity:"success",summary:"Workspace Desactivado",detail:`El workspace "${e.name}" ha sido desactivado`}),await this.loadWorkspaces()}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo desactivar el workspace"})}}})}async testConnection(e){try{this.isTestingConnection.set(e.id),await this.workspaceService.testConnection(e.id),this.messageService.add({severity:"success",summary:"Conexi\xF3n Exitosa",detail:`El token de "${e.name}" es v\xE1lido`}),await this.loadWorkspaces()}catch(t){this.messageService.add({severity:"error",summary:"Error de Conexi\xF3n",detail:t instanceof Error?t.message:"No se pudo conectar a Hostinger"})}finally{this.isTestingConnection.set(null)}}async syncNow(e){try{this.isSyncing.set(e.id),await this.workspaceService.syncNow(e.id),this.messageService.add({severity:"success",summary:"Sincronizaci\xF3n Completada",detail:`El workspace "${e.name}" se ha sincronizado correctamente`}),await this.loadWorkspaces()}catch(t){this.messageService.add({severity:"error",summary:"Error de Sincronizaci\xF3n",detail:t instanceof Error?t.message:"No se pudo sincronizar"})}finally{this.isSyncing.set(null)}}getStatusTooltip(e,t){switch(e){case"ACTIVE":return"Workspace activo y funcionando correctamente";case"INVALID_TOKEN":return t||"El token de Hostinger es inv\xE1lido o ha expirado. Por favor, actual\xEDcelo.";case"RATE_LIMITED":return"Se ha excedido el l\xEDmite de solicitudes a la API. Intente m\xE1s tarde.";case"ERROR":return t||"Error al conectar con Hostinger. Verifique la configuraci\xF3n.";case"DISABLED":return"Workspace desactivado. No se sincronizar\xE1 autom\xE1ticamente.";default:return e}}deleteWorkspace(e){this.confirmationService.confirm({message:`\xBFEst\xE1s seguro de eliminar el workspace "${e.name}"? Esta acci\xF3n no se puede deshacer.`,header:"Confirmar Eliminaci\xF3n",icon:"fa fa-trash",acceptButtonStyleClass:"p-button-danger",accept:async()=>{try{await this.workspaceService.deleteWorkspace(e.id),this.messageService.add({severity:"success",summary:"Workspace Eliminado",detail:`El workspace "${e.name}" ha sido eliminado`})}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el workspace"})}}})}getStatusSeverity(e){switch(e){case"ACTIVE":return"success";case"INVALID_TOKEN":case"ERROR":return"danger";case"RATE_LIMITED":return"warn";case"DISABLED":return"info";default:return"info"}}getStatusLabel(e){switch(e){case"ACTIVE":return"Activo";case"INVALID_TOKEN":return"Token Inv\xE1lido";case"RATE_LIMITED":return"L\xEDmite Excedido";case"ERROR":return"Error";case"DISABLED":return"Desactivado";default:return e}}formatDate(e){return e?"seconds"in e?new Date(e.seconds*1e3).toLocaleDateString("es-ES"):e.toLocaleDateString("es-ES"):"Nunca"}async syncAllWorkspaces(){this.confirmationService.confirm({message:"\xBFDeseas sincronizar TODOS los workspaces activos? Esto puede tomar varios minutos.",header:"Confirmar Sincronizaci\xF3n Batch",icon:"fa fa-exclamation-triangle",acceptLabel:"S\xED, sincronizar",rejectLabel:"Cancelar",accept:async()=>{try{this.isSyncingAll.set(!0),this.messageService.add({severity:"info",summary:"Sincronizaci\xF3n Iniciada",detail:"Sincronizando todos los workspaces activos...",life:3e3});let e=await this.workspaceService.syncAllWorkspaces();this.messageService.add({severity:"success",summary:"Sincronizaci\xF3n Completada",detail:`
              Total: ${e.totalWorkspaces} workspaces
              \u2705 \xC9xitos: ${e.successCount}
              \u274C Fallos: ${e.failureCount}
              \u23ED\uFE0F Saltados: ${e.skippedCount}
              \u{1F6AB} Deshabilitados: ${e.disabledCount}
            `,life:8e3}),await this.loadWorkspaces()}catch(e){this.messageService.add({severity:"error",summary:"Error en Sincronizaci\xF3n",detail:e instanceof Error?e.message:"Error desconocido",life:5e3})}finally{this.isSyncingAll.set(!1)}}})}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=x({type:s,selectors:[["app-workspaces"]],features:[D([h,w])],decls:19,vars:12,consts:[["role","main","aria-label","Gesti\xF3n de workspaces",1,"fade-in"],[1,"flex","flex-wrap","justify-content-between","align-items-center","mb-4","gap-3"],[1,"app-page-title","m-0"],[1,"fa","fa-cubes","text-primary","mr-2"],["role","group","aria-label","Acciones principales",1,"flex","gap-2"],["label","Sincronizar Todos","icon","fa fa-refresh","severity","secondary","pTooltip","Sincronizar manualmente todos los workspaces activos","tooltipPosition","bottom",3,"onClick","outlined","loading"],["label","Nuevo Workspace","icon","fa fa-plus",3,"onClick"],["role","search",1,"search-container","mb-4"],["iconPosition","left"],[1,"fa","fa-search"],["pInputText","","type","text","placeholder","Buscar workspaces...","aria-label","Buscar workspaces por nombre o descripci\xF3n",1,"w-full",3,"input","value"],["currentPageReportTemplate","Mostrando {first} a {last} de {totalRecords} workspaces","responsiveLayout","scroll",1,"p-datatable-striped",3,"value","loading","paginator","rows","rowsPerPageOptions","showCurrentPageReport","globalFilterFields"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pSortableColumn","name"],["field","name"],["pSortableColumn","status"],["field","status"],["pSortableColumn","lastSyncAt"],["field","lastSyncAt"],["pSortableColumn","createdAt"],["field","createdAt"],[1,"text-sm","text-gray-500"],[3,"value","severity","pTooltip"],[1,"flex","gap-2"],["icon","fa fa-wifi","severity","secondary","pTooltip","Test connection",3,"onClick","rounded","text","loading"],["icon","fa fa-refresh","severity","secondary","pTooltip","Sync now",3,"onClick","rounded","text","loading"],["icon","fa fa-pencil","severity","info","pTooltip","Editar",3,"onClick","rounded","text"],["icon","fa fa-ban","severity","warn","pTooltip","Desactivar",3,"rounded","text"],["icon","fa fa-trash","severity","danger","pTooltip","Eliminar",3,"onClick","rounded","text"],["icon","fa fa-ban","severity","warn","pTooltip","Desactivar",3,"onClick","rounded","text"],["colspan","5",1,"text-center"],[1,"py-5"],[1,"fa","fa-inbox","text-4xl","text-gray-400"],[1,"mt-3","text-gray-500"],["label","Crear Primer Workspace","icon","fa fa-plus",1,"mt-3",3,"onClick"]],template:function(t,a){t&1&&(i(0,"div",0),d(1,"p-toast")(2,"p-confirmDialog"),i(3,"div",1)(4,"h1",2),d(5,"i",3),c(6," Workspaces "),r(),i(7,"div",4)(8,"p-button",5),m("onClick",function(){return a.syncAllWorkspaces()}),r(),i(9,"p-button",6),m("onClick",function(){return a.createWorkspace()}),r()()(),i(10,"p-card")(11,"div",7)(12,"p-iconField",8),d(13,"p-inputIcon",9),i(14,"input",10),m("input",function(l){return a.searchTerm.set(l.target.value)}),r()()(),i(15,"p-table",11),b(16,le,15,0,"ng-template",12)(17,de,19,18,"ng-template",13)(18,me,7,0,"ng-template",14),r()()()),t&2&&(o(8),p("outlined",!0)("loading",a.isSyncingAll()),o(6),p("value",a.searchTerm()),o(),p("value",a.filteredWorkspaces())("loading",a.isLoading())("paginator",!0)("rows",10)("rowsPerPageOptions",S(10,se))("showCurrentPageReport",!0)("globalFilterFields",S(11,ce)))},dependencies:[oe,re,A,ae,ne,N,L,J,U,K,H,ie,te,ee,X,Q,j,B,Z,R,z,F,$,O,V],styles:[".ng-animating[_ngcontent-%COMP%]{overflow:hidden}h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-color)}.search-container[_ngcontent-%COMP%]{max-width:400px}.search-container[_ngcontent-%COMP%]     input{transition:all .3s cubic-bezier(.4,0,.2,1)}.search-container[_ngcontent-%COMP%]     input:focus{transform:translateY(-1px);box-shadow:0 4px 12px #0000001a}.text-overflow[_ngcontent-%COMP%]{display:block;max-width:300px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}"],data:{animation:[Y,q,G]},changeDetection:0})};export{C as default};

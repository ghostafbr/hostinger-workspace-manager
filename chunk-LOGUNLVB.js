import{a as oe,b as re}from"./chunk-LZAUEQAN.js";import{b as le,c as se}from"./chunk-FYGEUYEJ.js";import{e as me}from"./chunk-5R2X6POM.js";import"./chunk-XXMBZZ37.js";import"./chunk-NHWKIFHZ.js";import{g as pe,h as ge,i as ue,j as _e}from"./chunk-GCQ2WIT6.js";import{a as ce,b as de}from"./chunk-XNM27DCK.js";import"./chunk-PPZFH2ZV.js";import{a as te,b as ne}from"./chunk-2MAXEO6Q.js";import"./chunk-Q5HFPYVW.js";import"./chunk-46UKYMVD.js";import"./chunk-OL6EOTCO.js";import{h as Z,i as ee}from"./chunk-6BTVTWSQ.js";import{f as q,i as Y,q as J,v as Q,w as X}from"./chunk-Z4BNMZT3.js";import"./chunk-47X5BFEM.js";import{c as K,d as j}from"./chunk-JUILAC2W.js";import{a as ie,b as ae}from"./chunk-SPDGIFFF.js";import"./chunk-TOC7PNXQ.js";import"./chunk-JNP63KUK.js";import{Ia as E,Ma as B,e as F,gb as H,hb as G,i as z,k as R,m as W,x as $,z as U}from"./chunk-WQRABBEY.js";import{Ab as l,Hb as O,Mb as f,Ob as p,Pa as r,U as x,Yb as h,Z as u,_,ac as N,bb as D,bc as o,cc as g,dc as y,hb as v,ja as P,jc as V,kc as b,rb as S,sb as M,sc as A,uc as w,xb as m,yb as e,zb as i}from"./chunk-XTNRL3Y3.js";var Ce=()=>[10,25,50,100],xe=()=>["action","actorEmail","workspaceId"],Pe=()=>({"min-width":"70rem"}),fe=()=>({width:"100%","max-width":"100vw"});function ye(a,n){a&1&&(e(0,"div",8),l(1,"p-skeleton",15),e(2,"div",16),l(3,"p-skeleton",17),i()())}function Se(a,n){if(a&1&&(e(0,"div",9)(1,"p-card")(2,"div",18)(3,"div",19),l(4,"i",20),i(),e(5,"div",21)(6,"div",22),o(7,"Total Acciones (24h)"),i(),e(8,"div",23),o(9),i(),e(10,"div",24),o(11,"Registros procesados"),i()()()(),e(12,"p-card")(13,"div",18)(14,"div",25),l(15,"i",26),i(),e(16,"div",21)(17,"div",22),o(18,"Tasa de \xC9xito"),i(),e(19,"div",23),o(20),A(21,"number"),i(),e(22,"div",27)(23,"span",28),o(24),i(),e(25,"span",29),o(26),i()()()()(),e(27,"p-card")(28,"div",18)(29,"div",30),l(30,"i",31),i(),e(31,"div",21)(32,"div",22),o(33,"Acci\xF3n M\xE1s Frecuente"),i(),e(34,"div",32),o(35),i(),e(36,"div",24),o(37,"Mayor actividad reciente"),i()()()(),e(38,"p-card")(39,"div",18)(40,"div",33),l(41,"i",34),i(),e(42,"div",21)(43,"div",22),o(44,"Sistema"),i(),e(45,"div",23),o(46,"Audit"),i(),e(47,"div",24),o(48,"Logging Activo"),i()()()()()),a&2){let t=n;r(9),g(t.total),r(11),y("",w(21,5,t.successRate,"1.0-1"),"%"),r(4),y("\u2713 ",t.success),r(2),y("\u2717 ",t.failure),r(9),g(t.topAction)}}function Me(a,n){if(a&1&&(e(0,"div",44),l(1,"i",45),e(2,"div"),o(3),i()()),a&2){let t=p().$implicit;r(3),g(t.label)}}function Oe(a,n){if(a&1&&v(0,Me,4,1,"div",43),a&2){let t=n.$implicit;m("ngIf",t)}}function he(a,n){if(a&1&&(e(0,"div",44),l(1,"i",46),e(2,"div"),o(3),i()()),a&2){let t=n.$implicit;r(3),g(t.label)}}function Ae(a,n){if(a&1&&(e(0,"div",44),l(1,"i",47),e(2,"div"),o(3),i()()),a&2){let t=p().$implicit;r(3),g(t.label)}}function we(a,n){if(a&1&&v(0,Ae,4,1,"div",43),a&2){let t=n.$implicit;m("ngIf",t)}}function Ee(a,n){if(a&1&&(e(0,"div",44),l(1,"i",48),e(2,"div"),o(3),i()()),a&2){let t=n.$implicit;r(3),g(t.label)}}function ke(a,n){if(a&1){let t=O();e(0,"div",35)(1,"div",36),l(2,"i",37),e(3,"input",38),f("input",function(c){u(t),p();let d=h(14);return _(d.filterGlobal(c.target.value,"contains"))}),i()(),e(4,"p-select",39),f("onChange",function(c){u(t);let d=p(),C=h(14);return d.selectedAction.set(c.value),_(C.filter(c.value,"action","equals"))}),v(5,Oe,1,1,"ng-template",40)(6,he,4,1,"ng-template",41),i(),e(7,"p-select",42),f("onChange",function(c){u(t);let d=p(),C=h(14);return d.selectedStatus.set(c.value),_(C.filter(c.value,"status","equals"))}),v(8,we,1,1,"ng-template",40)(9,Ee,4,1,"ng-template",41),i()()}if(a&2){let t=p();r(4),m("options",t.actionOptions)("ngModel",t.selectedAction())("showClear",!0)("panelStyle",b(8,fe)),r(3),m("options",t.statusOptions)("ngModel",t.selectedStatus())("showClear",!0)("panelStyle",b(9,fe))}}function Te(a,n){a&1&&(e(0,"tr")(1,"th",49),o(2," Fecha "),l(3,"p-sortIcon",50),i(),e(4,"th",51),o(5," Acci\xF3n "),l(6,"p-sortIcon",52),i(),e(7,"th",53),o(8," Usuario "),l(9,"p-sortIcon",54),i(),e(10,"th",55),o(11,"Workspace"),i(),e(12,"th",56),o(13,"Estado"),i(),e(14,"th",56),o(15,"Acciones"),i()())}function Le(a,n){if(a&1&&(e(0,"span",64),o(1),i()),a&2){let t=p().$implicit;r(),g(t.workspaceId)}}function Ie(a,n){a&1&&(e(0,"span",65),o(1,"Sistema"),i())}function De(a,n){if(a&1){let t=O();e(0,"tr")(1,"td")(2,"div",57),l(3,"i",58),e(4,"span"),o(5),A(6,"date"),i()()(),e(7,"td")(8,"div",59),l(9,"i",60),e(10,"span",61),o(11),i()()(),e(12,"td")(13,"div",62),l(14,"i",63),o(15),i()(),e(16,"td"),S(17,Le,2,1,"span",64)(18,Ie,2,0,"span",65),i(),e(19,"td",56),l(20,"p-tag",66),i(),e(21,"td",56)(22,"p-button",67),f("onClick",function(){let c=u(t).$implicit,d=p();return _(d.onViewDetails(c))}),i()()()}if(a&2){let t=n.$implicit,s=p();r(5),g(w(6,11,t.createdAt.toDate(),"dd/MM/yyyy HH:mm:ss")),r(4),N(t.getActionIcon()),r(2),g(t.getActionLabel()),r(4),y(" ",t.actorEmail||t.actorUid," "),r(2),M(t.workspaceId?17:18),r(3),m("value",t.getStatusLabel())("severity",s.getHealthSeverity(t.status))("icon",s.getStatusIcon(t.status)),r(2),m("rounded",!0)("text",!0)}}function Ne(a,n){a&1&&(e(0,"tr")(1,"td",68)(2,"div",69),l(3,"i",70),e(4,"p"),o(5,"No se encontraron registros de auditor\xEDa"),i()()()())}var k=class a{auditLogService=x(me);route=x($);router=x(U);messageService=x(E);auditLogs=this.auditLogService.auditLogs;isLoading=this.auditLogService.isLoading;error=this.auditLogService.error;stats=P(null);workspaceId=P(void 0);selectedAction=P(null);selectedStatus=P(null);actionOptions=[{label:"Crear Workspace",value:"workspace.create"},{label:"Actualizar Workspace",value:"workspace.update"},{label:"Deshabilitar Workspace",value:"workspace.disable"},{label:"Guardar Token",value:"token.save"},{label:"Probar Conexi\xF3n",value:"token.test"},{label:"Sincronizaci\xF3n Manual",value:"sync.manual"},{label:"Sincronizaci\xF3n Programada",value:"sync.scheduled"},{label:"Generar Alertas",value:"alert.generate"}];statusOptions=[{label:"\xC9xito",value:"success"},{label:"Fallo",value:"failed"},{label:"Parcial",value:"partial"}];ngOnInit(){this.route.paramMap.subscribe(n=>{let t=n.get("workspaceId");t&&this.workspaceId.set(t),this.loadData()})}async loadData(){try{let n=this.workspaceId(),[t,s]=await Promise.all([n?this.auditLogService.getWorkspaceAuditLogs(n):this.auditLogService.getRecentAuditLogs(),this.auditLogService.getAuditStats(n)]),c=s.total,d=s.success,C=s.failure,ve=c>0?d/c*100:0,T="N/A",L=0;for(let[be,I]of Object.entries(s.byAction))I>L&&(L=I,T=be);this.stats.set({total:c,success:d,failure:C,successRate:ve,topAction:this.formatActionLabel(T)})}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los datos de auditor\xEDa"})}}formatActionLabel(n){return{"workspace.create":"Crear Workspace","workspace.update":"Actualizar Workspace","workspace.disable":"Deshabilitar Workspace","workspace.delete":"Eliminar Workspace","token.save":"Guardar Token","token.test":"Probar Conexi\xF3n","sync.manual":"Sync Manual","sync.scheduled":"Sync Auto","alert.generate":"Generar Alertas","dns.view":"Ver DNS","dns.validate":"Validar DNS"}[n]||n}onViewDetails(n){let t=n.meta?JSON.stringify(n.meta,null,2):"N/A";this.messageService.add({severity:"info",summary:`${n.getActionLabel()} - ${n.getStatusLabel()}`,detail:`Usuario: ${n.actorEmail||n.actorUid}
${n.errorMessage||t}`,life:8e3})}goBack(){let n=this.workspaceId();n?this.router.navigate(["/w",n]):this.router.navigate(["/dashboard"])}getHealthSeverity(n){switch(n){case"success":return"success";case"partial":return"warn";case"failed":return"danger";default:return"info"}}getStatusIcon(n){return{success:"fa fa-check-circle",failure:"fa fa-times-circle",partial:"fa fa-exclamation-circle"}[n]||"fa fa-info-circle"}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=D({type:a,selectors:[["app-audit-logs-page"]],features:[V([E])],decls:19,vars:16,consts:[["dt",""],[1,"fade-in"],[1,"p-toolbar-group-start"],[1,"app-page-title"],[1,"fa","fa-history"],[1,"p-toolbar-group-end"],["label","Actualizar","icon","fa fa-refresh","severity","secondary","size","small","pTooltip","Actualizar logs","tooltipPosition","bottom",3,"onClick","outlined","loading"],["label","Volver","icon","fa fa-arrow-left","severity","secondary","size","small",1,"ml-2",3,"onClick","outlined"],[1,"loading-container"],[1,"summary-cards"],[1,"p-datatable-sm",3,"value","loading","paginator","rows","rowsPerPageOptions","globalFilterFields","tableStyle","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["height","200px","width","100%"],[1,"mt-4"],["height","400px","width","100%"],[1,"stat-card"],[1,"stat-icon","total"],[1,"fa","fa-list-ul"],[1,"stat-content"],[1,"stat-label"],[1,"stat-value"],[1,"stat-subtitle"],[1,"stat-icon","success"],[1,"fa","fa-check-circle"],[1,"stat-breakdown"],[1,"success"],[1,"danger"],[1,"stat-icon","action"],[1,"fa","fa-star"],[1,"stat-value","text-sm"],[1,"stat-icon","system"],[1,"fa","fa-server"],[1,"filter-toolbar"],[1,"search-wrapper"],[1,"fa","fa-search","search-icon"],["pInputText","","type","text","placeholder","Buscar...",1,"glass-input","with-icon",3,"input"],["placeholder","Todas las acciones","styleClass","glass-dropdown","appendTo","body",3,"onChange","options","ngModel","showClear","panelStyle"],["pTemplate","selectedItem"],["pTemplate","item"],["placeholder","Todos los estados","styleClass","glass-dropdown","appendTo","body",3,"onChange","options","ngModel","showClear","panelStyle"],["class","flex align-items-center gap-2",4,"ngIf"],[1,"flex","align-items-center","gap-2"],[1,"fa","fa-bolt","text-primary-500"],[1,"fa","fa-bolt","text-primary-400"],[1,"fa","fa-tag","text-primary-500"],[1,"fa","fa-tag","text-primary-400"],["pSortableColumn","createdAt"],["field","createdAt"],["pSortableColumn","action"],["field","action"],["pSortableColumn","actorEmail"],["field","actorEmail"],["pSortableColumn","workspaceId"],[2,"text-align","center"],[1,"d-flex","align-items-center"],[1,"fa","fa-calendar","mr-2","text-primary-400"],[1,"action-cell"],[1,"mr-2","text-primary-500"],[1,"font-medium"],[1,"actor-cell"],[1,"fa","fa-user","mr-2","text-primary-400"],[1,"workspace-badge"],[1,"text-muted"],[3,"value","severity","icon"],["icon","fa fa-eye","severity","secondary","pTooltip","Ver detalles",3,"onClick","rounded","text"],["colspan","6",2,"text-align","center","padding","3rem"],[1,"empty-state"],[1,"fa","fa-inbox"]],template:function(t,s){if(t&1){let c=O();e(0,"div",1),l(1,"p-toast"),e(2,"p-toolbar")(3,"div",2)(4,"h2",3),l(5,"i",4),o(6," Audit Logs "),i()(),e(7,"div",5)(8,"p-button",6),f("onClick",function(){return u(c),_(s.loadData())}),i(),e(9,"p-button",7),f("onClick",function(){return u(c),_(s.goBack())}),i()()(),S(10,ye,4,0,"div",8),S(11,Se,49,8,"div",9),e(12,"p-card")(13,"p-table",10,0),v(15,ke,10,10,"ng-template",11)(16,Te,16,0,"ng-template",12)(17,De,23,14,"ng-template",13)(18,Ne,6,0,"ng-template",14),i()()()}if(t&2){let c;r(8),m("outlined",!0)("loading",s.isLoading()),r(),m("outlined",!0),r(),M(s.isLoading()&&!s.stats()?10:-1),r(),M((c=s.stats())?11:-1,c),r(2),m("value",s.auditLogs())("loading",s.isLoading())("paginator",!0)("rows",10)("rowsPerPageOptions",b(13,Ce))("globalFilterFields",b(14,xe))("tableStyle",b(15,Pe))("rowHover",!0)}},dependencies:[W,F,J,q,Y,ae,ie,B,G,H,re,oe,se,le,de,ce,_e,pe,ge,ue,ne,te,j,K,X,Q,ee,Z,R,z],styles:[".loading-container[_ngcontent-%COMP%]{margin:2rem 0}.summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin:1.5rem 0}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:1rem}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.75rem}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon.total[_ngcontent-%COMP%]{background:#3b82f626;color:#3b82f6;border:1px solid rgba(59,130,246,.2)}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon.success[_ngcontent-%COMP%]{background:#10b98126;color:#10b981;border:1px solid rgba(16,185,129,.2)}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon.action[_ngcontent-%COMP%]{background:#8b5cf626;color:#8b5cf6;border:1px solid rgba(139,92,246,.2)}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon.system[_ngcontent-%COMP%]{background:#f59e0b26;color:#f59e0b;border:1px solid rgba(245,158,11,.2)}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]{flex:1}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-color-secondary);margin-bottom:.25rem}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:var(--text-color);margin-bottom:.25rem}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-value.text-sm[_ngcontent-%COMP%]{font-size:1.25rem}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-subtitle[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-color-secondary)}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-breakdown[_ngcontent-%COMP%]{display:flex;gap:.75rem;font-size:.875rem;margin-top:.25rem}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-breakdown[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]{color:var(--green-600);font-weight:600}.summary-cards[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-breakdown[_ngcontent-%COMP%]   .danger[_ngcontent-%COMP%]{color:var(--red-600);font-weight:600}.filter-toolbar[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;flex-wrap:wrap;padding:.5rem 0}.filter-toolbar[_ngcontent-%COMP%]   .search-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.filter-toolbar[_ngcontent-%COMP%]   .search-wrapper[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;left:1rem;color:var(--primary-color);pointer-events:none;z-index:1}.filter-toolbar[_ngcontent-%COMP%]   .search-wrapper[_ngcontent-%COMP%]   .glass-input[_ngcontent-%COMP%]{padding-left:2.5rem;border-radius:12px;border:1px solid rgba(0,0,0,.08);background:#fff9;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);transition:all .2s;min-width:250px}.filter-toolbar[_ngcontent-%COMP%]   .search-wrapper[_ngcontent-%COMP%]   .glass-input[_ngcontent-%COMP%]:focus{background:#fff;border-color:var(--primary-color);box-shadow:0 0 0 1px var(--primary-color-alpha, rgba(var(--primary-rgb), .2))}.filter-toolbar[_ngcontent-%COMP%]   .search-wrapper[_ngcontent-%COMP%]   .glass-input.p-inputtext[_ngcontent-%COMP%]{padding-left:2.5rem}.filter-toolbar[_ngcontent-%COMP%]     .glass-dropdown{border-radius:12px;border:1px solid rgba(0,0,0,.08);background:#fff9;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);min-width:200px}.filter-toolbar[_ngcontent-%COMP%]     .glass-dropdown .p-select-label{padding-top:.65rem;padding-bottom:.65rem}.filter-toolbar[_ngcontent-%COMP%]     .glass-dropdown.p-focus{background:#fff;border-color:var(--primary-color);box-shadow:none}.text-muted[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-style:italic}.mr-2[_ngcontent-%COMP%]{margin-right:.5rem}.text-primary-400[_ngcontent-%COMP%]{color:var(--primary-400)}.text-primary-500[_ngcontent-%COMP%]{color:var(--primary-500)}.workspace-badge[_ngcontent-%COMP%]{background:var(--surface-100);padding:.25rem .5rem;border-radius:6px;font-family:monospace;font-size:.9rem;color:var(--text-color)}.empty-state[_ngcontent-%COMP%]{padding:3rem;text-align:center}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;color:var(--text-color-secondary);margin-bottom:1rem;opacity:.5}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-size:1rem}"],changeDetection:0})};export{k as default};

import{a as Q,b as U,c as te,d as ne}from"./chunk-EPT4XMSD.js";import{b as X,c as Y}from"./chunk-DUNBGOMI.js";import{b as le}from"./chunk-4TGFOJUN.js";import{e as ie}from"./chunk-NAN6DTRC.js";import"./chunk-BNR7GPDI.js";import"./chunk-F2WO2M6U.js";import{e as oe,f as re,g as ae,h as se}from"./chunk-PX2VNWV3.js";import{a as Z,b as ee}from"./chunk-OYI76HVB.js";import"./chunk-OOKHGSBK.js";import{a as G,b as W}from"./chunk-T2TEUMJK.js";import"./chunk-LOKH2QTJ.js";import"./chunk-5WKTPFE2.js";import"./chunk-OL6EOTCO.js";import"./chunk-HD6MQK7W.js";import{d as F,e as H}from"./chunk-SQZEKQLI.js";import{a as J,b as K}from"./chunk-ICJIXMS7.js";import"./chunk-DTZPPQAO.js";import{Aa as A,Qb as j,Rb as q,f as $,pb as b,qb as x,u as B,w as N,wa as P}from"./chunk-B5FRUK7K.js";import{$b as O,Fb as C,Kb as u,Lb as c,Oa as l,T as S,Vb as D,Y as g,Z as _,_b as s,ab as v,ac as V,fc as I,gb as k,gc as R,ia as E,oc as z,pb as y,qb as f,qc as L,vb as m,wb as n,xb as o,yb as a,yc as w,zc as T}from"./chunk-PY5EWUYY.js";var de=()=>[10,25,50],ue=()=>({"min-width":"70rem"});function ge(i,t){if(i&1){let e=C();n(0,"div",6)(1,"div",7)(2,"h2"),a(3,"i",8),s(4," Historial de Sincronizaciones"),o(),a(5,"p-chip",9),o(),n(6,"div",10)(7,"span",11),a(8,"i",12),n(9,"input",13),u("input",function(p){g(e),c();let d=D(1);return _(d.filterGlobal(p.target.value,"contains"))}),o()()()()}if(i&2){let e=c();l(5),m("label",e.syncRuns().length.toString())}}function _e(i,t){i&1&&(n(0,"tr")(1,"th",14),s(2," Inicio "),a(3,"p-sortIcon",15),o(),n(4,"th"),s(5,"Duraci\xF3n"),o(),n(6,"th",16),s(7,"Dominios"),o(),n(8,"th",16),s(9,"Suscripciones"),o(),n(10,"th",16),s(11,"Estado"),o(),n(12,"th"),s(13,"Errores"),o(),n(14,"th",16),s(15,"Acciones"),o()())}function ye(i,t){if(i&1&&a(0,"p-chip",18),i&2){let e=c().$implicit,r=c();m("label",r.formatDuration(e.getDuration()))}}function fe(i,t){i&1&&(n(0,"span",19),s(1,"En progreso..."),o())}function Ce(i,t){if(i&1){let e=C();n(0,"p-button",26),u("onClick",function(){g(e);let p=c().$implicit,d=c();return _(d.viewErrors.emit(p))}),o()}if(i&2){let e=c().$implicit;m("label",e.errors.length+" error(es)")("text",!0)("size","small")}}function Se(i,t){i&1&&(n(0,"span",24),a(1,"i",27),s(2," Sin errores "),o())}function ve(i,t){if(i&1){let e=C();n(0,"tr")(1,"td"),a(2,"i",17),s(3),z(4,"date"),o(),n(5,"td"),y(6,ye,1,1,"p-chip",18)(7,fe,2,0,"span",19),o(),n(8,"td",16),a(9,"p-chip",20),o(),n(10,"td",16),a(11,"p-chip",21),o(),n(12,"td",16),a(13,"p-tag",22),o(),n(14,"td"),y(15,Ce,1,3,"p-button",23)(16,Se,3,0,"span",24),o(),n(17,"td",16)(18,"p-button",25),u("onClick",function(){let p=g(e).$implicit,d=c();return _(d.viewDetails.emit(p))}),o()()()}if(i&2){let e=t.$implicit,r=c();l(3),V(" ",L(4,10,e.startedAt.toDate(),"dd/MM/yyyy HH:mm:ss")," "),l(3),f(e.getDuration()?6:7),l(3),m("label",(e.domainsProcessed||0).toString()),l(2),m("label",(e.subscriptionsProcessed||0).toString()),l(2),m("value",e.getStatusLabel())("severity",e.getSeverity())("icon",r.getStatusIcon(e)),l(2),f(e.errors&&e.errors.length>0?15:16),l(3),m("rounded",!0)("text",!0)}}function be(i,t){i&1&&(n(0,"tr")(1,"td",28),a(2,"i",29),n(3,"p",30),s(4," No se encontraron sincronizaciones "),o()()())}var h=class i{syncRuns=T.required();isLoading=T(!1);viewDetails=w();viewErrors=w();formatDuration(t){let e=Math.floor(t/1e3);if(e<60)return`${e}s`;let r=Math.floor(e/60),p=e%60;return`${r}m ${p}s`}getStatusIcon(t){return t.isSuccess()?"pi pi-check-circle":t.isFailed()?"pi pi-times-circle":t.isPartialSuccess&&t.isPartialSuccess()?"pi pi-exclamation-circle":"pi pi-info-circle"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["app-sync-runs-table"]],inputs:{syncRuns:[1,"syncRuns"],isLoading:[1,"isLoading"]},outputs:{viewDetails:"viewDetails",viewErrors:"viewErrors"},decls:6,vars:9,consts:[["dt",""],["styleClass","p-datatable-sm",3,"value","loading","paginator","rows","rowsPerPageOptions","tableStyle","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"table-header"],[1,"header-left"],[1,"pi","pi-sync"],["styleClass","ml-2",3,"label"],[1,"header-right"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Buscar...",3,"input"],["pSortableColumn","startedAt"],["field","startedAt"],[2,"text-align","center"],[1,"pi","pi-calendar","mr-2"],["styleClass","duration-chip",3,"label"],[1,"text-muted"],["styleClass","count-chip","icon","pi pi-globe",3,"label"],["styleClass","count-chip","icon","pi pi-shopping-cart",3,"label"],[3,"value","severity","icon"],["icon","pi pi-exclamation-triangle","severity","danger","pTooltip","Ver errores",3,"label","text","size"],[1,"text-success"],["icon","pi pi-eye","severity","secondary","pTooltip","Ver detalles",3,"onClick","rounded","text"],["icon","pi pi-exclamation-triangle","severity","danger","pTooltip","Ver errores",3,"onClick","label","text","size"],[1,"pi","pi-check-circle","mr-1"],["colspan","7",2,"text-align","center","padding","3rem"],[1,"pi","pi-inbox",2,"font-size","3rem","color","var(--text-color-secondary)"],[2,"margin-top","1rem","color","var(--text-color-secondary)"]],template:function(e,r){e&1&&(n(0,"p-table",1,0),k(2,ge,10,1,"ng-template",2)(3,_e,16,0,"ng-template",3)(4,ve,19,13,"ng-template",4)(5,be,5,0,"ng-template",5),o()),e&2&&m("value",r.syncRuns())("loading",r.isLoading())("paginator",!0)("rows",10)("rowsPerPageOptions",R(7,de))("tableStyle",R(8,ue))("rowHover",!0)},dependencies:[se,oe,A,re,ae,x,b,ne,te,W,G,H,F,q,j,le,$],styles:[".table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--surface-100);border-radius:8px;margin-bottom:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.duration-chip[_ngcontent-%COMP%]{background-color:var(--blue-100);color:var(--blue-900)}.count-chip[_ngcontent-%COMP%]{background-color:var(--surface-200);color:var(--text-color)}.text-muted[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-style:italic}.text-success[_ngcontent-%COMP%]{color:var(--green-600)}"],changeDetection:0})};function xe(i,t){i&1&&(n(0,"p-card"),a(1,"p-skeleton",10),o())}function he(i,t){if(i&1){let e=C();n(0,"p-card")(1,"div",11),a(2,"i",12),n(3,"h2"),s(4,"Error al cargar historial"),o(),n(5,"p"),s(6),o(),n(7,"p-button",13),u("onClick",function(){g(e);let p=c();return _(p.loadSyncRuns())}),o()()()}if(i&2){let e=c();l(6),O(e.error())}}function Re(i,t){if(i&1){let e=C();n(0,"app-sync-runs-table",14),u("viewDetails",function(p){g(e);let d=c();return _(d.onViewDetails(p))})("viewErrors",function(p){g(e);let d=c();return _(d.onViewErrors(p))}),o()}if(i&2){let e=c();m("syncRuns",e.syncRuns())("isLoading",e.isLoading())}}var M=class i{syncRunService=S(ie);route=S(B);router=S(N);messageService=S(P);syncRuns=this.syncRunService.syncRuns;isLoading=this.syncRunService.isLoading;error=this.syncRunService.error;workspaceId=E("");ngOnInit(){this.route.paramMap.subscribe(t=>{let e=t.get("workspaceId");e&&(this.workspaceId.set(e),this.loadSyncRuns())})}async loadSyncRuns(){let t=this.workspaceId();if(t)try{await this.syncRunService.getSyncRunsByWorkspace(t)}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo cargar el historial de sincronizaciones"})}}onViewDetails(t){let e=t.getDurationMs(),r=e?`${Math.floor(e/1e3)}s`:"En progreso";this.messageService.add({severity:"info",summary:"Detalles de Sincronizaci\xF3n",detail:`
        Estado: ${t.status}
        Duraci\xF3n: ${r}
        Dominios: ${t.domainsProcessed||0}
        Suscripciones: ${t.subscriptionsProcessed||0}
      `,life:5e3})}onViewErrors(t){let e=t.errors||[];this.messageService.add({severity:"error",summary:`${e.length} Error(es) en Sincronizaci\xF3n`,detail:e.map(r=>`\u2022 ${r.message}`).join(`
`),life:1e4})}goBack(){let t=this.workspaceId();t?this.router.navigate(["/w",t]):this.router.navigate(["/dashboard"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["app-sync-runs-page"]],features:[I([P])],decls:14,vars:6,consts:[[1,"sync-runs-container"],["styleClass","sync-runs-toolbar"],[1,"p-toolbar-group-start"],[1,"page-title"],[1,"pi","pi-sync"],[1,"p-toolbar-group-end"],["label","Actualizar","icon","pi pi-refresh","pTooltip","Actualizar historial","tooltipPosition","bottom",3,"onClick","outlined","loading"],["label","Volver","icon","pi pi-arrow-left","severity","secondary","styleClass","ml-2",3,"onClick","outlined"],[1,"sync-runs-content"],[3,"syncRuns","isLoading"],["height","400px"],[1,"error-state"],[1,"pi","pi-exclamation-triangle"],["label","Reintentar","icon","pi pi-refresh",3,"onClick"],[3,"viewDetails","viewErrors","syncRuns","isLoading"]],template:function(e,r){e&1&&(n(0,"div",0),a(1,"p-toast"),n(2,"p-toolbar",1)(3,"div",2)(4,"h1",3),a(5,"i",4),s(6," Historial de Sincronizaciones "),o()(),n(7,"div",5)(8,"p-button",6),u("onClick",function(){return r.loadSyncRuns()}),o(),n(9,"p-button",7),u("onClick",function(){return r.goBack()}),o()()(),n(10,"div",8),y(11,xe,2,0,"p-card"),y(12,he,8,1,"p-card"),y(13,Re,1,2,"app-sync-runs-table",9),o()()),e&2&&(l(8),m("outlined",!0)("loading",r.isLoading()),l(),m("outlined",!0),l(2),f(r.isLoading()&&r.syncRuns().length===0?11:-1),l(),f(r.error()&&!r.isLoading()?12:-1),l(),f(r.syncRuns().length>0||!r.isLoading()&&!r.error()?13:-1))},dependencies:[K,J,x,b,U,Q,Y,X,ee,Z,h],styles:[".sync-runs-container[_ngcontent-%COMP%]{min-height:100vh;background-color:var(--surface-50)}.sync-runs-toolbar[_ngcontent-%COMP%]{box-shadow:0 2px 4px #00000014;margin-bottom:2rem;background:#fff;border-bottom:1px solid var(--surface-200)}.page-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;font-weight:700;font-size:1.5rem;color:var(--text-color);margin:0}.page-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.sync-runs-content[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:0 2rem 2rem}.error-state[_ngcontent-%COMP%]{text-align:center;padding:3rem}.error-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--red-500);margin-bottom:1rem}.error-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--text-color);margin-bottom:.5rem}.error-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin-bottom:2rem}@media(max-width:768px){.page-title[_ngcontent-%COMP%]{font-size:1.25rem}.sync-runs-content[_ngcontent-%COMP%]{padding:0 1rem 1rem}}"],changeDetection:0})};export{M as default};

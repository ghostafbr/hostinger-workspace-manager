import{a as X,b as Y}from"./chunk-DIOPOZ55.js";import{b as U}from"./chunk-CNCVOR3E.js";import{a as A}from"./chunk-4IUIVLUN.js";import"./chunk-2RWR6RJP.js";import{b as J,c as Q}from"./chunk-EKL4EG33.js";import{e as ee,f as te,g as ie,h as re}from"./chunk-WC4IU22P.js";import{b as Z}from"./chunk-ZVNDOEXM.js";import"./chunk-KT6VCDEH.js";import{a as H,b as K}from"./chunk-JPKGTB4I.js";import"./chunk-LSJGMPCD.js";import{d as N,e as O,f as R,g as $,h as z,i as F}from"./chunk-L6VG4DHT.js";import{a as q,b as G}from"./chunk-GUUVKBTU.js";import"./chunk-HPQ7OMYE.js";import{Ob as B,Pb as j,nb as V,ob as L,qa as w,u as P,ua as h,ya as M}from"./chunk-M5CBQPDY.js";import{$b as W,Fb as k,Jb as m,Kb as c,Oa as s,T as v,Y as u,Z as g,Zb as l,_b as y,ab as E,ec as D,fc as C,gb as S,ia as f,pb as T,qb as b,tc as I,vb as d,wb as i,xb as r,yb as _}from"./chunk-ZVXIGZDY.js";var ne=()=>[10,25,50],oe=()=>["name","description"];function ae(a,e){if(a&1){let t=k();i(0,"div",9)(1,"h2",10),l(2,"Workspaces"),r(),i(3,"div",11)(4,"p-button",12),m("onClick",function(){u(t);let o=c();return g(o.syncAllWorkspaces())}),r(),i(5,"p-button",13),m("onClick",function(){u(t);let o=c();return g(o.createWorkspace())}),r()()()}if(a&2){let t=c();s(4),d("outlined",!0)("loading",t.isSyncingAll())}}function se(a,e){a&1&&(i(0,"tr")(1,"th",14),l(2,"Nombre "),_(3,"p-sortIcon",15),r(),i(4,"th",16),l(5,"Estado "),_(6,"p-sortIcon",17),r(),i(7,"th",18),l(8,"\xDAltima Sync "),_(9,"p-sortIcon",19),r(),i(10,"th",20),l(11,"Creado "),_(12,"p-sortIcon",21),r(),i(13,"th"),l(14,"Acciones"),r()())}function ce(a,e){if(a&1){let t=k();i(0,"p-button",29),m("onClick",function(){u(t);let o=c().$implicit,p=c();return g(p.disableWorkspace(o))}),r()}a&2&&d("rounded",!0)("text",!0)}function le(a,e){if(a&1){let t=k();i(0,"tr")(1,"td")(2,"strong"),l(3),r(),i(4,"div",22),l(5),r()(),i(6,"td"),_(7,"p-tag",23),r(),i(8,"td"),l(9),r(),i(10,"td"),l(11),r(),i(12,"td")(13,"div",11)(14,"p-button",24),m("onClick",function(){let o=u(t).$implicit,p=c();return g(p.testConnection(o))}),r(),i(15,"p-button",25),m("onClick",function(){let o=u(t).$implicit,p=c();return g(p.syncNow(o))}),r(),i(16,"p-button",26),m("onClick",function(){let o=u(t).$implicit,p=c();return g(p.editWorkspace(o))}),r(),T(17,ce,1,2,"p-button",27),i(18,"p-button",28),m("onClick",function(){let o=u(t).$implicit,p=c();return g(p.deleteWorkspace(o))}),r()()()()}if(a&2){let t=e.$implicit,n=c();s(3),y(t.name),s(2),W(" ",t.description||"Sin descripci\xF3n"," "),s(2),d("value",n.getStatusLabel(t.status))("severity",n.getStatusSeverity(t.status))("pTooltip",n.getStatusTooltip(t.status,t.lastError)),s(2),y(n.formatDate(t.lastSyncAt)),s(2),y(n.formatDate(t.createdAt)),s(3),d("rounded",!0)("text",!0)("loading",n.isTestingConnection()===t.id),s(),d("rounded",!0)("text",!0)("loading",n.isSyncing()===t.id),s(),d("rounded",!0)("text",!0),s(),b(t.status!=="disabled"?17:-1),s(),d("rounded",!0)("text",!0)}}function pe(a,e){if(a&1){let t=k();i(0,"tr")(1,"td",30)(2,"div",31),_(3,"i",32),i(4,"p",33),l(5,"No se encontraron workspaces"),r(),i(6,"p-button",34),m("onClick",function(){u(t);let o=c();return g(o.createWorkspace())}),r()()()()}}var x=class a{workspaceService=v(A);router=v(P);confirmationService=v(w);messageService=v(h);workspaces=this.workspaceService.workspaces;isLoading=this.workspaceService.isLoading;searchTerm=f("");isTestingConnection=f(null);isSyncing=f(null);isSyncingAll=f(!1);ngOnInit(){this.loadWorkspaces()}async loadWorkspaces(){try{await this.workspaceService.getAllWorkspaces()}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los workspaces"})}}filteredWorkspaces=I(()=>{let e=this.searchTerm().toLowerCase();return e?this.workspaces().filter(t=>t.name.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)):this.workspaces()});createWorkspace(){this.router.navigate(["/workspaces/create"])}editWorkspace(e){this.router.navigate(["/workspaces/edit",e.id])}disableWorkspace(e){this.confirmationService.confirm({message:`\xBFDesactivar el workspace "${e.name}"? Se mantendr\xE1n todos los datos pero dejar\xE1 de sincronizarse.`,header:"Confirmar Desactivaci\xF3n",icon:"pi pi-exclamation-triangle",acceptLabel:"Desactivar",rejectLabel:"Cancelar",acceptButtonStyleClass:"p-button-warning",accept:async()=>{try{await this.workspaceService.updateWorkspace(e.id,{status:"DISABLED"}),this.messageService.add({severity:"success",summary:"Workspace Desactivado",detail:`El workspace "${e.name}" ha sido desactivado`}),await this.loadWorkspaces()}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo desactivar el workspace"})}}})}async testConnection(e){try{this.isTestingConnection.set(e.id),await this.workspaceService.testConnection(e.id),this.messageService.add({severity:"success",summary:"Conexi\xF3n Exitosa",detail:`El token de "${e.name}" es v\xE1lido`}),await this.loadWorkspaces()}catch(t){this.messageService.add({severity:"error",summary:"Error de Conexi\xF3n",detail:t instanceof Error?t.message:"No se pudo conectar a Hostinger"})}finally{this.isTestingConnection.set(null)}}async syncNow(e){try{this.isSyncing.set(e.id),await this.workspaceService.syncNow(e.id),this.messageService.add({severity:"success",summary:"Sincronizaci\xF3n Completada",detail:`El workspace "${e.name}" se ha sincronizado correctamente`}),await this.loadWorkspaces()}catch(t){this.messageService.add({severity:"error",summary:"Error de Sincronizaci\xF3n",detail:t instanceof Error?t.message:"No se pudo sincronizar"})}finally{this.isSyncing.set(null)}}getStatusTooltip(e,t){switch(e){case"ACTIVE":return"Workspace activo y funcionando correctamente";case"INVALID_TOKEN":return t||"El token de Hostinger es inv\xE1lido o ha expirado. Por favor, actual\xEDcelo.";case"RATE_LIMITED":return"Se ha excedido el l\xEDmite de solicitudes a la API. Intente m\xE1s tarde.";case"ERROR":return t||"Error al conectar con Hostinger. Verifique la configuraci\xF3n.";case"DISABLED":return"Workspace desactivado. No se sincronizar\xE1 autom\xE1ticamente.";default:return e}}deleteWorkspace(e){this.confirmationService.confirm({message:`\xBFEst\xE1s seguro de eliminar el workspace "${e.name}"? Esta acci\xF3n no se puede deshacer.`,header:"Confirmar Eliminaci\xF3n",icon:"pi pi-trash",acceptButtonStyleClass:"p-button-danger",accept:async()=>{try{await this.workspaceService.deleteWorkspace(e.id),this.messageService.add({severity:"success",summary:"Workspace Eliminado",detail:`El workspace "${e.name}" ha sido eliminado`})}catch{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el workspace"})}}})}getStatusSeverity(e){switch(e){case"ACTIVE":return"success";case"INVALID_TOKEN":case"ERROR":return"danger";case"RATE_LIMITED":return"warn";case"DISABLED":return"info";default:return"info"}}getStatusLabel(e){switch(e){case"ACTIVE":return"Activo";case"INVALID_TOKEN":return"Token Inv\xE1lido";case"RATE_LIMITED":return"L\xEDmite Excedido";case"ERROR":return"Error";case"DISABLED":return"Desactivado";default:return e}}formatDate(e){return e?"seconds"in e?new Date(e.seconds*1e3).toLocaleDateString("es-ES"):e.toLocaleDateString("es-ES"):"Nunca"}async syncAllWorkspaces(){this.confirmationService.confirm({message:"\xBFDeseas sincronizar TODOS los workspaces activos? Esto puede tomar varios minutos.",header:"Confirmar Sincronizaci\xF3n Batch",icon:"pi pi-exclamation-triangle",acceptLabel:"S\xED, sincronizar",rejectLabel:"Cancelar",accept:async()=>{try{this.isSyncingAll.set(!0),this.messageService.add({severity:"info",summary:"Sincronizaci\xF3n Iniciada",detail:"Sincronizando todos los workspaces activos...",life:3e3});let e=await this.workspaceService.syncAllWorkspaces();this.messageService.add({severity:"success",summary:"Sincronizaci\xF3n Completada",detail:`
              Total: ${e.totalWorkspaces} workspaces
              \u2705 \xC9xitos: ${e.successCount}
              \u274C Fallos: ${e.failureCount}
              \u23ED\uFE0F Saltados: ${e.skippedCount}
              \u{1F6AB} Deshabilitados: ${e.disabledCount}
            `,life:8e3}),await this.loadWorkspaces()}catch(e){this.messageService.add({severity:"error",summary:"Error en Sincronizaci\xF3n",detail:e instanceof Error?e.message:"Error desconocido",life:5e3})}finally{this.isSyncingAll.set(!1)}}})}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=E({type:a,selectors:[["app-workspaces"]],features:[D([w,h])],decls:13,vars:10,consts:[[1,"workspaces-container"],["pTemplate","header"],[1,"search-container","mb-4"],["iconPosition","left"],["styleClass","pi pi-search"],["pInputText","","type","text","placeholder","Buscar workspaces...",1,"w-full",3,"input","value"],["currentPageReportTemplate","Mostrando {first} a {last} de {totalRecords} workspaces","styleClass","p-datatable-striped","responsiveLayout","scroll",3,"value","loading","paginator","rows","rowsPerPageOptions","showCurrentPageReport","globalFilterFields"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"page-header"],[1,"m-0"],[1,"flex","gap-2"],["label","\u{1F9EA} Sincronizar Todos","icon","pi pi-sync","severity","secondary","pTooltip","TEMP: Test batch sync (producci\xF3n usa cron job a las 03:00 AM)","tooltipPosition","bottom",3,"onClick","outlined","loading"],["label","Nuevo Workspace","icon","pi pi-plus",3,"onClick"],["pSortableColumn","name"],["field","name"],["pSortableColumn","status"],["field","status"],["pSortableColumn","lastSyncAt"],["field","lastSyncAt"],["pSortableColumn","createdAt"],["field","createdAt"],[1,"text-sm","text-gray-500"],[3,"value","severity","pTooltip"],["icon","pi pi-wifi","severity","secondary","pTooltip","Test connection",3,"onClick","rounded","text","loading"],["icon","pi pi-refresh","severity","secondary","pTooltip","Sync now",3,"onClick","rounded","text","loading"],["icon","pi pi-pencil","severity","info","pTooltip","Editar",3,"onClick","rounded","text"],["icon","pi pi-ban","severity","warn","pTooltip","Desactivar",3,"rounded","text"],["icon","pi pi-trash","severity","danger","pTooltip","Eliminar",3,"onClick","rounded","text"],["icon","pi pi-ban","severity","warn","pTooltip","Desactivar",3,"onClick","rounded","text"],["colspan","5",1,"text-center"],[1,"py-5"],[1,"pi","pi-inbox","text-4xl","text-gray-400"],[1,"mt-3","text-gray-500"],["label","Crear Primer Workspace","icon","pi pi-plus","styleClass","mt-3",3,"onClick"]],template:function(t,n){t&1&&(i(0,"div",0),_(1,"p-toast")(2,"p-confirmDialog"),i(3,"p-card"),S(4,ae,6,2,"ng-template",1),i(5,"div",2)(6,"p-iconField",3),_(7,"p-inputIcon",4),i(8,"input",5),m("input",function(p){return n.searchTerm.set(p.target.value)}),r()()(),i(9,"p-table",6),S(10,se,15,0,"ng-template",1)(11,le,19,18,"ng-template",7)(12,pe,7,0,"ng-template",8),r()()()),t&2&&(s(8),d("value",n.searchTerm()),s(),d("value",n.filteredWorkspaces())("loading",n.isLoading())("paginator",!0)("rows",10)("rowsPerPageOptions",C(8,ne))("showCurrentPageReport",!0)("globalFilterFields",C(9,oe)))},dependencies:[re,ee,M,te,ie,L,V,G,q,K,H,Z,Y,X,Q,J,j,B,U,$,R,F,z,O,N],styles:[".workspaces-container[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto}.workspaces-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1.5rem;background:var(--surface-card)}.workspaces-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-color)}.workspaces-container[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]{max-width:400px}.workspaces-container[_ngcontent-%COMP%]   .text-overflow[_ngcontent-%COMP%]{display:block;max-width:300px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}"],changeDetection:0})};export{x as default};

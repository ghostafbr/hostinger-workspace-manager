import{f as l,h as a,i as p,j as f,k as m,l as D,n as g,u as h}from"./chunk-JNP63KUK.js";import{P as b,a as u,b as d,ja as o}from"./chunk-XTNRL3Y3.js";var y=class c{firestore=h.getFirestore();subscriptions=o([]);isLoading=o(!1);error=o(null);async getSubscriptions(t){try{this.isLoading.set(!0),this.error.set(null);let e=t.pageSize||20,r=a(l(this.firestore,"subscriptions"),p("workspaceId","==",t.workspaceId),f("expiresAt","asc"),m(e));t.lastDoc&&(r=a(r,D(t.lastDoc)));let s=(await g(r)).docs.map(n=>d(u({},n.data()),{id:n.id}));if(t.searchText){let n=t.searchText.toLowerCase();s=s.filter(w=>w.productName?.toLowerCase().includes(n))}return t.autoRenewOnly&&(s=s.filter(n=>n.autoRenew===!0)),this.subscriptions.set(s),s}catch(e){let r=e instanceof Error?e.message:"Error desconocido";throw this.error.set(r),console.error("Error fetching subscriptions:",e),e}finally{this.isLoading.set(!1)}}async getAllSubscriptions(t){try{this.isLoading.set(!0),this.error.set(null);let e=a(l(this.firestore,"subscriptions"),p("workspaceId","==",t),f("expiresAt","asc"));return(await g(e)).docs.map(s=>d(u({},s.data()),{id:s.id}))}catch(e){let r=e instanceof Error?e.message:"Error desconocido";throw this.error.set(r),console.error("[SubscriptionService] Error fetching all subscriptions:",e),e instanceof Error&&e.message.includes("index")&&console.error("[SubscriptionService] \u26A0\uFE0F Firestore index required. Check Firebase Console."),e}finally{this.isLoading.set(!1)}}getDaysUntilExpiration(t){let e=this.toDate(t);if(!e)return null;let r=new Date,i=e.getTime()-r.getTime();return Math.ceil(i/(1e3*60*60*24))}getDaysUntilNextBilling(t){let e=this.toDate(t);if(!e)return null;let r=new Date,i=e.getTime()-r.getTime();return Math.ceil(i/(1e3*60*60*24))}getStatusSeverity(t){let e=t.toLowerCase();return e.includes("active")||e.includes("activ")?"success":e.includes("pending")||e.includes("pendiente")?"warn":e.includes("suspended")||e.includes("suspendid")?"danger":e.includes("cancelled")||e.includes("cancelad")?"secondary":"info"}toDate(t){return t?t instanceof Date?t:typeof t=="object"&&"toDate"in t&&typeof t.toDate=="function"?t.toDate():null:null}static \u0275fac=function(e){return new(e||c)};static \u0275prov=b({token:c,factory:c.\u0275fac,providedIn:"root"})};export{y as a};

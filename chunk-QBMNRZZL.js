import{$a as d,Ja as R,Ka as x,La as L,ab as D,p,q as E,r as k}from"./chunk-OPKLNVVY.js";import{P as l,U as w,ja as m,r as c,s as u}from"./chunk-GUMEVBBA.js";var P=class r{auth=D.getAuth();currentUser=m(null);isLoading=m(!0);isAuthenticated=m(!1);authInitialized;authInitializedResolver;constructor(){this.authInitialized=new Promise(e=>{this.authInitializedResolver=e}),this.initAuthListener()}initAuthListener(){x(this.auth,e=>{this.currentUser.set(e),this.isAuthenticated.set(!!e),this.isLoading.set(!1),this.authInitializedResolver&&(this.authInitializedResolver(),this.authInitializedResolver=void 0)})}async signIn(e,t){try{return this.isLoading.set(!0),await R(this.auth,e,t)}finally{this.isLoading.set(!1)}}async signOut(){try{this.isLoading.set(!0),await L(this.auth),this.currentUser.set(null),this.isAuthenticated.set(!1)}finally{this.isLoading.set(!1)}}getCurrentUser(){return this.auth.currentUser}getCurrentUserUid(){return this.auth.currentUser?.uid??null}getCurrentUserEmail(){return this.auth.currentUser?.email??null}isUserAuthenticated(){return this.isAuthenticated()}getUserDisplayName(){let e=this.getCurrentUser();return e?.displayName||e?.email||"Usuario"}async waitForAuthInit(){return this.authInitialized}static \u0275fac=function(t){return new(t||r)};static \u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})};var M=(t=>(t.SENDGRID="sendgrid",t.SMTP="smtp",t))(M||{});var v=(s=>(s.HEALTHY="healthy",s.WARNING="warning",s.CRITICAL="critical",s))(v||{});var f=class r{id;name;userId;description;encryptedToken;status;createdAt;updatedAt;lastTestedAt;lastTestError;lastSyncAt;lastSyncStatus;lastError;lastErrorAt;tags;priority;isFavorite;constructor(e){this.id=e.id,this.name=e.name,this.userId=e.userId,this.description=e.description,this.encryptedToken=e.encryptedToken,this.status=e.status,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.lastTestedAt=e.lastTestedAt,this.lastTestError=e.lastTestError,this.lastSyncAt=e.lastSyncAt,this.lastSyncStatus=e.lastSyncStatus,this.lastError=e.lastError,this.lastErrorAt=e.lastErrorAt,this.tags=e.tags,this.priority=e.priority,this.isFavorite=e.isFavorite}isHealthy(){return this.status==="ACTIVE"}hasTokenIssue(){return this.status==="INVALID_TOKEN"}isRateLimited(){return this.status==="RATE_LIMITED"}isDisabled(){return this.status==="DISABLED"}canSync(){return!this.isDisabled()&&!this.hasTokenIssue()}getStatusMessage(){switch(this.status){case"ACTIVE":return"Active";case"INVALID_TOKEN":return"Invalid Token";case"RATE_LIMITED":return"Rate Limited";case"ERROR":return"Error";case"DISABLED":return"Disabled";default:return"Unknown"}}toFirestore(){return{name:this.name,userId:this.userId,description:this.description,encryptedToken:this.encryptedToken,status:this.status,createdAt:this.createdAt,updatedAt:this.updatedAt,lastTestedAt:this.lastTestedAt,lastTestError:this.lastTestError,lastSyncAt:this.lastSyncAt,lastSyncStatus:this.lastSyncStatus,lastError:this.lastError,lastErrorAt:this.lastErrorAt,tags:this.tags,priority:this.priority,isFavorite:this.isFavorite}}static fromFirestore(e,t){return new r({id:e,name:t.name,userId:t.userId,description:t.description,encryptedToken:t.encryptedToken,status:t.status,createdAt:t.createdAt,updatedAt:t.updatedAt,lastTestedAt:t.lastTestedAt,lastTestError:t.lastTestError,lastSyncAt:t.lastSyncAt,lastSyncStatus:t.lastSyncStatus,lastError:t.lastError,lastErrorAt:t.lastErrorAt,tags:t.tags,priority:t.priority,isFavorite:t.isFavorite})}};var g=class r{id;workspaceId;startAt;endAt;status;domainsProcessed;subscriptionsProcessed;errors;constructor(e){this.id=e.id,this.workspaceId=e.workspaceId,this.startAt=e.startAt,this.endAt=e.endAt,this.status=e.status,this.domainsProcessed=e.domainsProcessed,this.subscriptionsProcessed=e.subscriptionsProcessed,this.errors=e.errors}isRunning(){return this.status==="running"}isSuccess(){return this.status==="success"}isFailed(){return this.status==="failed"}isPartialSuccess(){return this.status==="partial_success"}hasErrors(){return this.errors.length>0}getTotalProcessed(){return this.domainsProcessed+this.subscriptionsProcessed}getDurationMs(){return this.endAt?this.endAt.toMillis()-this.startAt.toMillis():null}getDurationSeconds(){let e=this.getDurationMs();return e?Math.round(e/1e3):null}toFirestore(){return{workspaceId:this.workspaceId,startAt:this.startAt,endAt:this.endAt,status:this.status,domainsProcessed:this.domainsProcessed,subscriptionsProcessed:this.subscriptionsProcessed,errors:this.errors}}static fromFirestore(e,t){return new r({id:e,workspaceId:t.workspaceId,startAt:t.startAt,endAt:t.endAt,status:t.status,domainsProcessed:t.domainsProcessed||0,subscriptionsProcessed:t.subscriptionsProcessed||0,errors:t.errors||[]})}};var y=class{id;workspaceId;entityType;entityId;entityName;daysBefore;expiresAt;createdAt;processed;constructor(e){this.id=e.id,this.workspaceId=e.workspaceId,this.entityType=e.entityType,this.entityId=e.entityId,this.entityName=e.entityName,this.daysBefore=e.daysBefore,this.expiresAt=e.expiresAt,this.createdAt=e.createdAt,this.processed=e.processed}isCritical(){return this.daysBefore<=7}isWarning(){return this.daysBefore>7&&this.daysBefore<=30}isInfo(){return this.daysBefore>30}getSeverity(){return this.daysBefore<=3?"danger":this.daysBefore<=7?"warn":this.daysBefore<=30?"info":"success"}getDaysBeforeLabel(){return this.daysBefore===1?"1 d\xEDa":`${this.daysBefore} d\xEDas`}getEntityTypeLabel(){return this.entityType==="domain"?"Dominio":"Suscripci\xF3n"}};var A=class{id;action;workspaceId;actorUid;actorEmail;createdAt;status;meta;errorMessage;constructor(e){this.id=e.id,this.action=e.action,this.workspaceId=e.workspaceId,this.actorUid=e.actorUid,this.actorEmail=e.actorEmail,this.createdAt=e.createdAt,this.status=e.status,this.meta=e.meta,this.errorMessage=e.errorMessage}isSuccess(){return this.status==="success"}isFailure(){return this.status==="failed"}isPartial(){return this.status==="partial"}getSeverity(){switch(this.status){case"success":return"success";case"failed":return"danger";case"partial":return"warn";default:return"info"}}getActionLabel(){return{"workspace.create":"Crear Workspace","workspace.update":"Actualizar Workspace","workspace.disable":"Deshabilitar Workspace","workspace.delete":"Eliminar Workspace","token.save":"Guardar Token","token.test":"Probar Conexi\xF3n","sync.manual":"Sincronizaci\xF3n Manual","sync.scheduled":"Sincronizaci\xF3n Programada","alert.generate":"Generar Alertas","dns.view":"Ver DNS","dns.validate":"Validar DNS","dns.snapshot":"Snapshot DNS","dns.rollback":"Rollback DNS"}[this.action]||this.action}getStatusLabel(){return{success:"\xC9xito",failure:"Fallo",partial:"Parcial"}[this.status]||this.status}getActionIcon(){return this.action.startsWith("workspace.")?"pi pi-briefcase":this.action.startsWith("token.")?"pi pi-key":this.action.startsWith("sync.")?"pi pi-sync":this.action.startsWith("alert.")?"pi pi-bell":this.action.startsWith("dns.")?"pi pi-globe":"pi pi-file"}isWorkspaceAction(){return this.action.startsWith("workspace.")}isSyncAction(){return this.action.startsWith("sync.")}};var a=class{id;workspaceId;domainName;recordType;name;value;ttl;priority;syncedAt;constructor(e){this.id=e.id,this.workspaceId=e.workspaceId,this.domainName=e.domainName,this.recordType=e.recordType,this.name=e.name,this.value=e.value,this.ttl=e.ttl,this.priority=e.priority,this.syncedAt=e.syncedAt}getFQDN(){return this.name==="@"?this.domainName:`${this.name}.${this.domainName}`}isMXRecord(){return this.recordType==="MX"}isAddressRecord(){return this.recordType==="A"||this.recordType==="AAAA"}hasLowTTL(){return this.ttl<300}getFormattedTTL(){return this.ttl<60?`${this.ttl}s`:this.ttl<3600?`${Math.floor(this.ttl/60)}m`:this.ttl<86400?`${Math.floor(this.ttl/3600)}h`:`${Math.floor(this.ttl/86400)}d`}isEqualTo(e){return this.recordType===e.recordType&&this.name===e.name&&this.value===e.value&&this.priority===e.priority}hasDifference(e){return!this.isEqualTo(e)||this.ttl!==e.ttl}};var S=class{id;workspaceId;domainName;records;createdAt;note;constructor(e){this.id=e.id,this.workspaceId=e.workspaceId,this.domainName=e.domainName,this.records=e.records.map(t=>new a(t)),this.createdAt=e.createdAt,this.note=e.note}getTotalRecords(){return this.records.length}getRecordsByType(e){return this.records.filter(t=>t.recordType===e)}isRecent(){let e=Date.now(),t=this.createdAt.toMillis();return(e-t)/(1e3*60*60)<24}getAgeInHours(){let e=Date.now(),t=this.createdAt.toMillis();return Math.floor((e-t)/(1e3*60*60))}compareWith(e){let t=[],s=[],n=[];for(let i of e){let h=this.records.find(o=>o.recordType===i.recordType&&o.name===i.name);h?h.hasDifference(i)&&n.push(i):t.push(i)}for(let i of this.records)e.find(o=>o.recordType===i.recordType&&o.name===i.name)||s.push(i);return{added:t,removed:s,modified:n}}};var T=class{workspaceId;workspaceName;rateLimitRequests;rateLimitRemaining;rateLimitResetTime;rateLimitPercentage;lastSuccessfulSync;lastFailedSync;consecutiveFailures;averageSyncTime;totalSyncs;successfulSyncs;failedSyncs;lastError;lastErrorTime;errorFrequency;errorTypes;circuitBreakerStatus;circuitBreakerOpenedAt;healthStatus;healthScore;lastUpdated;constructor(e){this.workspaceId=e.workspaceId,this.workspaceName=e.workspaceName,this.rateLimitRequests=e.rateLimitRequests,this.rateLimitRemaining=e.rateLimitRemaining,this.rateLimitResetTime=e.rateLimitResetTime,this.rateLimitPercentage=e.rateLimitPercentage,this.lastSuccessfulSync=e.lastSuccessfulSync,this.lastFailedSync=e.lastFailedSync,this.consecutiveFailures=e.consecutiveFailures,this.averageSyncTime=e.averageSyncTime,this.totalSyncs=e.totalSyncs,this.successfulSyncs=e.successfulSyncs,this.failedSyncs=e.failedSyncs,this.lastError=e.lastError,this.lastErrorTime=e.lastErrorTime,this.errorFrequency=e.errorFrequency,this.errorTypes=e.errorTypes,this.circuitBreakerStatus=e.circuitBreakerStatus,this.circuitBreakerOpenedAt=e.circuitBreakerOpenedAt,this.healthStatus=e.healthStatus,this.healthScore=e.healthScore,this.lastUpdated=e.lastUpdated}isNearRateLimit(){return this.rateLimitPercentage>=80}hasCriticalRateLimit(){return this.rateLimitPercentage>=90}hasConsecutiveFailures(){return this.consecutiveFailures>=3}isCircuitOpen(){return this.circuitBreakerStatus==="open"}isHealthy(){return this.healthStatus==="healthy"}needsAttention(){return this.healthStatus==="warning"||this.healthStatus==="critical"}getTimeUntilReset(){return this.rateLimitResetTime?this.rateLimitResetTime.getTime()-Date.now():null}getSyncSuccessRate(){return this.totalSyncs===0?100:Math.round(this.successfulSyncs/this.totalSyncs*100)}getFormattedSyncTime(){let e=Math.round(this.averageSyncTime/1e3);if(e<60)return`${e}s`;let t=Math.floor(e/60),s=e%60;return`${t}m ${s}s`}getMostCommonError(){let e=Object.entries(this.errorTypes);return e.length===0?null:e.sort((s,n)=>n[1]-s[1])[0][0]}static calculateHealthScore(e){let t=100;return e.rateLimitPercentage!==void 0&&(e.rateLimitPercentage>=90?t-=30:e.rateLimitPercentage>=80?t-=20:e.rateLimitPercentage>=70&&(t-=10)),e.consecutiveFailures!==void 0&&(t-=Math.min(e.consecutiveFailures*10,30)),e.errorFrequency!==void 0&&(t-=Math.min(e.errorFrequency*2,20)),e.circuitBreakerStatus==="open"&&(t-=20),Math.max(0,t)}static getHealthStatusFromScore(e){return e>=80?"healthy":e>=50?"warning":"critical"}},I=class{totalWorkspaces;healthyWorkspaces;warningWorkspaces;criticalWorkspaces;totalRateLimitUsage;workspacesNearLimit;totalSyncsToday;successfulSyncsToday;failedSyncsToday;totalErrors24h;workspacesWithErrors;averageHealthScore;lastUpdated;constructor(e){this.totalWorkspaces=e.totalWorkspaces,this.healthyWorkspaces=e.healthyWorkspaces,this.warningWorkspaces=e.warningWorkspaces,this.criticalWorkspaces=e.criticalWorkspaces,this.totalRateLimitUsage=e.totalRateLimitUsage,this.workspacesNearLimit=e.workspacesNearLimit,this.totalSyncsToday=e.totalSyncsToday,this.successfulSyncsToday=e.successfulSyncsToday,this.failedSyncsToday=e.failedSyncsToday,this.totalErrors24h=e.totalErrors24h,this.workspacesWithErrors=e.workspacesWithErrors,this.averageHealthScore=e.averageHealthScore,this.lastUpdated=e.lastUpdated}getSyncSuccessRate(){return this.totalSyncsToday===0?100:Math.round(this.successfulSyncsToday/this.totalSyncsToday*100)}isSystemHealthy(){return this.criticalWorkspaces===0&&this.warningWorkspaces===0}getHealthyPercentage(){return this.totalWorkspaces===0?100:Math.round(this.healthyWorkspaces/this.totalWorkspaces*100)}},b=class{timestamp;workspaceId;healthScore;rateLimitUsage;syncSuccess;errorCount;constructor(e){this.timestamp=e.timestamp,this.workspaceId=e.workspaceId,this.healthScore=e.healthScore,this.rateLimitUsage=e.rateLimitUsage,this.syncSuccess=e.syncSuccess,this.errorCount=e.errorCount}};var U=class r{http=w(k);BASE_URL=d.api.hostinger.baseUrl;REQUEST_TIMEOUT=d.api.hostinger.timeout;async testConnection(e){if(!e||e.trim()==="")return{success:!1,error:"Token vac\xEDo"};try{let t=new p({Authorization:`Bearer ${e}`,Accept:"application/json"}),s=["/domains/v1/portfolio","/billing/v1/subscriptions","/hosting/v1/websites"];for(let n of s)try{let i=await c(this.http.get(`${this.BASE_URL}${n}`,{headers:t,observe:"response",withCredentials:!1}).pipe(u(this.REQUEST_TIMEOUT)));if(i.status===200||i.status===201)return{success:!0}}catch{continue}return{success:!1,error:"Ning\xFAn endpoint respondi\xF3 correctamente. Verifica que el token sea v\xE1lido."}}catch(t){return console.error("Hostinger API Error:",t),this.handleError(t)}}async getDomains(e){try{let t=new p({Authorization:`Bearer ${e}`,Accept:"application/json"}),s=await c(this.http.get(`${this.BASE_URL}/domains/v1/portfolio`,{headers:t}).pipe(u(this.REQUEST_TIMEOUT)));return s.data||s||[]}catch(t){throw console.error("Error fetching domains:",t),t}}async getSubscriptions(e){try{let t=new p({Authorization:`Bearer ${e}`,Accept:"application/json"}),s=await c(this.http.get(`${this.BASE_URL}/billing/v1/subscriptions`,{headers:t}).pipe(u(this.REQUEST_TIMEOUT)));return s.data||s||[]}catch(t){throw console.error("Error fetching subscriptions:",t),t}}handleError(e){if(e instanceof E){if(e.status===0)return console.error("CORS or Network Error Details:",{message:e.message,error:e.error,url:e.url,statusText:e.statusText}),{success:!1,error:"Error de CORS: Hostinger API no permite peticiones desde el navegador. Considera usar un proxy o Cloud Function."};switch(e.status){case 401:return{success:!1,error:"Token inv\xE1lido o expirado"};case 403:return{success:!1,error:"Token sin permisos suficientes"};case 429:return{success:!1,error:"Demasiadas peticiones. Intenta de nuevo m\xE1s tarde."};case 500:case 502:case 503:case 530:return{success:!1,error:`Error del servidor de Hostinger (${e.status}). El endpoint puede no existir o el token no es v\xE1lido.`};default:return console.error("HTTP Error Details:",{status:e.status,statusText:e.statusText,message:e.message,error:e.error,url:e.url}),{success:!1,error:`Error HTTP ${e.status}: ${e.message}`}}}return e instanceof Error&&e.name==="TimeoutError"?{success:!1,error:"Timeout: La solicitud tard\xF3 demasiado"}:e instanceof Error?{success:!1,error:e.message}:{success:!1,error:"Error desconocido"}}static \u0275fac=function(t){return new(t||r)};static \u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})};export{P as a,M as b,v as c,f as d,g as e,y as f,A as g,a as h,S as i,T as j,I as k,b as l,U as m};
